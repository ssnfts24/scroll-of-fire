/* ======================================================================
   Scroll of Fire — Codex of Reality
   Global Stylesheet (codex.css)
   - Dark UI • responsive grid • advanced hero (cover/contain + fullscreen)
   - Sticky header, cards, tables, equations, badges
   - Motion-safe reveal • perf modes • print
   - “Living tech” vibe (HUD grid, neon rims, scanline sweep, pulses)
   - A11y: focus states, prefers-* media, high-contrast, reduced-data
   - Robust mobile: safe-area, viewport units, mobile table scroll
   ====================================================================== */

/* ------------------------------ Root / Theme ------------------------------ */
:root{
  /* Palette */
  --bg:#0b0b0f; --bg-elev:#0e0e12; --ink:#eae7df; --muted:#b8b3a6; --line:#2a2a33; --card:#121219;
  --gold:#f3c97a; --accent:#7af3ff; --accent-2:#7aa8ff; --accent-3:#9cffdd;

  /* Effects */
  --shadow:rgba(0,0,0,.35);
  --glow-gold:0 0 14px rgba(243,201,122,.18);
  --glow-cyan:0 0 16px rgba(122,243,255,.15);
  --glow-blue:0 0 16px rgba(122,168,255,.12);

  /* Layout */
  --maxw:1180px; --radius-lg:20px; --radius-md:16px; --radius-sm:10px; --pad-card:16px;

  /* Type scale */
  --fs-00:12px; --fs-0:14px; --fs-1:16px; --fs-2:18px;
  --fs-3:clamp(20px,2.6vw,24px); --fs-4:clamp(24px,3.6vw,32px); --fs-5:clamp(28px,3.6vw,48px);

  /* Motion */
  --ease:cubic-bezier(.2,.7,.2,1); --dur-1:.25s; --dur-2:.6s;

  /* Hero defaults */
  --hero-aspect:16/9;
  --hero-focal-mobile:63% 50%; --hero-focal-desktop:59% 50%;
  --pulse-opacity:.12; --pulse-c1:rgba(122,243,255,.35); --pulse-c2:rgba(243,201,122,.28);

  /* Safe-area */
  --safe-top:env(safe-area-inset-top,0px); --safe-bottom:env(safe-area-inset-bottom,0px);

  /* Ambient */
  --ambient-gold:rgba(243,201,122,.18); --ambient-cyan:rgba(122,243,255,.12);

  /* Focus ring */
  --ring: rgba(122,243,255,.95);
  --ring-outer: rgba(122,243,255,.12);
  --ring-inset: rgba(122,168,255,.35);
}
@media (prefers-color-scheme: light){
  :root{ --ink:#111218; --muted:#3a3a44; --bg:#f6f7fb; --bg-elev:#ffffff; --card:#f7f8fb; --line:#dfe2ea }
}

/* ------------------------------ Reset & Globals ------------------------------ */
*,*::before,*::after{ box-sizing:border-box }
html,body{ height:100% }
html{ -webkit-text-size-adjust:100%; text-size-adjust:100%; color-scheme:dark; scroll-behavior:smooth }
body{
  margin:0; font:400 var(--fs-1)/1.6 "Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";
  background:var(--bg); color:var(--ink);
  background-image:
    radial-gradient(1200px 600px at 50% -5%, rgba(122,243,255,.05), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.02) 0 2px, transparent 2px 12px),
    radial-gradient(1800px 900px at 50% -10%, #13131a 20%, var(--bg) 70%);
  text-rendering:optimizeLegibility; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  overscroll-behavior-y:contain; padding-bottom:var(--safe-bottom);
}
@media (prefers-color-scheme: light){
  body{
    background-image:
      radial-gradient(1200px 600px at 50% -5%, rgba(122,168,255,.08), transparent 60%),
      repeating-linear-gradient(0deg, rgba(0,0,0,.03) 0 2px, transparent 2px 12px),
      radial-gradient(1800px 900px at 50% -10%, #fff 20%, var(--bg) 70%);
  }
}
body::before,body::after{
  content:""; position:fixed; inset:-10% -10% auto -10%; height:60vh; pointer-events:none; z-index:0; mix-blend-mode:screen;
}
body::before{ background:radial-gradient(520px 300px at 50% -5%, var(--ambient-gold), transparent 60%); opacity:.85 }
body::after { background:radial-gradient(760px 380px at 85% 10%, var(--ambient-cyan), transparent 70%); opacity:.75 }
.wrap,.hero,.card,header,main,footer{ position:relative; z-index:1 }
@media (prefers-reduced-motion:no-preference){
  @keyframes ambientDrift{ 0%,100%{transform:translateY(0)} 50%{transform:translateY(10px)} }
  body::after{ animation:ambientDrift 14s linear infinite }
}

::selection{ background:rgba(122,243,255,.25); color:var(--ink) }
:focus-visible{
  outline:2px solid var(--ring);
  box-shadow:0 0 0 4px var(--ring-outer), 0 0 0 1px var(--ring-inset) inset;
  outline-offset:2px; border-radius:8px;
}

/* Links */
a{ color:var(--ink); text-underline-offset:2px; word-break:break-word; transition:color var(--dur-1) var(--ease), text-shadow var(--dur-1) var(--ease) }
a:hover{ color:#fff; text-shadow:0 0 10px rgba(122,243,255,.35) }
a:focus-visible{ text-decoration:underline }
a[rel~="external"]::after{ content:" ↗"; font-size:.9em; opacity:.8 }

/* Helpful utilities */
.sr-only{ position:absolute!important; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
.center{ text-align:center }
.right{ text-align:right }
.nowrap{ white-space:nowrap }

/* ------------------------------ Header / Nav (optional) ------------------------------ */
header.site{
  position:sticky; top:0; z-index:50;
  background:rgba(11,11,15,.7); backdrop-filter:saturate(140%) blur(8px);
  border-bottom:1px solid #1e1e26;
}
.nav{ display:flex; gap:10px; align-items:center; justify-content:space-between; max-width:var(--maxw); margin:0 auto; padding:10px 16px }
.brand{ display:flex; gap:10px; align-items:center }
.brand .logo{ width:28px; height:28px; border-radius:8px; background:linear-gradient(180deg,#88f,#5ff); box-shadow:0 0 12px rgba(122,243,255,.35) inset }
.brand h1{ font:800 clamp(18px,3.6vw,22px)/1 "Crimson Pro",Georgia,serif; margin:0 }
.quick{ display:flex; gap:12px; align-items:center; flex-wrap:wrap }
.quick a,.quick button{
  appearance:none; border:1px solid #2a2a33; background:transparent; color:var(--ink);
  padding:6px 10px; border-radius:10px; font:600 14px/1 Inter; cursor:pointer; text-decoration:none;
}
.quick button{ display:inline-flex; align-items:center; gap:6px }
.quick a:hover,.quick button:hover{ border-color:#3a3a44; background:rgba(255,255,255,.02) }

/* ------------------------------ Wrapper & Headings ------------------------------ */
.wrap{ max-width:var(--maxw); margin:0 auto; padding:20px 16px calc(80px + var(--safe-bottom)) }
@supports (height: 100svh){
  .wrap{ padding-bottom:calc(80px + var(--safe-bottom)) }
}
.title{
  font-family:"Crimson Pro",Georgia,serif; font-weight:800; text-align:center; font-size:var(--fs-5);
  margin:8px 0 4px; letter-spacing:.3px;
  background:linear-gradient(180deg,#fff 0%,#cfefff 60%,#a7f6ff 100%);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  text-shadow:0 0 24px rgba(122,243,255,.12);
  animation:titleShine 1.8s ease-out 1 both;
  word-break:keep-all;
}
@keyframes titleShine{ from{filter:drop-shadow(0 0 0 rgba(122,243,255,0))} to{filter:drop-shadow(0 0 12px rgba(122,243,255,.22))} }
.subtitle{ text-align:center; color:var(--muted); font-style:italic; margin:0 0 12px }

/* Dividers */
.divider{
  height:1px; background:
  linear-gradient(90deg,transparent,rgba(122,243,255,.45),transparent),
  linear-gradient(90deg,transparent,var(--line),transparent);
  filter:drop-shadow(0 0 6px rgba(122,243,255,.18)); margin:18px auto 24px;
}
.goldline{
  height:1px; background:
  linear-gradient(90deg,transparent,rgba(243,201,122,.55),transparent),
  linear-gradient(90deg,transparent,rgba(122,243,255,.15),transparent);
  margin:28px auto;
}

/* Rune divider (optional) */
.runes{ display:flex; justify-content:center; gap:10px; margin:10px 0 8px; opacity:.9 }
.runes span{
  width:10px; height:10px; border-radius:2px;
  box-shadow:0 0 10px rgba(122,243,255,.45), inset 0 0 8px rgba(243,201,122,.25);
  background:linear-gradient(180deg,rgba(122,243,255,.6),rgba(243,201,122,.35));
}

/* ------------------------------ Simple Mode toggle + helpers ------------------------------ */
.simple-toggle{ display:flex; align-items:center; gap:10px; justify-content:center; margin:0 0 14px }
.simple-toggle input{ accent-color:#8be9ff; transform:scale(1.15) }
.eq-note{ display:none; color:var(--muted); font-style:italic; margin:8px 2px 0 }
.simple-on .eq{ display:none }
.simple-on .eq-note{ display:block }

/* ------------------------------ Hero Banner ------------------------------ */
.hero{
  position:relative; margin:0 auto 10px; max-width:var(--maxw);
  border-radius:var(--radius-lg); overflow:hidden; background:var(--bg-elev);
  box-shadow:0 10px 30px var(--shadow), inset 0 0 40px rgba(255,200,107,.05), inset 0 0 0 1px rgba(122,243,255,.12);
  isolation:isolate; perspective:1200px;
}
.hero img{
  display:block; width:100%; height:auto; aspect-ratio:var(--hero-aspect);
  object-fit:cover; object-position:var(--hero-focal-mobile);
  opacity:1; transition:opacity .35s var(--ease);
  background:var(--bg-elev); max-height:min(68vh,860px); will-change:opacity,transform;
}
@media (min-width:860px){ .hero img{ object-position:var(--hero-focal-desktop) } }

/* modes via data-fit / classes */
.hero[data-fit="contain"] img,.hero.hero--contain img{ object-fit:contain!important; object-position:center center!important; max-height:min(78vh,920px) }
.hero[data-fit="cover"]   img,.hero.hero--cover   img{ object-fit:cover!important }

/* overlays */
.hero::before,.hero::after{ content:""; position:absolute; inset:0; pointer-events:none }
.hero::before{
  background:
    linear-gradient(to right, rgba(11,11,15,.92), transparent 7%, transparent 93%, rgba(11,11,15,.92)),
    linear-gradient(to bottom, rgba(11,11,15,.9), transparent 10%, transparent 90%, rgba(11,11,15,.9));
  mix-blend-mode:multiply; opacity:.95; z-index:0;
}
.hero::after{
  background:
    radial-gradient(80% 130% at 50% 8%, rgba(122,243,255,.06), transparent 60%),
    repeating-linear-gradient(0deg, rgba(255,255,255,.05) 0 1px, transparent 1px 3px);
  opacity:.12; z-index:1;
}
@media (prefers-reduced-motion:no-preference){
  @keyframes scanFloat{ to{ background-position-y:12px } }
  .hero::after{ animation:scanFloat 8s linear infinite; will-change:background-position }
}

/* pulse layer (optional; Codex.js toggles .pulse) */
.hero .hero-pulse{
  position:absolute; inset:0; pointer-events:none; z-index:2; opacity:var(--pulse-opacity); mix-blend-mode:screen;
  background:
    radial-gradient(circle at 50% 55%, var(--pulse-c1) 0 6%, transparent 35%),
    radial-gradient(circle at 50% 55%, var(--pulse-c2) 0 3%, transparent 22%);
  background-repeat:no-repeat; background-position:center center, center center; transform:translateZ(0); display:none;
}
.hero.pulse .hero-pulse{ display:block }
@keyframes pulseShock{
  0%{background-size:10% 10%,6% 6%;opacity:0}
  6%{opacity:var(--pulse-opacity)}
  30%{background-size:120% 120%,90% 90%;opacity:.10}
  60%{background-size:220% 220%,160% 160%;opacity:.06}
  100%{background-size:320% 320%,240% 240%;opacity:0}
}
@media (prefers-reduced-motion:no-preference){ .hero.pulse .hero-pulse{ animation:pulseShock 6.5s cubic-bezier(.22,.7,.15,1) infinite } }

/* webview hardening & reduced modes */
@supports (-webkit-touch-callout:none){ .hero img{ opacity:1!important; filter:none!important } }
@media (prefers-reduced-data:reduce),(prefers-reduced-motion:reduce){
  .hero::after{ animation:none!important }
  .hero img{ opacity:1!important }
  .hero.pulse .hero-pulse{ display:none!important }
}
@media (max-width:740px){ .hero img{ max-height:56vh } }
@media (max-width:420px){ .hero:not([data-fit="contain"]) img{ object-fit:contain } }

.hero-grid{ position:absolute; inset:0; pointer-events:none; opacity:.18 }
.sigil-line{ height:2px; background:linear-gradient(90deg,transparent,var(--gold),transparent); opacity:.65 }

/* hero toolbar + fullscreen zoom (Codex.js may inject buttons) */
.hero-ui{
  position:absolute; right:12px; bottom:12px; display:flex; gap:8px; z-index:3;
  backdrop-filter:saturate(140%) blur(6px);
  background:rgba(12,12,16,.42); border:1px solid #24242c; border-radius:12px; padding:6px;
}
.hero-btn{
  appearance:none; border:1px solid #2a2a33; background:rgba(255,255,255,.02);
  color:var(--ink); padding:6px 10px; border-radius:10px; font:600 13px/1 Inter; cursor:pointer;
}
.hero-btn:hover{ border-color:#3a3a44 }
.hero-btn:focus-visible{ outline:2px solid var(--ring); box-shadow:0 0 0 4px var(--ring-outer) }
.hero.is-zoomed{ position:fixed; inset:0; margin:0; border-radius:0; z-index:9999; background:#0a0a0d; box-shadow:none }
.hero.is-zoomed img{ height:100svh; max-height:100svh; width:100vw; aspect-ratio:auto; object-fit:contain }
.hero.is-zoomed .hero-ui{ right:16px; bottom:16px }

/* ------------------------------ Grid System ------------------------------ */
.grid{ display:grid; grid-template-columns:repeat(12,1fr); gap:14px }
.col-12{grid-column:span 12}.col-9{grid-column:span 9}.col-8{grid-column:span 8}.col-7{grid-column:span 7}.col-6{grid-column:span 6}.col-5{grid-column:span 5}.col-4{grid-column:span 4}
@media (max-width:980px){ .col-9,.col-8,.col-7,.col-6,.col-5,.col-4{ grid-column:span 12 } .wrap{ padding-bottom:64px } }
@media (max-width:360px){ .grid{ gap:10px } }

/* ------------------------------ Cards ------------------------------ */
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  border:1px solid var(--line); border-radius:var(--radius-md);
  padding:var(--pad-card) var(--pad-card) calc(var(--pad-card) - 2px);
  box-shadow:0 6px 14px var(--shadow); transform:translateZ(0);
  will-change:transform,opacity; opacity:.98; backface-visibility:hidden; transform-style:preserve-3d; perspective:900px;
  position:relative;
}
.card::before,.card::after{ content:""; position:absolute; inset:0; pointer-events:none; border-radius:inherit }
.card::before{
  box-shadow:
    inset 0 0 0 1px rgba(122,243,255,.18),
    inset 0 0 22px rgba(122,243,255,.08),
    inset 0 0 36px rgba(122,168,255,.06);
}
.card::after{
  background:
    conic-gradient(from 0deg at 10px 10px, rgba(122,243,255,.45) 0 25%, transparent 0 100%),
    conic-gradient(from 90deg at calc(100% - 10px) 10px, rgba(122,168,255,.45) 0 25%, transparent 0 100%),
    conic-gradient(from 180deg at 10px calc(100% - 10px), rgba(156,255,221,.45) 0 25%, transparent 0 100%),
    conic-gradient(from 270deg at calc(100% - 10px) calc(100% - 10px), rgba(243,201,122,.35) 0 25%, transparent 0 100%);
  mask:
    radial-gradient(10px 10px at 10px 10px, #000 90%, transparent 100%),
    radial-gradient(10px 10px at calc(100% - 10px) 10px, #000 90%, transparent 100%),
    radial-gradient(10px 10px at 10px calc(100% - 10px), #000 90%, transparent 100%),
    radial-gradient(10px 10px at calc(100% - 10px) calc(100% - 10px), #000 90%, transparent 100%);
  mask-composite:exclude; opacity:.28;
}
@media (prefers-reduced-motion:no-preference){
  .card{ opacity:0; transform:translate3d(0,6px,0) }
  .card.visible{ animation:reveal var(--dur-2) var(--ease) both, cardIdle 12s ease-in-out infinite both; box-shadow:0 10px 20px var(--shadow) }
  @keyframes reveal{ to{ opacity:.98; transform:translate3d(0,0,0) } }
  @keyframes cardIdle{ 0%,100%{ box-shadow:0 10px 20px var(--shadow), inset 0 0 18px rgba(255,200,107,.03) } 50%{ box-shadow:0 12px 22px var(--shadow), inset 0 0 26px rgba(122,243,255,.05) } }
}
@media (hover:hover){
  .card:hover{ box-shadow:0 12px 24px var(--shadow), inset 0 0 28px rgba(122,243,255,.06); transform:translateZ(0) }
}

/* ------------------------------ Typography & Utilities ------------------------------ */
h1,h2,h3{ color:#fff; margin:8px 0 10px; line-height:1.25; text-shadow:0 0 10px rgba(122,243,255,.08) }
h2{ font-size:var(--fs-4) } h3{ font-size:var(--fs-3) }
p{ margin:8px 0 10px }
.meta{ color:var(--muted); font-size:var(--fs-0); line-height:1.5 }
.hint{ color:var(--muted); font-size:.95em }

/* Definition-like looks (for lists used as glossaries) */
#glossary .list li{ margin:8px 0 }

/* Code & preformatted */
pre,code,kbd,samp{ font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace }
pre{
  background:#0f0f14; color:var(--ink); border:1px solid var(--line); border-radius:12px; padding:12px 14px; overflow:auto;
  box-shadow:inset 0 0 20px rgba(255,200,107,.03), inset 0 0 0 1px rgba(122,243,255,.14);
}
code{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); padding:.1em .35em; border-radius:6px }
kbd{ background:#11131a; border:1px solid #343842; border-bottom-width:3px; padding:.15em .4em; border-radius:6px; box-shadow:inset 0 -2px 0 rgba(0,0,0,.25) }

/* Callouts (optional, in case you add .note/.warn later) */
.note{ border-left:3px solid var(--accent); padding:.5rem .75rem; background:rgba(122,243,255,.06); border-radius:10px }
.warn{ border-left:3px solid var(--gold); padding:.5rem .75rem; background:rgba(243,201,122,.08); border-radius:10px }

/* Lists, CTA */
.list{ margin:0; padding-left:18px }
.list li{ margin:6px 0 }
.cta{
  display:inline-block; margin-top:10px; padding:10px 12px;
  border-radius:var(--radius-sm); border:1px solid var(--line); text-decoration:none;
  transition:border-color var(--dur-1) var(--ease), transform var(--dur-1) var(--ease), box-shadow var(--dur-1) var(--ease);
  position:relative; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
}
.cta::after{
  content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  box-shadow:inset 0 0 0 1px rgba(122,243,255,.25), inset 0 0 16px rgba(122,243,255,.08);
  opacity:.75;
}
@media (hover:hover){ .cta:hover{ border-color:#3a3a44; transform:translateY(-1px); box-shadow:0 0 18px rgba(122,243,255,.2) } }
.cta:active{ transform:translateY(0) }

/* ------------------------------ Tables ------------------------------ */
table{
  width:100%; border-collapse:collapse; border:1px solid var(--line);
  border-radius:12px; overflow:hidden; font-size:var(--fs-0);
  box-shadow:0 0 0 1px rgba(122,243,255,.12) inset;
}
thead th{
  background:linear-gradient(180deg,#16161d,#12121a);
  border-bottom:1px solid var(--line); padding:10px 12px; text-align:left; font-weight:600; color:#f2f1ec;
  text-shadow:0 0 8px rgba(122,243,255,.12);
}
tbody td{ border-top:1px solid var(--line); padding:10px 12px; vertical-align:top; color:var(--ink) }
tbody tr:nth-child(even) td{ background:rgba(255,255,255,.015) }

/* Mobile: switch to horizontal scroll (no data-labels required) */
@media (max-width: 560px){
  table{ display:block; width:100%; overflow-x:auto; border-radius:12px }
  thead, tbody, tr, th, td{ white-space:nowrap }
}

/* Section-specific tweaks */
#technology .list li{ margin:8px 0 }
#constants table td, #constants table th{ font-size:var(--fs-0) }

/* ------------------------------ Equations (MathJax) ------------------------------ */
.eq{
  position:relative; overflow:hidden; border-radius:12px;
  background:#111115; border:1px solid #26262c;
  box-shadow:inset 0 0 20px rgba(255,200,107,.03), var(--glow-cyan), var(--glow-blue);
  margin:8px 0 10px;
}
.eq .eq-scroll{
  overflow-x:auto; max-width:100%; padding:12px 16px; -webkit-overflow-scrolling:touch;
  background:repeating-linear-gradient(90deg, rgba(122,243,255,.05) 0 1px, transparent 1px 24px);
}
.eq::after{
  content:""; position:absolute; inset:0; pointer-events:none;
  box-shadow: inset 0 0 0 1px rgba(122,243,255,.22), inset 0 0 26px rgba(122,243,255,.05);
  border-radius:inherit; opacity:.9;
}
.eq mjx-container{ display:block!important; filter:drop-shadow(0 0 10px rgba(255,200,107,.08)) }
.eq.eq-on{ outline:1px solid rgba(243,201,122,.22); box-shadow:inset 0 0 24px rgba(255,200,107,.05), var(--glow-gold), var(--glow-cyan) }

/* Long inline math safety */
p mjx-container[display="inline"], li mjx-container[display="inline"], h3 mjx-container[display="inline"]{
  display:block!important; max-width:100%; overflow-x:auto; -webkit-overflow-scrolling:touch; padding-bottom:2px;
}

/* ------------------------------ Living-tech utilities ------------------------------ */
.badge{
  display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border:1px solid var(--line);
  border-radius:999px; font-size:var(--fs-0); color:var(--ink);
  background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  box-shadow: inset 0 0 18px rgba(122,243,255,.05);
}
.badge::before{ content:"◆"; font-size:.9em; color:#aef; filter:drop-shadow(0 0 6px rgba(122,243,255,.6)) }
.remnant-glow{ text-shadow:0 0 10px rgba(243,201,122,.45), 0 0 20px rgba(122,243,255,.25) }

/* ------------------------------ Footer ------------------------------ */
footer.footer{ text-align:center; color:var(--muted); margin-top:20px; font-size:var(--fs-0) }

/* ------------------------------ Back to top (optional) ------------------------------ */
.to-top{
  position:fixed; right:14px; bottom:calc(16px + var(--safe-bottom)); z-index:20;
  border-radius:12px; border:1px solid #2a2a33; background:rgba(12,12,16,.55); backdrop-filter:blur(6px);
  padding:10px 12px; font:600 13px/1 Inter; color:var(--ink); cursor:pointer; display:none;
}
.to-top.show{ display:block }
.to-top:hover{ border-color:#3a3a44 }

/* ------------------------------ Command palette shell (optional) ------------------------------ */
.palette{ position:fixed; inset:auto 0 0 0; z-index:60; display:none; background:rgba(10,10,14,.6); backdrop-filter:blur(8px) }
.palette.open{ display:block }
.palette .panel{
  max-width:720px; margin:12vh auto; background:#101017; border:1px solid #2a2a33; border-radius:14px; overflow:hidden;
  box-shadow:0 20px 60px rgba(0,0,0,.45);
}
.palette input{
  width:100%; padding:14px 16px; background:#0c0c12; color:var(--ink); border:0; border-bottom:1px solid #23232c; font:500 16px/1.4 Inter;
}
.palette ul{ list-style:none; margin:0; padding:10px }
.palette li{ padding:8px 10px; border-radius:10px; cursor:pointer }
.palette li:hover{ background:#15151e }

/* ------------------------------ Motion Safety ------------------------------ */
@media (prefers-reduced-motion:reduce){
  *{ animation:none!important; transition:none!important; scroll-behavior:auto!important }
  .card{ opacity:1!important; transform:none!important }
}

/* ------------------------------ High Contrast ------------------------------ */
@media (prefers-contrast:more){
  :root{ --line:#3c3c45 }
  .card,.eq,.cta{ border-color:#3c3c45 }
  a{ text-decoration:underline }
}
@media (forced-colors:active){
  .hero,.card,.eq{ outline:1px solid CanvasText }
  .hero::before,.hero::after{ display:none!important }
}

/* ------------------------------ Helpers ------------------------------ */
p,li,td,th{ word-wrap:break-word; overflow-wrap:anywhere }
:target{ scroll-margin-top:12px }

/* ------------------------------ Print ------------------------------ */
@media print{
  :root{ --bg:#fff; --ink:#000; --muted:#333; --line:#ccc }
  *{ box-shadow:none!important; text-shadow:none!important; background-image:none!important }
  body{ background:#fff!important; color:#000!important }
  .wrap{ max-width:100%; padding:0 12mm }
  .hero,.hero-grid,.sigil-line,.mini-toc,header.site,.to-top{ display:none!important }
  .card{ border:1px solid #ccc; page-break-inside:avoid }
  a{ color:#000; text-decoration:underline }
  .cta{ border:1px solid #aaa }
  .goldline,.divider{ background:#ccc!important }
  .eq{ background:#fff; border:1px solid #ccc; box-shadow:none!important }
  mjx-container{ filter:none!important }
  table{ border:1px solid #ccc }
  thead th{ background:#f4f4f4; color:#000; text-shadow:none }
}

/* ------------------------------ Scrollbar ------------------------------ */
@supports selector(:root:has(body)){
  body::-webkit-scrollbar{ width:12px }
  body::-webkit-scrollbar-track{ background:#0f0f14 }
  body::-webkit-scrollbar-thumb{
    background:#2b2b35; border-radius:10px; border:2px solid #0f0f14;
    box-shadow: inset 0 0 12px rgba(122,243,255,.15);
  }
}

/* ==== Performance accelerators ========================================== */
@supports (content-visibility:auto){
  main>.grid,.card,section,article{ content-visibility:auto; contain-intrinsic-size:600px }
  .card{ contain-intrinsic-size:360px }
}
@media (prefers-reduced-motion:no-preference){
  body.performance-warming .hero::after,
  body.performance-warming .card::after,
  body.performance-warming .card::before{ opacity:0!important }
  body.performance-warming .card{ box-shadow:none!important }
}
@keyframes _perfWarmOff{ to{ opacity:1 } }
body.performance-warming{ animation:_perfWarmOff .9s linear forwards }

body.perf-fast,
@media (prefers-reduced-data:reduce){
  body{ background-image:none!important }
  body::before,body::after{ display:none!important }
  .hero::after{ display:none!important }
  .hero.pulse .hero-pulse{ display:none!important }
  .card{ box-shadow:0 8px 16px var(--shadow) }
  .card::before,.card::after{ display:none!important }
  .eq{ box-shadow:inset 0 0 12px rgba(255,200,107,.03) }
}

/* Compositing & micro-opts */
*{ will-change:auto!important }
.hero img{ will-change:opacity }
.eq .eq-scroll{ -webkit-overflow-scrolling:touch; overscroll-behavior:contain }

/* Small devices */
@media (max-width:480px){
  .title{ font-size:clamp(26px,6vw,40px) }
  .hero img{ max-height:42vh }
  .card{ padding:14px }
}

/* Shadows deferral */
@media (prefers-reduced-motion:no-preference){
  .card{ box-shadow:0 6px 14px var(--shadow) }
  .card.visible{ box-shadow:0 10px 20px var(--shadow) }
  @media (hover:hover){ .card:hover{ box-shadow:0 12px 24px var(--shadow) } }
}




/* ======================================================================
   vNext Upgrades — non-breaking, opt-in helpers
   Paste at the end of codex.css
   ====================================================================== */

/* 1) Equation UX — snap, edge-fade, scroll shadows, larger tap targets */
.eq .eq-scroll{
  scroll-snap-type: x proximity;
  mask-image: linear-gradient(to right, transparent 0, #000 28px, #000 calc(100% - 28px), transparent 100%);
  -webkit-mask-image: linear-gradient(to right, transparent 0, #000 28px, #000 calc(100% - 28px), transparent 100%);
  scrollbar-gutter: stable both-edges;
  cursor: grab;
}
.eq .eq-scroll:active{ cursor: grabbing }
.eq mjx-container{ scroll-snap-align: start; padding-right: 24px } /* easier chunking on swipe */
.eq.is-edge-left .eq-scroll,
.eq .eq-scroll:is(:hover, :focus-within){
  mask-image: linear-gradient(to right, transparent 0, #000 20px, #000 calc(100% - 20px), transparent 100%);
  -webkit-mask-image: linear-gradient(to right, transparent 0, #000 20px, #000 calc(100% - 20px), transparent 100%);
}
/* subtle scroll shadows to hint “more content” */
.eq::before{
  content:""; position:absolute; inset:0 0 0 auto; width:24px; pointer-events:none;
  background:linear-gradient(to left, rgba(0,0,0,.0), rgba(0,0,0,.25));
  border-radius:inherit; opacity:.35;
}
.eq::after{ /* already defined in your sheet; boost glow slightly on hover */
  transition:opacity .2s var(--ease);
}
.eq:hover::after{ opacity:1 }

/* 2) Equation pop-out (JS toggles .eq--expanded on click) */
.eq--expanded{
  position:fixed; inset:4svh 4svw; z-index:10000; border-radius:16px;
  background:#0b0b10; border:1px solid #2a2a33; box-shadow:0 40px 120px rgba(0,0,0,.6);
  display:flex; flex-direction:column;
}
.eq--expanded .eq-scroll{
  flex:1; padding:18px 22px; max-height:unset; overflow:auto; mask:none; -webkit-mask-image:none;
}
.eq--expanded .eq-close{
  position:absolute; right:12px; top:10px; appearance:none; border:1px solid #2a2a33;
  background:rgba(255,255,255,.03); color:var(--ink); padding:6px 10px; border-radius:10px;
  font:600 13px/1 Inter; cursor:pointer;
}
@media (max-width:720px){
  .eq--expanded{ inset:0; border-radius:0 }
}

/* 3) Card “teaching” variant — stronger rim + header strap */
.card.card--teach{
  border-color:#2f2f39;
  box-shadow:0 10px 22px var(--shadow), inset 0 0 30px rgba(122,243,255,.06);
}
.card--teach .strap{
  display:inline-block; margin:-6px 0 10px; padding:6px 10px; border-radius:999px;
  border:1px solid #293042; background:linear-gradient(180deg,rgba(122,243,255,.09),rgba(122,243,255,.03));
  font:700 12px/1 Inter; letter-spacing:.08em; text-transform:uppercase; color:#dff6ff;
}

/* 4) Sticky mini-TOC (works with your grid aside) */
.mini-toc{
  position:sticky; top:calc(12px + var(--safe-top)); align-self:start;
  border-radius:12px; border:1px solid #222633; padding:10px;
  background:linear-gradient(180deg, #0e0e14, #0b0b10);
}
.mini-toc a{ display:block; padding:6px 8px; border-radius:8px; font-size:var(--fs-0) }
.mini-toc a:is(:hover,:focus-visible){ background:rgba(255,255,255,.04) }

/* 5) Tabs (pure CSS, target-based) */
.tabs{ --tab-b:#2a2a33; --tab-bg:rgba(255,255,255,.03) }
.tabs .tab-list{ display:flex; gap:8px; flex-wrap:wrap; margin:0 0 10px }
.tabs .tab-list a{
  display:inline-block; padding:8px 10px; border:1px solid var(--tab-b); border-radius:10px; text-decoration:none;
  background:var(--tab-bg); font:600 14px/1 Inter;
}
.tabs .tab-panel{ display:none; }
.tabs .tab-panel:target{ display:block; }
.tabs .tab-list a[aria-current="true"]{ border-color:#3a3a44; background:rgba(255,255,255,.06) }

/* 6) Accordion (details/summary polish) */
details.codex{
  border:1px solid #2a2a33; border-radius:12px; padding:8px 10px; background:rgba(255,255,255,.02);
}
details.codex + details.codex{ margin-top:10px }
details.codex summary{
  cursor:pointer; list-style:none; font-weight:600;
}
details.codex[open]{ box-shadow:inset 0 0 18px rgba(122,243,255,.06) }
details.codex summary::-webkit-details-marker{ display:none }

/* 7) Tooltips (for inline symbols/abbr) */
.tip{
  position:relative; border-bottom:1px dotted rgba(255,255,255,.35); cursor:help;
}
.tip:hover::after{
  content:attr(data-tip); position:absolute; left:0; top:calc(100% + 6px); z-index:20;
  white-space:nowrap; padding:6px 8px; border-radius:8px; font-size:var(--fs-0);
  color:var(--ink); background:#0f0f16; border:1px solid #2a2a33; box-shadow:0 10px 20px rgba(0,0,0,.35);
}

/* 8) Header anchors (auto “#” when you wrap <a class="anchor">) */
a.anchor{ color:var(--muted); text-decoration:none; margin-left:.4em; font-weight:800; opacity:.6 }
a.anchor:hover{ opacity:1; text-shadow:0 0 8px rgba(122,243,255,.22) }

/* 9) Nicer horizontal scrollers everywhere (including tables) */
.scroller{
  overflow-x:auto; -webkit-overflow-scrolling:touch; scrollbar-gutter:stable both-edges;
  mask-image: linear-gradient(to right, transparent, #000 20px, #000 calc(100% - 20px), transparent);
  -webkit-mask-image: linear-gradient(to right, transparent, #000 20px, #000 calc(100% - 20px), transparent);
}

/* 10) “Back to section” floating button (optional) */
.to-section{
  position:sticky; bottom:10px; margin-left:auto; display:inline-block;
  padding:8px 10px; border-radius:10px; border:1px solid #2a2a33; background:rgba(255,255,255,.02);
  font:600 13px/1 Inter;
}

/* 11) Focus ring helper for keyboard nav on .card and .eq */
.card:focus-within, .eq:focus-within{
  outline:2px solid var(--ring); outline-offset:2px; border-radius:12px;
}

/* 12) Micro-interactions for buttons/CTAs inside cards */
.card .cta{ transition: transform .18s var(--ease), box-shadow .18s var(--ease) }
.card .cta:active{ transform: translateY(0) scale(.99) }
/* Banner fallback for old browsers */
@supports not (aspect-ratio:16/9){ .hero img{ height:clamp(200px,30vw,360px) } }

/* Heading spacing */
.card h2:first-child,.card h3:first-child{ margin-top:4px }

/* Ultra-wide padding */
@media (min-width:1280px){ .wrap{ padding-left:24px; padding-right:24px } }

/* ------------------------------ End ------------------------------ */




/* ======================================================================
   SoF "Living-Tech" Upgrade Pack
   (Safe to append; opt-in via classes)
   ====================================================================== */

/* ---------- 0) Motion/Data governors (auto dial-down) ---------- */
@media (prefers-reduced-motion:reduce) {
  .laser-grid, .card--neon::after, .cta::after,
  .tabs .tab-ink, .eq-shimmer::after, .hero.star-scan::after,
  .hero.star-scan::before, .hero--starfield::before { animation: none !important; }
}
@media (prefers-reduced-data:reduce) {
  .laser-grid, .hero--starfield::before { display:none !important; }
}

/* ---------- 1) Laser HUD overlay (drop-in layer) ---------- */
.laser-grid{
  position:fixed; inset:-10% -10% 0 -10%;
  pointer-events:none; z-index:0; mix-blend-mode:screen; opacity:.45;
  background:
    radial-gradient(1200px 600px at 65% -5%, rgba(122,243,255,.08), transparent 60%),
    repeating-linear-gradient(90deg, rgba(122,243,255,.08) 0 1px, transparent 1px 26px),
    repeating-linear-gradient(0deg, rgba(243,201,122,.06) 0 1px, transparent 1px 26px);
}
@media (prefers-reduced-motion:no-preference){
  @keyframes gridDriftA { 0%{transform:translateY(0)} 50%{transform:translateY(8px)} 100%{transform:translateY(0)} }
  @keyframes gridDriftB { 0%{background-position:0 0, 0 0, 0 0} 100%{background-position:0 0, 60px 0, 0 60px} }
  .laser-grid{ animation: gridDriftA 16s ease-in-out infinite, gridDriftB 22s linear infinite; }
}

/* ---------- 2) Hero upgrades: starfield + scanline sweep ---------- */
.hero.hero--starfield::before{
  content:""; position:absolute; inset:-10%; z-index:0; pointer-events:none; opacity:.25;
  background:
    radial-gradient(2px 2px at 20% 30%, #7af3ff, transparent 40%),
    radial-gradient(1.5px 1.5px at 65% 20%, #f3c97a, transparent 40%),
    radial-gradient(1.5px 1.5px at 80% 70%, #7aa8ff, transparent 40%),
    radial-gradient(2px 2px at 35% 75%, #9cffdd, transparent 40%);
  filter: drop-shadow(0 0 6px rgba(122,243,255,.25));
}
.hero.star-scan::after{
  /* reuse your ::after but add a slow scan pulse */
  animation: scanFloat 8s linear infinite, starPulse 9.5s ease-in-out infinite;
}
@keyframes starPulse { 0%,100%{opacity:.12} 50%{opacity:.18} }

/* ---------- 3) Neon border sweep for highlighted cards ---------- */
.card.card--neon{ position:relative; overflow:clip; }
.card.card--neon::after{
  content:""; position:absolute; inset:-1px; border-radius:inherit; pointer-events:none;
  background:
    conic-gradient(from 0deg, rgba(122,243,255,.0) 0deg, rgba(122,243,255,.45) 90deg, rgba(243,201,122,.35) 180deg, rgba(122,168,255,.35) 270deg, rgba(122,243,255,.0) 360deg);
  mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite: xor; mask-composite: exclude;
  padding:1px; opacity:.35; filter:saturate(120%);
}
@media (hover:hover) and (prefers-reduced-motion:no-preference){
  @keyframes rimSweep { to { transform: rotate(360deg) } }
  .card.card--neon::after{ transform-origin:50% 50%; animation: rimSweep 14s linear infinite; }
}

/* ---------- 4) CTA ripple & active press ---------- */
.cta{ position:relative; overflow:hidden }
.cta::after{
  content:""; position:absolute; inset:auto auto 50% 50%; width:0; height:0; border-radius:999px;
  background: radial-gradient(circle, rgba(122,243,255,.25), rgba(122,243,255,0) 60%);
  transform: translate(-50%, 50%); opacity:0;
}
@media (hover:hover){
  .cta:hover::after{ width:220px; height:220px; opacity:.45; transition: width .45s var(--ease), height .45s var(--ease), opacity .45s var(--ease) }
}
.cta:active{ transform: translateY(0) scale(.98) }

/* ---------- 5) Tabs underline “ink bar” (for your .tabs navs) ---------- */
.tabs{ position:relative }
.tabs .tab{ position:relative; display:inline-block; padding:8px 10px; border:1px solid var(--line); border-radius:10px; text-decoration:none; background:rgba(255,255,255,.03); font:600 14px/1 Inter; }
.tabs .tab[aria-current="page"]{ border-color:#3a3a44; background:rgba(255,255,255,.06) }
.tabs{ --ink-x: 0px; --ink-w: 0px }
.tabs .tab-ink{
  position:absolute; height:2px; background:linear-gradient(90deg,#7af3ff,#f3c97a);
  bottom:-2px; left:var(--ink-x); width:var(--ink-w); border-radius:2px; box-shadow:0 0 12px rgba(122,243,255,.45);
  transition:left .25s var(--ease), width .25s var(--ease), opacity .25s var(--ease); opacity:.85;
}
@media (prefers-reduced-motion:reduce){ .tabs .tab-ink{ transition:none } }

/* You can position ink with JS, but here’s a no-JS fallback: */
.tabs:has(a[aria-current="page"]) .tab-ink{ opacity:1 }

/* ---------- 6) Equation shimmer + coherence pulse ---------- */
.eq.eq-shimmer{ position:relative; overflow:hidden }
.eq.eq-shimmer::after{
  content:""; position:absolute; inset:0 0 0 -60%; width:60%;
  background: linear-gradient(110deg, transparent 0%, rgba(255,255,255,.07) 45%, rgba(255,255,255,.12) 50%, rgba(255,255,255,.07) 55%, transparent 100%);
  filter: blur(1px); opacity:0;
}
@media (prefers-reduced-motion:no-preference){
  @keyframes shimmerSlide{ 0%{transform:translateX(-110%); opacity:0} 10%{opacity:.7} 60%{opacity:.7} 100%{transform:translateX(210%); opacity:0} }
  .eq.eq-shimmer::after{ animation: shimmerSlide 6.5s ease-in-out infinite; }
}
.eq.eq-pulse{ box-shadow: inset 0 0 20px rgba(255,200,107,.04), 0 0 0 0 rgba(122,243,255,.0) }
@media (prefers-reduced-motion:no-preference){
  @keyframes eqPulse { 0%{box-shadow:inset 0 0 20px rgba(255,200,107,.04), 0 0 0 0 rgba(122,243,255,.0)}
                       50%{box-shadow:inset 0 0 26px rgba(255,200,107,.06), 0 0 22px 0 rgba(122,243,255,.18)}
                       100%{box-shadow:inset 0 0 20px rgba(255,200,107,.04), 0 0 0 0 rgba(122,243,255,.0)} }
  .eq.eq-pulse{ animation: eqPulse 9s ease-in-out infinite }
}

/* ---------- 7) Dividers with “sigil beam” sweep ---------- */
.goldline.sweep, .divider.sweep{ position:relative; overflow:hidden }
.goldline.sweep::after, .divider.sweep::after{
  content:""; position:absolute; top:-1px; bottom:-1px; width:120px;
  background:linear-gradient(90deg, transparent, rgba(243,201,122,.55), rgba(122,243,255,.45), transparent);
  box-shadow:0 0 18px rgba(122,243,255,.25);
  transform:translateX(-140px);
}
@media (prefers-reduced-motion:no-preference){
  @keyframes beam { to { transform: translateX(calc(100% + 140px)) } }
  .goldline.sweep::after, .divider.sweep::after{ animation: beam 8s linear infinite }
}

/* ---------- 8) “Breathing” focus ring for keyboard users ---------- */
:focus-visible{
  outline:2px solid var(--ring);
  box-shadow:0 0 0 4px var(--ring-outer), 0 0 0 1px var(--ring-inset) inset, 0 0 18px rgba(122,243,255,.25);
}
@media (prefers-reduced-motion:no-preference){
  @keyframes breathe{ 0%,100%{ box-shadow:0 0 0 4px var(--ring-outer), 0 0 0 1px var(--ring-inset) inset }
                      50%{ box-shadow:0 0 0 6px var(--ring-outer), 0 0 0 1px var(--ring-inset) inset } }
  :focus-visible{ animation: breathe 3.2s ease-in-out infinite }
}

/* ---------- 9) Ring widget theme helpers (Circle page) ---------- */
.ring-bg{ stroke:#1f1f28 }
.ring-fg{ stroke:url(#gRing) }
.ring-phase{ letter-spacing:.06em }
.ring-count{ opacity:.9 }

/* ---------- 10) Utility badges and tiny helpers ---------- */
.badge{ box-shadow: inset 0 0 18px rgba(122,243,255,.08) }
.badge--gold{ border-color:rgba(243,201,122,.55); box-shadow:inset 0 0 18px rgba(243,201,122,.12) }
.kicker{ letter-spacing:.12em; text-transform:uppercase; font-weight:700; color:var(--muted); font-size:.85rem }

/* ---------- 11) Optional “laser” heading underline ---------- */
.title.laser{
  text-shadow: 0 0 24px rgba(122,243,255,.18);
  background: linear-gradient(180deg,#fff 0%,#cfefff 60%,#a7f6ff 100%);
  -webkit-background-clip:text; background-clip:text; color:transparent;
  position:relative;
}
.title.laser::after{
  content:""; position:absolute; left:10%; right:10%; bottom:-6px; height:2px;
  background:linear-gradient(90deg,#7af3ff,#f3c97a);
  box-shadow:0 0 12px rgba(122,243,255,.35);
}

/* ---------- 12) Hero zoom button alignment (if you add .hero-ui) ---------- */
.hero .hero-ui{ backdrop-filter:saturate(140%) blur(6px); background:rgba(12,12,16,.42) }

/* ---------- 13) Micro perf nits ---------- */
@media (prefers-reduced-motion:no-preference){
  .card.visible.card--neon{ will-change: filter, transform; }
}









.eq-scroll {
  animation: pulseGlow 6s ease-in-out infinite;
  text-shadow: 0 0 8px rgba(100,255,255,0.6), 0 0 16px rgba(64,224,255,0.4);
}
@keyframes pulseGlow {
  0%,100% { filter: drop-shadow(0 0 4px #00e6ff) drop-shadow(0 0 12px #00aaff); }
  50%     { filter: drop-shadow(0 0 8px #00ffff) drop-shadow(0 0 24px #66ffff); }
}




body {
  background: radial-gradient(circle at 50% 50%, #0b0b0f 0%, #050507 80%);
  background-image: repeating-linear-gradient(0deg, rgba(0,255,255,0.03) 0 1px, transparent 1px 60px),
                    repeating-linear-gradient(90deg, rgba(0,255,255,0.03) 0 1px, transparent 1px 60px);
}
