/* === Equation activation (no HTML changes required) ==================== */

/* base state */
.eq{
  position:relative;
  overflow-x:auto;
  padding:12px 60px 12px 12px;
  border-radius:12px;
  background:#111115;
  border:1px solid #26262c;
  box-shadow: inset 0 0 20px rgba(255,200,107,.03);
  opacity:0;
  transform: translateY(8px) scale(.995);
  transition: opacity .6s ease, transform .6s ease, box-shadow .6s ease;
}

/* glow rail + holo sweep (created with pseudo elements) */
.eq::before,
.eq::after{
  content:"";
  position:absolute;
  pointer-events:none;
  border-radius: inherit;
  inset:0;
}

/* gold “breath” halo */
.eq::before{
  background: radial-gradient(120% 80% at 10% 5%, rgba(243,201,122,.06), transparent 70%),
              radial-gradient(140% 90% at 100% 100%, rgba(122,243,255,.05), transparent 70%);
  opacity:0;
  transition: opacity .8s ease;
}

/* holographic sweep line */
.eq::after{
  left:auto; right:10px; top:10px; bottom:10px; width:2px;
  background: linear-gradient(180deg, transparent, var(--gold), transparent);
  filter: blur(.4px);
  transform: translateX(12px);
  opacity:0;
}

/* MathJax container soft fade */
.eq mjx-container{
  opacity:.0;
  filter: drop-shadow(0 0 8px rgba(255,200,107,.06));
  transition: opacity .5s ease .05s, filter .6s ease .05s;
}

/* activated */
.eq.eq-on{
  opacity:1;
  transform: none;
  transition-delay: var(--eq-delay, 0s);
  box-shadow:
    inset 0 0 24px rgba(255,200,107,.05),
    0 0 0 0 rgba(243,201,122,0);
}

/* halo comes alive */
.eq.eq-on::before{
  opacity:1;
  transition-delay: calc(var(--eq-delay,0s) + .05s);
}

/* sweep slides once */
.eq.eq-on::after{
  opacity:.9;
  animation: eqSweep 1.2s ease-out forwards;
  animation-delay: calc(var(--eq-delay,0s) + .15s);
}
@keyframes eqSweep{
  0%   { transform: translateX(12px); opacity:0; }
  10%  { opacity:.9; }
  100% { transform: translateX(-6px); opacity:0; }
}

/* text brightens subtly */
.eq.eq-on mjx-container{
  opacity:1;
  filter: drop-shadow(0 0 10px rgba(255,200,107,.10));
  transition-delay: calc(var(--eq-delay,0s) + .08s);
}

/* A gentle “breathing” rail at the bottom edge */
.eq.eq-on::marker{} /* noop: ensures some engines repaint */
.eq.eq-on{
  background-image:
    linear-gradient(to bottom, transparent, rgba(255,210,122,.02)),
    radial-gradient(100% 12px at 50% 100%, rgba(243,201,122,.25), transparent);
  background-repeat: no-repeat;
  background-size: 100% 100%, 60% 6px;
  background-position: 0 0, 50% 100%;
}

/* Reduced motion: no fancy sweep; just fade in */
@media (prefers-reduced-motion: reduce){
  .eq{ opacity:1; transform:none }
  .eq::after{ display:none }
  .eq mjx-container{ opacity:1 }
}

/* Optional: slightly stronger glow on hover/focus for accessibility */
.eq:focus-within,
.eq:hover{
  box-shadow:
    inset 0 0 28px rgba(255,200,107,.055),
    0 0 0 0 rgba(243,201,122,0);
}
