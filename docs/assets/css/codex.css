/* ======================================================================
   Scroll of Fire — Codex of Reality
   Global Stylesheet (codex.css)
   - Dark UI, responsive grid, hero banner (cover + contain modes)
   - Cards, lists, tables, equations (incl. inline overflow guards)
   - Motion-safe reveal, focus visibility, print styles
   ====================================================================== */

/* ------------------------------ Root / Theme ------------------------------ */

:root {
  /* Palette */
  --bg: #0b0b0f;
  --bg-elev: #0e0e12;
  --ink: #eae7df;
  --muted: #b8b3a6;
  --line: #2a2a33;
  --card: #121219;

  --gold: #f3c97a;
  --accent: #7af3ff;

  /* Effects */
  --shadow: rgba(0, 0, 0, .35);
  --glow-gold: 0 0 12px rgba(243, 201, 122, .18);
  --glow-cyan: 0 0 12px rgba(122, 243, 255, .12);

  /* Layout */
  --maxw: 1180px;
  --radius-lg: 20px;
  --radius-md: 16px;
  --radius-sm: 10px;
  --pad-card: 16px;

  /* Type scale */
  --fs-00: 12px;
  --fs-0: 14px;
  --fs-1: 16px;  /* base */
  --fs-2: 18px;
  --fs-3: clamp(20px, 2.6vw, 24px);
  --fs-4: clamp(24px, 3.6vw, 32px);
  --fs-5: clamp(28px, 3.6vw, 48px);

  /* Motion */
  --ease: cubic-bezier(.2,.7,.2,1);
  --dur-1: .25s;
  --dur-2: .6s;

  /* Hero focal defaults (JS may override object-position directly) */
  --hero-aspect: 16/9;
  --hero-focal-mobile: 63% 50%;
  --hero-focal-desktop: 59% 50%;

  /* Safe-area helpers */
  --safe-top: env(safe-area-inset-top, 0px);
  --safe-bottom: env(safe-area-inset-bottom, 0px);
}

/* Respect user theme if light preferred (keeps dark colors but adjusts contrast) */
@media (prefers-color-scheme: light) {
  :root { --ink: #111218; --muted: #3a3a44; }
  body { color: #13131a; background: #f6f7fb; }
}

/* ------------------------------ Global Reset ------------------------------ */

*,
*::before,
*::after { box-sizing: border-box; }

html, body { height: 100%; }

html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
  color-scheme: dark;
  scroll-behavior: smooth;
}

body {
  margin: 0;
  font: 400 var(--fs-1)/1.6 "Inter", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
  background: var(--bg);
  color: var(--ink);
  background-image:
    radial-gradient(1800px 900px at 50% -10%, #13131a 20%, var(--bg) 70%);
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overscroll-behavior-y: contain;
  padding-bottom: var(--safe-bottom);
}

/* Text selection */
::selection { background: rgba(243, 201, 122, .25); color: var(--ink); }

/* Focus visibility */
:focus-visible {
  outline: 2px solid rgba(122, 243, 255, .9);
  outline-offset: 2px;
  border-radius: 6px;
}

/* Links */
a { color: var(--ink); text-underline-offset: 2px; word-break: break-word; }
a:hover { color: #fff; }
a:where([rel~="external"])::after {
  content: " ↗";
  font-size: .9em;
  opacity: .8;
}

/* Utility visually-hidden (for SR-only text) */
.sr-only {
  position: absolute !important;
  width: 1px; height: 1px;
  padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0, 0, 0, 0);
  white-space: nowrap; border: 0;
}

/* ------------------------------ Wrappers & Headings ------------------------------ */

.wrap {
  max-width: var(--maxw);
  margin: 0 auto;
  padding: 20px 16px calc(80px + var(--safe-bottom));
}

.title {
  font-family: "Crimson Pro", Georgia, serif;
  font-weight: 800;
  text-align: center;
  font-size: var(--fs-5);
  margin: 8px 0 4px;
  letter-spacing: .3px;
}

.subtitle {
  text-align: center;
  color: var(--muted);
  font-style: italic;
  margin: 0 0 12px;
}

.divider {
  height: 1px;
  background: linear-gradient(90deg, transparent, var(--line), transparent);
  margin: 18px auto 24px;
}

.goldline {
  height: 1px;
  background: linear-gradient(90deg, transparent, rgba(243, 201, 122, .5), transparent);
  margin: 28px auto;
}

/* Inline rule within intro card */
.rule {
  height: 1px;
  border: 0;
  background: linear-gradient(90deg, transparent, var(--line), transparent);
  margin: 12px 0 10px;
}

/* Sigils row */
.sigils { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
.sigil {
  display: inline-flex;
  align-items: center; justify-content: center;
  width: 32px; height: 32px;
  border-radius: 10px;
  background: linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.01));
  border: 1px solid var(--line);
  box-shadow: inset 0 0 24px rgba(255,200,107,.03);
}

/* ------------------------------ Hero Banner ------------------------------ */

.hero {
  position: relative;
  margin: 0 auto 10px;
  max-width: var(--maxw);
  border-radius: var(--radius-lg);
  overflow: hidden;
  background: var(--bg-elev);
  box-shadow: 0 10px 30px var(--shadow), inset 0 0 40px rgba(255,200,107,.05);
  isolation: isolate;
}

/* Stable aspect; JS may also enforce via custom property */
.hero > img {
  display: block;
  width: 100%;
  height: auto;
  aspect-ratio: var(--hero-aspect);
  object-fit: cover; /* default = edge-to-edge */
  object-position: var(--hero-focal-mobile);
  opacity: .001; /* fade in when ready */
  transition: opacity .35s var(--ease);
  will-change: opacity;
  background: var(--bg-elev);
  image-rendering: auto;
}

/* Contain mode — always show the whole image centered with subtle letterbox */
.hero.hero--contain {
  background:
    radial-gradient(1200px 600px at 50% 0%, rgba(255,200,107,.06), transparent 60%),
    var(--bg-elev);
}
.hero.hero--contain > img {
  object-fit: contain !important;
  object-position: center center !important;
  height: auto !important;
  aspect-ratio: var(--hero-aspect);
  background: transparent;
}

/* subtle grid & rule overlay */
.hero-grid {
  position: absolute;
  inset: 0;
  pointer-events: none;
  opacity: .2;
}
.sigil-line { height: 2px; background: linear-gradient(90deg, transparent, var(--gold), transparent); opacity: .6; }

@media (min-width: 860px) {
  .hero > img { object-position: var(--hero-focal-desktop); }
}

.hero > img.hero-ready { opacity: 1; }

/* ------------------------------ Grid System ------------------------------ */

.grid {
  display: grid;
  grid-template-columns: repeat(12, 1fr);
  gap: 14px;
}

/* Column spans */
.col-12 { grid-column: span 12; }
.col-8  { grid-column: span 8; }
.col-7  { grid-column: span 7; }
.col-6  { grid-column: span 6; }
.col-5  { grid-column: span 5; }
.col-4  { grid-column: span 4; }

/* Stack on mid screens */
@media (max-width: 980px) {
  .col-8, .col-7, .col-6, .col-5, .col-4 { grid-column: span 12; }
  .wrap { padding-bottom: 64px; }
}

/* Tighten on very small screens */
@media (max-width: 360px) {
  .grid { gap: 10px; }
}

/* ------------------------------ Card ------------------------------ */

.card {
  background: linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.005));
  border: 1px solid var(--line);
  border-radius: var(--radius-md);
  padding: var(--pad-card) var(--pad-card) calc(var(--pad-card) - 2px);
  box-shadow: 0 10px 20px var(--shadow), inset 0 0 24px rgba(255,200,107,.03);
  transform: translateZ(0);
  will-change: transform, opacity;
  opacity: .98;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  perspective: 900px;
}

/* Reveal animation (toggled via JS by adding .visible) */
@media (prefers-reduced-motion: no-preference) {
  .card { opacity: 0; transform: translate3d(0, 6px, 0); }
  .card.visible { animation: reveal var(--dur-2) var(--ease) both; }
}
@keyframes reveal {
  to { opacity: .98; transform: translate3d(0, 0, 0); }
}

/* ------------------------------ Lists, Table, CTA ------------------------------ */

.list { margin: 0; padding-left: 18px; }
.list li { margin: 6px 0; }

.cta {
  display: inline-block;
  margin-top: 10px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  border: 1px solid var(--line);
  text-decoration: none;
  transition: border-color var(--dur-1) var(--ease), transform var(--dur-1) var(--ease);
}
@media (hover:hover) {
  .cta:hover { border-color: #3a3a44; transform: translateY(-1px); }
}
.cta:active { transform: translateY(0); }

/* Tables */
table {
  width: 100%;
  border-collapse: collapse;
  border: 1px solid var(--line);
  border-radius: 12px;
  overflow: hidden;
  font-size: var(--fs-0);
}
thead th {
  background: #15151c;
  border-bottom: 1px solid var(--line);
  padding: 10px 12px;
  text-align: left;
  font-weight: 600;
  color: #f2f1ec;
}
tbody td {
  border-top: 1px solid var(--line);
  padding: 10px 12px;
  vertical-align: top;
  color: var(--ink);
}
tbody tr:nth-child(even) td { background: rgba(255,255,255,.015); }

/* ------------------------------ Equations (MathJax) ------------------------------ */

.eq {
  position: relative;
  overflow: hidden;
  border-radius: 12px;
  background: #111115;
  border: 1px solid #26262c;
  box-shadow: inset 0 0 20px rgba(255,200,107,.03), var(--glow-cyan);
  margin: 8px 0 10px;
}
.eq .eq-scroll {
  overflow-x: auto;
  max-width: 100%;
  padding: 12px 16px;
  -webkit-overflow-scrolling: touch;
  scrollbar-color: #444 #1a1a22; /* Firefox */
  scrollbar-width: thin;
}

/* WebKit scrollbars inside equation boxes */
.eq .eq-scroll::-webkit-scrollbar { height: 10px; }
.eq .eq-scroll::-webkit-scrollbar-track { background: #1a1a22; border-radius: 10px; }
.eq .eq-scroll::-webkit-scrollbar-thumb {
  background: #3a3a44; border-radius: 10px; border: 2px solid #1a1a22;
}

.eq mjx-container {
  display: block !important;
  filter: drop-shadow(0 0 10px rgba(255,200,107,.08));
}

/* Activated by JS when in view */
.eq.eq-on { outline: 1px solid rgba(243,201,122,.22); box-shadow: inset 0 0 24px rgba(255,200,107,.05), var(--glow-gold); }

/* Protect long INLINE equations (credits, lists) from overflowing on phones */
p mjx-container[display="inline"],
li mjx-container[display="inline"],
h3 mjx-container[display="inline"] {
  display: block !important;
  max-width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 2px;
}

/* ------------------------------ Typography Tweaks ------------------------------ */

h1, h2, h3 {
  color: #fff;
  margin: 8px 0 10px;
  line-height: 1.25;
}
h2 { font-size: var(--fs-4); }
h3 { font-size: var(--fs-3); }
p  { margin: 8px 0 10px; }

.meta {
  color: var(--muted);
  font-size: var(--fs-0);
  line-height: 1.5;
}

/* Code & pre (used in integrity block) */
pre, code, kbd, samp {
  font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
}
pre {
  background: #0f0f14;
  color: var(--ink);
  border: 1px solid var(--line);
  border-radius: 12px;
  padding: 12px 14px;
  overflow: auto;
  box-shadow: inset 0 0 20px rgba(255,200,107,.03);
}

/* ------------------------------ Footer ------------------------------ */

footer.footer {
  text-align: center;
  color: var(--muted);
  margin-top: 20px;
  font-size: var(--fs-0);
}

/* ------------------------------ Motion Safety ------------------------------ */

@media (prefers-reduced-motion: reduce) {
  * { animation: none !important; transition: none !important; scroll-behavior: auto !important; }
  .card { opacity: 1 !important; transform: none !important; }
}

/* ------------------------------ High Contrast / Forced Colors ------------------------------ */

@media (prefers-contrast: more) {
  :root { --line: #3c3c45; }
  .card { border-color: #3c3c45; }
  .eq { border-color: #3c3c45; }
  .cta { border-color: #3c3c45; }
}
@media (forced-colors: active) {
  .hero, .card, .eq { outline: 1px solid CanvasText; }
}

/* ------------------------------ Small Helpers ------------------------------ */

/* Tighten long word breaks in narrow viewports */
p, li, td, th { word-wrap: break-word; overflow-wrap: anywhere; }

/* Anchor offset for fixed UIs */
:target { scroll-margin-top: 12px; }

/* ------------------------------ Print Styles ------------------------------ */

@media print {
  :root {
    --bg: #fff; --ink: #000; --muted: #333; --line: #ccc;
  }
  * { box-shadow: none !important; text-shadow: none !important; }
  body {
    background: #fff !important;
    color: #000 !important;
  }
  .wrap { max-width: 100%; padding: 0 12mm; }
  .hero, .hero-grid, .sigil-line { display: none !important; }
  .card { border: 1px solid #ccc; page-break-inside: avoid; }
  a { color: #000; text-decoration: underline; }
  .cta { border: 1px solid #aaa; }
  .goldline, .divider { background: #ccc !important; }
  .eq { background: #fff; border: 1px solid #ccc; }
  mjx-container { filter: none !important; }
}

/* ------------------------------ Scrollbar Global (non-equation areas) ------------------------------ */

@supports selector(:root:has(body)) {
  /* Only modern browsers */
  body::-webkit-scrollbar { width: 12px; }
  body::-webkit-scrollbar-track { background: #0f0f14; }
  body::-webkit-scrollbar-thumb { background: #2b2b35; border-radius: 10px; border: 2px solid #0f0f14; }
}

/* ------------------------------ Section-specific Spacing Tweaks ------------------------------ */

#technology .list li { margin: 8px 0; }
#constants table td, #constants table th { font-size: var(--fs-0); }

/* Improve table readability on phones */
@media (max-width: 560px) {
  table thead { display: none; }
  table, tbody, tr, td { display: block; width: 100%; }
  tbody tr { border-top: 1px solid var(--line); padding: 8px 0; }
  tbody td { border: 0; padding: 6px 0; }
  tbody td::before {
    content: attr(data-label) " ";
    font-weight: 600;
    color: var(--muted);
    margin-right: 8px;
  }
}

/* ------------------------------ Banner Fallbacks ------------------------------ */

/* If a very old browser lacks aspect-ratio, ensure a safe min-height */
@supports not (aspect-ratio: 16/9) {
  .hero > img { height: clamp(200px, 30vw, 360px); }
}

/* ------------------------------ Heading Spacing in Cards ------------------------------ */

.card h2:first-child,
.card h3:first-child { margin-top: 4px; }

/* ------------------------------ Tight Layout for Ultra-wide ------------------------------ */
@media (min-width: 1280px) {
  .wrap { padding-left: 24px; padding-right: 24px; }
}

/* ------------------------------ Done ------------------------------ */
```0
