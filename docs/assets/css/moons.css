/* ============================================================
   Scroll of Fire â€” MOONS FEATURE LAYER
   Living Clock / Calendar / Astronomy UI  (v4.1 Remnant)
   Depends on: tokens.css, core.css
   ============================================================ */

@layer astrology, utilities, remnant;

/* ------------------------------ Sky Canvas ------------------------------ */
@layer astrology {
  #skyBg {
    position: fixed;
    inset: 0;
    z-index: -1;
    background: radial-gradient(1600px 900px at 50% 0%, rgba(122,243,255,.05), transparent 70%),
                radial-gradient(1400px 600px at 90% 100%, rgba(243,201,122,.05), transparent 70%),
                var(--bg);
    animation: skyPulse 20s ease-in-out infinite;
  }

  @keyframes skyPulse {
    0%,100% { opacity: 0.9; filter: brightness(1); }
    50% { opacity: 1; filter: brightness(1.1); }
  }
}

/* ------------------------------ Living Clock + Moon Simulation ------------------------------ */
@layer astrology {
  #simMoon {
    border-radius: var(--r-lg);
    background: linear-gradient(180deg,#0b0e15,#05070d);
    border: 1px solid var(--line);
    box-shadow: 0 0 60px rgba(122,243,255,.1), 0 0 120px rgba(243,201,122,.05);
    transition: box-shadow var(--t-slow) var(--ease);
  }

  #simMoon:hover {
    box-shadow: 0 0 80px rgba(122,243,255,.2), 0 0 160px rgba(243,201,122,.1);
  }

  #phaseLine { font-size: 1.1rem; font-weight: 600; }
  #phaseMeta { opacity: .8; font-size: .9rem; }
  #numLine   { font-weight: 700; }
  #numMeta   { color: var(--muted); }
}

/* ------------------------------ Controls + Sliders ------------------------------ */
@layer utilities {
  input[type="range"] {
    width: 100%;
    appearance: none;
    background: transparent;
  }
  input[type="range"]::-webkit-slider-runnable-track {
    height: 4px;
    background: linear-gradient(90deg, var(--accent), var(--accent-2));
    border-radius: 6px;
  }
  input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 16px; height: 16px;
    border-radius: 50%;
    background: var(--accent);
    box-shadow: 0 0 6px var(--accent);
    margin-top: -6px;
    transition: background var(--t-fast) var(--ease);
  }
  input[type="range"]:hover::-webkit-slider-thumb { background: var(--accent-2); }
}

/* ------------------------------ Remnant Calendar ------------------------------ */
@layer remnant {
  .calendar__grid .day.is-weekend,
  .cal__grid .cal__cell.is-weekend {
    background: linear-gradient(180deg, rgba(122,243,255,.06), transparent), var(--surface-2);
  }
  .calendar__grid .day.is-doot,
  .cal__grid .cal__cell.is-doot {
    background: linear-gradient(180deg, rgba(243,201,122,.1), transparent), var(--surface-2);
  }

  /* Glow accent when active */
  .cal__grid .cal__cell:focus-visible,
  .cal__grid .cal__cell:active {
    outline: 2px solid var(--accent);
    box-shadow: var(--air-glow);
  }

  /* Tooltip hover for date cells (short messages) */
  .cal__grid .cal__cell:hover::after {
    content: attr(aria-label);
    position: absolute;
    bottom: 100%; left: 50%; transform: translateX(-50%) translateY(-4px);
    background: #0f1520;
    color: #eaf3ff;
    border: 1px solid #2a3242;
    border-radius: var(--r-sm);
    padding: .25rem .45rem;
    font-size: .75rem;
    white-space: nowrap;
    pointer-events: none;
    opacity: 0;
    animation: fadeIn .25s forwards;
  }
  @keyframes fadeIn { to { opacity: 1; } }

  /* Compact moon widget pulse */
  .moonbar.yhwh-on {
    animation: pulseAura 10s ease-in-out infinite;
  }
  @keyframes pulseAura {
    0%,100% { box-shadow: 0 0 10px rgba(122,243,255,.25), inset 0 0 0 1px #274354; }
    50%     { box-shadow: 0 0 20px rgba(243,201,122,.25), inset 0 0 0 1px #3c3632; }
  }

  /* Glow around active year map row */
  .year-map tr.is-today td {
    box-shadow: inset 0 0 0 1px var(--accent), 0 0 16px rgba(122,243,255,.1);
  }

  /* Remnant veil over entire body set by JS */
  body.remnant-yhwh::before {
    content: "";
    position: fixed;
    inset: 0;
    background: var(--remnant-veil);
    pointer-events: none;
    z-index: -1;
  }
}

/* ------------------------------ Astro Wheel FX ------------------------------ */
@layer astrology {
  #astroWheel circle[data-dot],
  #astroWheel [data-dot] {
    transition: transform 3s cubic-bezier(.25,.8,.25,1), filter var(--t-slow) var(--ease);
    transform-origin: center;
  }
  #astroWheel [data-dot]:hover {
    filter: drop-shadow(var(--gold-glow));
    transform: scale(1.25);
  }
  #astroWheel .dot.el-fire   { fill: #ff6b3d; }
  #astroWheel .dot.el-air    { fill: #7af3ff; }
  #astroWheel .dot.el-water  { fill: #7aaaff; }
  #astroWheel .dot.el-earth  { fill: #b3ff85; }
}

/* ------------------------------ Share Card (auto-generated via JS) ------------------------------ */
@layer utilities {
  .share-card {
    display:grid; grid-template-columns: auto 1fr;
    align-items:center; gap:1rem;
    background: linear-gradient(120deg, rgba(122,243,255,.08), rgba(243,201,122,.08));
    border: 1px solid var(--line);
    border-radius: var(--r-md);
    padding: .8rem 1rem;
    box-shadow: var(--elev-1);
  }
  .share-card img { width: 72px; height: 72px; border-radius: var(--r-lg); }
  .share-card .meta { color: var(--muted); }
}

/* ------------------------------ Notes + Practice ------------------------------ */
@layer remnant {
  #practiceCard textarea {
    width: 100%; min-height: 120px;
    border: 1px solid var(--line);
    border-radius: var(--r-sm);
    background: var(--surface-2);
    color: var(--fg);
    font-family: var(--font-sans);
    font-size: .95rem;
    padding: .5rem .6rem;
    resize: vertical;
  }
  #practiceCard textarea:focus-visible {
    outline: 2px solid var(--accent);
  }
  #btnSaveNote {
    background: var(--accent);
    color: #0b0b0f;
    font-weight: 700;
    border-radius: var(--r-sm);
  }
  #btnSaveNote:hover { background: var(--accent-2); }
}

/* ------------------------------ Responsiveness + Safety ------------------------------ */
@layer utilities {
  @media (max-width: 800px) {
    #astroWheel { max-width: 100%; height: auto; }
    .astro-wheel { padding: .4rem; }
    .calendar__grid, .cal__grid, .greg { grid-template-columns: repeat(7, minmax(38px,1fr)); gap:4px; }
    .day, .cal__cell { min-height: 64px; padding: .35rem; }
  }
  @media (max-width: 560px) {
    .moonbar { grid-template-columns: 1fr; text-align:center; }
    .moonbar-actions { justify-content:center; }
  }
}

/* ------------------------------ Final YHWH Aesthetic Touch ------------------------------ */
@layer remnant {
  .yhwh-on .ring-fg {
    stroke: url(#rg);
    animation: ringGlow 6s ease-in-out infinite;
  }
  @keyframes ringGlow {
    0%,100% { filter: drop-shadow(0 0 6px rgba(122,243,255,.4)); }
    50%     { filter: drop-shadow(0 0 14px rgba(243,201,122,.35)); }
  }
}
