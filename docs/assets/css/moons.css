/* ==========================================================================
   Scroll of Fire — Moons UI
   Page styles for moons.html (ring, calendars, year map, astro, practice)
   Uses token variables from tokens.css + base rules from core.css
   v2025.11.03-r3
   ========================================================================== */

@layer components, astrology, remnant;

/* ------------------------------- Common --------------------------------- */
@layer components {
  .wrap { max-width: 1100px; }

  .page-head.fancy-head .title { font-weight: 900; letter-spacing: .2px; }
  .page-head .subtitle { opacity: .85 }

  .pill{
    display:inline-flex; align-items:center; gap:.4rem;
    padding:.35rem .6rem; border:1px solid var(--line); border-radius:999px;
    background:linear-gradient(180deg,#0f1218,#0c0f16); color:var(--ink);
    font:600 .85rem/1.1 Inter, system-ui; box-shadow: inset 0 1px 0 rgba(255,255,255,.03)
  }
  .pill.mono{ font-variant-numeric: tabular-nums; letter-spacing:.2px }

  .badge{
    display:inline-block; padding:.25rem .5rem; border-radius:8px;
    background:#121928; border:1px solid var(--line); font-weight:700
  }
  .badge.asp{ font:700 .8rem/1 Inter,system-ui }
  .badge.asp.conj{ background:#15202f }
  .badge.asp.sext{ background:#13252a }
  .badge.asp.sqr { background:#211823 }
  .badge.asp.tri { background:#15221b }
  .badge.asp.opp { background:#261a1a }

  .card.shine{
    position:relative; overflow:hidden;
    background:
      radial-gradient(600px 240px at 80% -10%, rgba(122,243,255,.06), transparent 70%),
      linear-gradient(180deg, var(--bg-elev), color-mix(in oklab, var(--bg-elev) 80%, black))
  }
  .card .meta{ color:color-mix(in lch, var(--ink) 65%, transparent) }

  .divider{ height:1px; background:var(--line); margin:.6rem 0 }
}

/* --------------------------- Ring + Week row ---------------------------- */
@layer components {
  .ringcard{
    display:grid; gap:14px; align-items:center
  }
  .moon-badge{
    display:flex; flex-wrap:wrap; align-items:center; gap:10px
  }
  .moon-badge .sigil{ filter:drop-shadow(0 2px 6px rgba(0,0,0,.35)) }

  .weekrow{ display:flex; align-items:center; gap:.6rem; overflow:auto; -webkit-overflow-scrolling:touch }
  .weeklabel{ font:700 .8rem/1 Inter,system-ui; color:var(--muted) }
  .week{ display:flex; gap:.8rem }
  .wdots{ display:grid; grid-auto-flow:column; grid-auto-columns:min-content; gap:.35rem }
  .wdot{ width:.55rem; height:.55rem; border-radius:50%; background:#1b2231; box-shadow:inset 0 1px 0 rgba(255,255,255,.04) }
  .wdot.is-today{ background: color-mix(in oklab, var(--accent) 75%, #1b2231); box-shadow: 0 0 0 2px color-mix(in oklab, var(--accent) 35%, transparent) }

  /* Lively ring accent (motion-safe) */
  .ring .ring-fg { filter: drop-shadow(0 0 6px color-mix(in oklab, var(--accent) 30%, transparent)); }
  @media (prefers-reduced-motion: no-preference) {
    .ring .ring-fg {
      animation: sof-ring-glow 4.5s ease-in-out infinite;
      transform-origin: 60px 60px;
    }
  }
  @keyframes sof-ring-glow {
    0%,100% { filter: drop-shadow(0 0 4px rgba(122,243,255,.25)); }
    50%     { filter: drop-shadow(0 0 10px rgba(122,243,255,.5)); }
  }
}

/* ----------------------------- Control row ------------------------------ */
@layer components {
  .formrow label{ display:flex; flex-direction:column; gap:.35rem; font-weight:700; font-size:.9rem }
  .lab-input{
    background:#0f1218; color:var(--ink);
    border:1px solid var(--line); border-radius:10px; padding:.45rem .55rem
  }
  input[type="date"].lab-input{ min-width: 14ch }
  input[type="range"].lab-input{ width: 200px; height:28px }
  @media (max-width: 520px){
    input[type="range"].lab-input{ width: 140px }
  }

  /* TZ select fit better on narrow screens */
  @media (max-width: 420px){
    #tzPick{ max-width: 100%; }
  }
}

/* ---------------------------- Lunar Phase sim --------------------------- */
@layer components {
  #simMoon{
    border-radius:14px; border:1px solid var(--line);
    background:
      radial-gradient(400px 220px at 50% 0%, rgba(122,243,255,.05), transparent 65%),
      #0b0f16;
    box-shadow:var(--rim)
  }
  #phaseLine{ font-weight:800 }
  #phaseMeta{ color:var(--muted) }
}

/* ------------------------- Dual calendars block ------------------------- */
@layer components {
  .panel__head{ display:flex; align-items:end; justify-content:space-between; gap:10px; margin-bottom:.6rem }
  .panel__title{ margin:0 }
  .panel__meta{ color:var(--muted) }

  .calendar, .gregorian{ --cell: clamp(36px, 8.5vw, 56px); --gap:6px }
  .r-grid, .g-grid{ display:grid; grid-template-columns:repeat(7, minmax(var(--cell), 1fr)); gap:var(--gap) }

  .r-lbl, .g-lbl{
    display:grid; place-items:center; font:700 .75rem/1.2 Inter,system-ui;
    color:color-mix(in lch, var(--ink) 65%, transparent)
  }

  .r-day, .g-day, .g-pad{
    min-height: var(--cell);
    border:1px solid var(--line); border-radius:10px; background:var(--bg-elev);
    display:flex; align-items:center; justify-content:center
  }
  .r-day>button, .g-day>button{
    all:unset; display:grid; place-items:center; inline-size:100%; block-size:100%;
    border-radius:10px; cursor:pointer; font:700 .95rem/1 Inter,system-ui
  }
  .r-day.is-today, .g-day.is-today{ outline:2px solid var(--accent); outline-offset:1px }

  .r-doot{
    min-height:calc(var(--cell)*1.6); display:grid; place-items:center; text-align:center;
    border-radius:12px; border:1px dashed color-mix(in lch, var(--accent) 45%, var(--line));
    background:linear-gradient(180deg,#0e1219,#0b0f16)
  }

  /* Legend keys under gregorian */
  .legend .key{ display:inline-flex; align-items:center; gap:.45rem; font-weight:700 }
  .legend .k-dot{
    width:.65rem; height:.65rem; border-radius:50%;
    display:inline-block; background:#1b2231; box-shadow:inset 0 1px 0 rgba(255,255,255,.05)
  }
  .legend .k-evt1{ background:#1c2d3f }
  .legend .k-evt2{ background:#2a2441 }
  .legend .k-doot{ background:#2a313f }
  .legend .k-leap{ background:#243a32 }
  .legend .k-today{ background: color-mix(in oklab, var(--accent) 75%, #1b2231) }

  /* Hover affordance */
  .r-day>button:hover, .g-day>button:hover {
    background: linear-gradient(180deg, #0f141f, #0c101a);
  }
}

/* ------------------------------ Year map -------------------------------- */
@layer components {
  .scroller{ overflow:auto; -webkit-overflow-scrolling:touch }
  .year-map{
    width:100%; border-collapse:separate; border-spacing:0; font-variant-numeric: tabular-nums
  }
  .year-map thead th{
    position:sticky; top:0; z-index:1;
    background:#0e0e12; border-bottom:1px solid var(--line); text-align:left; padding:.55rem .6rem
  }
  .year-map tbody td{
    padding:.5rem .6rem; border-bottom:1px solid #1a2130
  }
  .year-map tbody tr:hover td{
    background:linear-gradient(90deg, rgba(122,243,255,.06), transparent 40%)
  }
  .year-map tbody td .tag{
    display:inline-block; margin-left:.35rem; padding:.1rem .35rem; border-radius:6px;
    border:1px solid var(--line); background:#0f1218; font:700 .7rem/1 Inter,system-ui
  }
}

/* ----------------------------- Astro demo --------------------------------*/
@layer astrology {
  .astro .astro-head{
    display:flex; align-items:center; gap:10px; margin-bottom:.8rem
  }
  .astro .seal{
    display:inline-flex; align-items:center; gap:.4rem; padding:.25rem .55rem;
    border-radius:10px; border:1px solid var(--line); background:#121827; font-weight:800
  }

  .astro-grid{
    display:grid; gap:14px; grid-template-columns:1fr; align-items:start
  }
  @media (min-width: 900px){
    .astro-grid{ grid-template-columns: 2fr 3fr }
  }

  .astro-chips{ display:flex; flex-wrap:wrap; gap:.5rem }
  .chip{
    display:inline-flex; align-items:center; gap:.45rem; padding:.45rem .65rem;
    border:1px solid var(--line); border-radius:999px; background:#101625; font-weight:800;
    transition: transform .12s ease, background-color .15s ease, box-shadow .15s ease;
  }
  .chip .dot{ width:.6rem; height:.6rem; border-radius:50% }
  .el-fire{   background:#ff7a7a33; box-shadow:0 0 0 2px #ff7a7a22 inset }
  .el-water{  background:#7af3ff33; box-shadow:0 0 0 2px #7af3ff22 inset }
  .el-air{    background:#aebaff33; box-shadow:0 0 0 2px #aebaff22 inset }
  .el-earth{  background:#9affc933; box-shadow:0 0 0 2px #9affc922 inset }
  .el-aether{ background:#d5b6ff33; box-shadow:0 0 0 2px #d5b6ff22 inset }

  .chip:hover{
    background:#0f1422; transform: translateY(-1px);
    box-shadow: 0 4px 18px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.04);
  }

  .astro-wheel{
    border:1px solid var(--line); border-radius:12px; background:
      radial-gradient(420px 280px at 50% -10%, rgba(122,243,255,.05), transparent 60%),
      #0f141f;
    padding:.6rem; position:relative;
  }

  /* Hebrew sigil vibe around wheel */
  .astro .seal::after{
    content:"⟡"; opacity:.7; transform: translateY(-1px);
  }

  .astro-aspects .asp-table{
    width:100%; border-collapse:separate; border-spacing:0; font-variant-numeric: tabular-nums
  }
  .asp-table thead th{
    position:sticky; top:0; background:#0e0e12; text-align:left; padding:.55rem .6rem; border-bottom:1px solid var(--line)
  }
  .asp-table tbody td{ padding:.45rem .6rem; border-bottom:1px solid #1a2130 }
}

/* ------------------------- Practices & Codex ----------------------------- */
@layer remnant {
  #practiceList{ display:grid; gap:.5rem; counter-reset: pr }
  #practiceList li{
    list-style:none; background:#101624; border:1px solid var(--line); border-radius:12px;
    padding:.6rem .7rem; box-shadow:var(--rim)
  }
  #noteText{
    width:100%; min-height:110px; resize:vertical; margin-top:.4rem;
    background:#0f1218; border:1px solid var(--line); color:var(--ink); border-radius:12px; padding:.6rem .7rem
  }

  .codex{ display:grid; grid-template-columns: 220px 1fr; gap:14px }
  .codex .codex-toc{
    position:sticky; top:12px; align-self:start;
    background:#0f1218; border:1px solid var(--line); border-radius:12px; padding:.6rem .7rem
  }
  .codex .codex-toc h4{ margin:.2rem 0 .4rem }
  .codex .codex-toc a{ text-decoration:none; font-weight:800 }
  .codex .codex-content{ min-height: 320px }
  .codex .lede{ font-size:1.05rem; opacity:.9 }

  @media (max-width: 900px){
    .codex{ grid-template-columns: 1fr }
    .codex .codex-toc{ position:static }
  }

  /* Ancient Hebrew verse pulse */
  #verseBox .he{ font-weight:900; letter-spacing:.5px; text-shadow:0 0 8px rgba(122,243,255,.12) }
  #verseBox .en{ opacity:.9 }
  #verseBox .meta{ color:var(--muted) }
  @media (prefers-reduced-motion: no-preference){
    #verseBox .he{ animation: sof-verse-pulse 5.5s ease-in-out infinite; }
  }
  @keyframes sof-verse-pulse{
    0%,100%{ text-shadow:0 0 6px rgba(122,243,255,.15); opacity:.95 }
    50%    { text-shadow:0 0 14px rgba(122,243,255,.35); opacity:1 }
  }
}

/* ----------------------------- Themes ----------------------------------- */
@layer remnant {
  body.theme-doot .ring .ring-fg{ stroke:#8aa8ff }
  body.theme-moon-1 .ring .ring-fg{ stroke:#6FE7FF }
  body.theme-moon-2 .ring .ring-fg{ stroke:#B1C7FF }
  body.theme-moon-3 .ring .ring-fg{ stroke:#7AF3FF }
  body.theme-moon-4 .ring .ring-fg{ stroke:#7BF3B8 }
  body.theme-moon-5 .ring .ring-fg{ stroke:#FFD27A }
  body.theme-moon-6 .ring .ring-fg{ stroke:#A7FFCF }
  body.theme-moon-7 .ring .ring-fg{ stroke:#D5B6FF }
  body.theme-moon-8 .ring .ring-fg{ stroke:#A8FFD9 }
  body.theme-moon-9 .ring .ring-fg{ stroke:#FFBC6F }
  body.theme-moon-10 .ring .ring-fg{ stroke:#A2FFD1 }
  body.theme-moon-11 .ring .ring-fg{ stroke:#A8B8FF }
  body.theme-moon-12 .ring .ring-fg{ stroke:#FFD7A8 }
  body.theme-moon-13 .ring .ring-fg{ stroke:#9DDAFF }
}

/* ----------------------- Starfield polish (canvas) ---------------------- */
/* The <canvas id="skyBg"> is driven by JS; this gives subtle blending. */
@layer remnant {
  #skyBg{
    mix-blend-mode: screen;
    opacity:.8;
    /* keep pointer-events:none from inline style */
  }
  @media (prefers-contrast: more){
    #skyBg{ opacity:.95 }
  }
}

/* ------------------------------ Focus/A11y ------------------------------ */
@layer components {
  :focus-visible{ outline:2px solid var(--accent); outline-offset:2px }
  .kbd{ background:#0f1218; border:1px solid var(--line); border-radius:6px; padding:.1rem .35rem }
}

/* -------------------------- Bridge accents (opt) ------------------------ */
/* If bridge.css defines custom accents, this ties astro gradients to them. */
@layer astrology {
  /* Fallback if SVG gradient stops are present in DOM (set by JS) */
  #awGrad stop:first-child { stop-color: var(--accent) }
  #awGrad stop:last-child  { stop-color: var(--accent-2) }
}
