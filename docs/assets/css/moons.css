@layer components {
  /* ========================= Ring badge ========================= */
  .ringcard{ display:grid; gap:10px }
  .moon-badge{ display:flex; align-items:center; gap:10px; flex-wrap:wrap }

  .ring{
    width:clamp(90px,26vw,120px); height:auto;
    display:grid; place-items:center; position:relative;
    isolation:isolate;
  }
  .ring .ring-bg{ fill:none; stroke:#142233; stroke-width:10 }
  /* Use themed accent; subtle glow ties to --spark */
  .ring .ring-fg{
    fill:none; stroke-linecap:round; stroke: var(--moon-accent);
    stroke-width:12;
    filter: drop-shadow(0 0 calc(6px + (var(--spark, .32) * 4px))
      color-mix(in oklch, var(--moon-accent) 60%, transparent));
    transition: stroke .25s ease;
  }
  .ring .label{
    position:absolute; inset:0; display:grid; place-items:center; font-weight:800
  }
  .ring .label .big{ font-size:clamp(1.1rem,6vw,1.6rem) }
  .ring .label .small{ font-size:.85rem; opacity:.75 }

  /* ========================= Week dots row ====================== */
  .weeklabel{ color:var(--muted) }
  .weekrow{ display:flex; align-items:center; gap:.6rem; overflow:auto; -webkit-overflow-scrolling:touch }
  .weekrow .wdots{ display:grid; grid-auto-flow:column; grid-auto-columns:min-content; gap:.35rem }
  .weekrow .wdot{
    width:.55rem; height:.55rem; border-radius:50%;
    background:#1b2231; flex:0 0 auto;
  }
  .weekrow .wdot.is-today{
    background: color-mix(in oklab, var(--moon-accent) 70%, #1b2231);
    box-shadow:0 0 0 2px color-mix(in lch, var(--moon-accent) 35%, transparent);
  }

  /* ========================= Remnant (13Ã—28) ==================== */
  .r-grid{
    --cell: clamp(36px, 9.5vw, 48px);
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:6px;
  }
  .r-grid .r-lbl{
    color:var(--muted); font-weight:600; text-align:center; font-size:.85rem;
  }
  .r-grid .r-day{
    min-height:var(--cell);
    border:1px solid var(--line); border-radius:10px;
    background:var(--bg-elev); display:flex; align-items:center; justify-content:center;
  }
  .r-grid .r-day > button{
    all:unset; display:grid; place-items:center; inline-size:100%; block-size:100%;
    font:600 .95rem/1 Inter,system-ui; color:var(--ink); cursor:pointer; border-radius:10px;
  }
  .r-grid .r-day.is-today{
    outline:2px solid var(--moon-accent); outline-offset:1px;
  }
  .r-grid .r-doot{
    min-height:calc(var(--cell) * 1.6); display:grid; place-items:center; text-align:center;
    border-radius:12px; border:1px solid color-mix(in oklab, var(--gold) 60%, var(--line));
    background:linear-gradient(180deg, color-mix(in lab, var(--gold) 10%, transparent), transparent);
    color:var(--ink);
  }

  /* ========================= Gregorian month ==================== */
  .g-grid{
    --cell: clamp(36px, 9.5vw, 48px);
    display:grid;
    grid-template-columns:repeat(7,1fr);
    gap:6px;
  }
  .g-lbl{
    color:var(--muted); font-weight:600; text-align:center; font-size:.85rem;
  }
  .g-pad{ min-height:var(--cell) }
  .g-day{
    min-height:var(--cell);
    border:1px solid var(--line); border-radius:10px; background:var(--bg-elev);
    display:flex; align-items:center; justify-content:center;
  }
  .g-day > button{
    all:unset; display:grid; place-items:center; inline-size:100%; block-size:100%;
    font:600 .95rem/1 Inter,system-ui; color:var(--ink); cursor:pointer; border-radius:10px;
  }
  .g-day.is-today{
    outline:2px solid var(--moon-accent); outline-offset:1px;
  }
  .g-month{ font-weight:700 }

  /* ========================= Legend keys ======================== */
  #calLegend .key{ display:inline-flex; align-items:center; gap:.35rem; margin-right:.6rem }
  #calLegend .k-dot{
    display:inline-block; width:.7em; height:.7em; border-radius:50%; vertical-align:middle;
  }
  #calLegend .k-evt1{ background: var(--moon-accent) }
  #calLegend .k-evt2{ background: var(--moon-accent-2) }
  #calLegend .k-doot{ background: var(--gold) }
  #calLegend .k-leap{ background: var(--moon-accent-2) }
  #calLegend .k-today{ background: color-mix(in oklab, var(--moon-accent) 60%, var(--ink)) }

  /* ========================= Year map table ===================== */
  .year-map{
    width:100%; border-collapse:separate; border-spacing:0;
    background:var(--bg-elev); border:1px solid var(--line); border-radius:12px; overflow:hidden;
  }
  .year-map thead th{
    position:sticky; top:0; background:linear-gradient(180deg, var(--bg-elev), color-mix(in lab, var(--moon-accent) 6%, var(--bg-elev)));
    text-align:left; padding:.6rem .75rem; font-weight:700; border-bottom:1px solid var(--line);
  }
  .year-map tbody td{ padding:.55rem .75rem; border-bottom:1px solid #1b2130 }
  .year-map tbody tr:last-child td{ border-bottom:0 }
  .year-map tbody tr:hover td{
    background:linear-gradient(90deg, color-mix(in lab, var(--moon-accent) 6%, transparent), transparent);
  }

  /* ========================= Verse / chips ====================== */
  blockquote.pull{
    border-left:3px solid var(--moon-accent); padding:.6rem .9rem; margin:0;
    background:linear-gradient(180deg, color-mix(in lab, var(--moon-accent) 6%, transparent), transparent);
    border-radius:10px;
  }
  .pill{
    display:inline-flex; align-items:center; gap:.4rem; padding:.3rem .6rem; border-radius:999px;
    background: color-mix(in lch, var(--moon-accent) 12%, transparent);
    box-shadow:0 0 0 1px color-mix(in lch, var(--moon-accent) 26%, transparent);
    font-weight:600;
  }
  .badge{ display:inline-flex; align-items:center; gap:.35rem; padding:.25rem .5rem; border-radius:999px; background:#151a25; border:1px solid #253048; font-weight:600 }

  /* ========================= Scroll helpers ===================== */
  .scroller{ overflow:auto; -webkit-overflow-scrolling:touch }
  .scroller::-webkit-scrollbar{ height:10px }
  .scroller::-webkit-scrollbar-thumb{ background:#2a3242; border-radius:10px }

  /* ========================= A11y / focus ======================= */
  :focus-visible{ outline:2px solid var(--moon-accent); outline-offset:2px }
  .g-day > button:focus-visible,
  .r-grid .r-day > button:focus-visible{ outline:2px solid var(--moon-accent); outline-offset:2px }
}
