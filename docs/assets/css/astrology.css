@layer astrology{
  /* ------------------------------------------
     Root tokens for the astrology module only
     ------------------------------------------ */
  .astro{
    /* inherits from global tokens if present */
    --moon-accent: var(--accent);
    --moon-accent-2: var(--gold);
    --astro-bg: var(--bg-elev);
    --astro-rim: var(--line);
    --astro-ink: var(--ink);
    --astro-muted: var(--muted);
    --astro-glow: color-mix(in oklch, var(--moon-accent) 65%, transparent);
    --astro-glow-2: color-mix(in oklch, var(--moon-accent-2) 65%, transparent);
    --astro-radius: 14px;
    --astro-pad: 14px;
  }

  /* ------------------------------------------
     Header
     ------------------------------------------ */
  .astro-head{
    display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:.6rem
  }
  .astro-head .seal{
    display:inline-flex;gap:.45rem;align-items:center;
    padding:.25rem .55rem;border-radius:999px;
    border:1px solid var(--astro-rim);
    background:linear-gradient(180deg,rgba(255,255,255,.03),transparent);
  }

  /* ------------------------------------------
     Grid
     ------------------------------------------ */
  .astro-grid{display:grid;grid-template-columns:1.05fr .95fr;gap:16px}
  @media (max-width:1024px){ .astro-grid{grid-template-columns:1fr} }

  /* ------------------------------------------
     Planet chips
     ------------------------------------------ */
  .astro-chips{display:flex;flex-wrap:wrap;gap:8px}
  .chip{
    border:1px solid var(--astro-rim);
    border-radius:999px;
    padding:.42rem .68rem;
    background:linear-gradient(180deg,rgba(255,255,255,.035),transparent);
    display:inline-flex;align-items:center;gap:.5rem;line-height:1;
    transition:background-color .12s ease,border-color .12s ease,transform .06s ease, box-shadow .12s ease;
    color:inherit;text-decoration:none;
    box-shadow:0 0 0 0 rgba(0,0,0,0);
  }
  .chip:hover{
    background:rgba(127,127,127,.10);
    border-color:color-mix(in oklch,var(--astro-rim) 60%, var(--moon-accent) 40%);
    box-shadow:0 0 0 1px color-mix(in oklch, var(--moon-accent) 38%, transparent) inset;
  }
  .chip:active{transform:translateY(1px)}
  .chip:focus-visible{outline:2px solid var(--moon-accent);outline-offset:2px}
  .chip[aria-pressed="true"], .chip.active{
    background:color-mix(in oklch,var(--moon-accent) 12%, transparent);
    border-color:color-mix(in oklch,var(--moon-accent) 65%, var(--astro-rim));
    box-shadow:0 0 0 2px color-mix(in oklch, var(--moon-accent) 30%, transparent) inset;
  }
  .chip .pos{opacity:.9}
  .chip .dot{display:inline-block;width:.72em;height:.72em;border-radius:50%;box-shadow:0 0 0 2px rgba(0,0,0,.15) inset}

  /* Element colors */
  .el-fire{background:#ff8a73}
  .el-water{background:#6fc6ff}
  .el-air{background:#a2b1ff}
  .el-earth{background:#a8e7b2}
  .el-aether{background:#e7d1ff}

  /* ------------------------------------------
     Wheel + labels + dots
     ------------------------------------------ */
  .astro-wheel{display:block;max-width:480px;margin-inline:auto}
  .astro-wheel svg{width:100%;height:auto;display:block}
  /* outer/inner rings */
  #astroWheel circle[stroke="#1b2231"]{stroke:#182235}
  #astroWheel circle[stroke-opacity]{stroke-opacity:.52}
  /* sign labels: crisp with subtle stroke for legibility */
  #signLabels text{
    fill:#b7c2de;font-weight:600;letter-spacing:.02em;
    paint-order:stroke;stroke:#0b0b0f;stroke-width:.9;
  }
  /* house lines slightly brighter */
  #houseLines{opacity:.9;stroke:#2a3242}

  /* planet dots with halo & hover scale */
  #planetDots .dot{
    transition:transform .12s ease, r .12s ease, filter .12s ease;
    filter:
      drop-shadow(0 0 .75px rgba(0,0,0,.7))
      drop-shadow(0 0 6px var(--astro-glow));
  }
  #planetDots .dot:hover{
    transform:scale(1.18);
    filter:
      drop-shadow(0 0 1px rgba(0,0,0,.75))
      drop-shadow(0 0 9px var(--astro-glow-2));
  }
  @media (prefers-reduced-motion: reduce){
    #planetDots .dot{transition:none}
  }

  /* ------------------------------------------
     Aspects legend + badges
     ------------------------------------------ */
  .astro-aspects .legend{display:flex;flex-wrap:wrap;gap:10px;margin:.55rem 0}
  .badge.asp{
    background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);
    border:1px solid var(--astro-rim);
    border-radius:10px;
    padding:.25rem .55rem;
  }
  .asp.conj{border-color:#b9b9b9}
  .asp.sext{border-color:#7ccfff}
  .asp.sqr{border-color:#ff9a7b}
  .asp.tri{border-color:#8be39f}
  .asp.opp{border-color:#c69bff}

  /* ------------------------------------------
     Aspects table (sticky head, zebra rows)
     ------------------------------------------ */
  .asp-table{
    display:block;max-width:100%;overflow:auto;border:1px solid var(--astro-rim);
    border-radius:12px;background:var(--astro-bg);
    box-shadow:0 10px 30px rgba(0,0,0,.22);
  }
  .asp-table table{min-width:560px;border-collapse:separate;border-spacing:0}
  .asp-table thead th{
    position:sticky;top:0;background:
      linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%),
      var(--astro-bg);
    color:var(--astro-muted);font-weight:700;text-align:left;
    padding:.58rem .68rem;border-bottom:1px solid var(--astro-rim);
    backdrop-filter:saturate(110%) blur(2px);
  }
  .asp-table tbody td{
    padding:.58rem .68rem;border-bottom:1px solid color-mix(in oklch,var(--astro-rim) 82%, transparent)
  }
  .asp-table tbody tr:nth-child(odd){background:color-mix(in oklch, var(--astro-bg) 88%, transparent)}
  .asp-table tbody tr:hover{background:rgba(127,127,127,.07)}
  .asp-table tbody tr:last-child td{border-bottom:none}
  .asp-table td:nth-child(3){text-align:right;font-variant-numeric:tabular-nums}

  /* ------------------------------------------
     Caption / meta line under the wheel
     ------------------------------------------ */
  .astro figcaption.meta{
    display:flex;flex-wrap:wrap;gap:.45rem;justify-content:center;
    margin-top:.45rem;color:var(--astro-muted)
  }
  .astro figcaption .sep{opacity:.35}

  /* ------------------------------------------
     High-contrast assist
     ------------------------------------------ */
  @media (prefers-contrast: more){
    #signLabels text{stroke-width:1.1}
    .chip{border-color:color-mix(in oklch,var(--astro-rim) 55%, white)}
    .asp-table{box-shadow:0 0 0 1px color-mix(in oklch,var(--astro-rim) 60%, white) inset}
  }

  /* ------------------------------------------
     Small helpers
     ------------------------------------------ */
  .astro .meta{color:var(--astro-muted)}
  .astro .mono{font-variant-numeric:tabular-nums}
}