@layer astrology{
  /* ------------------------------------------
     Root tokens (scoped to .astro only)
     ------------------------------------------ */
  .astro{
    --moon-accent: var(--accent);
    --moon-accent-2: var(--gold);
    --astro-bg: var(--bg-elev);
    --astro-rim: var(--line);
    --astro-ink: var(--ink);
    --astro-muted: var(--muted);
    --astro-glow: color-mix(in oklch, var(--moon-accent) 65%, transparent);
    --astro-glow-2: color-mix(in oklch, var(--moon-accent-2) 65%, transparent);
    --astro-radius: 14px;
    --astro-pad: 14px;
    --astro-gap: clamp(10px, 2vw, 16px);
    --astro-chip-pad-y: .5rem;
    --astro-chip-pad-x: .78rem;
  }

  /* ------------------------------------------
     Header
     ------------------------------------------ */
  .astro-head{
    display:flex;align-items:center;gap:12px;justify-content:space-between;margin-bottom:.6rem
  }
  .astro-head .seal{
    display:inline-flex;gap:.45rem;align-items:center;
    padding:.25rem .55rem;border-radius:999px;
    border:1px solid var(--astro-rim);
    background:linear-gradient(180deg,rgba(255,255,255,.03),transparent);
    font-size:clamp(.85rem, 1.6vw, .95rem);
    line-height:1.1;
  }

  /* ------------------------------------------
     Grid (chips + wheel)
     ------------------------------------------ */
  .astro-grid{
    display:grid;
    grid-template-columns:1.05fr .95fr;
    gap:var(--astro-gap);
  }
  @media (max-width:1024px){ .astro-grid{grid-template-columns:1fr} }

  /* ------------------------------------------
     Planet chips
     ------------------------------------------ */
  .astro-chips{
    display:flex;flex-wrap:wrap;gap:8px;
    align-items:flex-start;
  }
  .chip{
    border:1px solid var(--astro-rim);
    border-radius:999px;
    padding:var(--astro-chip-pad-y) var(--astro-chip-pad-x);
    background:linear-gradient(180deg,rgba(255,255,255,.035),transparent);
    display:inline-flex;align-items:center;gap:.55rem;line-height:1.1;
    transition:background-color .12s ease,border-color .12s ease,transform .06s ease, box-shadow .12s ease;
    color:inherit;text-decoration:none;
    box-shadow:0 0 0 0 rgba(0,0,0,0);
    min-height:40px;
    font-size:clamp(.85rem, 1.6vw, .95rem);
  }
  .chip:hover{
    background:rgba(127,127,127,.10);
    border-color:color-mix(in oklch,var(--astro-rim) 60%, var(--moon-accent) 40%);
    box-shadow:0 0 0 1px color-mix(in oklch, var(--moon-accent) 38%, transparent) inset;
  }
  .chip:active{transform:translateY(1px)}
  .chip:focus-visible{outline:2px solid var(--moon-accent);outline-offset:2px}
  .chip[aria-pressed="true"], .chip.active{
    background:color-mix(in oklch,var(--moon-accent) 12%, transparent);
    border-color:color-mix(in oklch,var(--moon-accent) 65%, var(--astro-rim));
    box-shadow:0 0 0 2px color-mix(in oklch, var(--moon-accent) 30%, transparent) inset;
  }
  .chip .pos{opacity:.9;font-variant-numeric:tabular-nums}
  .chip .dot{display:inline-block;width:.8em;height:.8em;border-radius:50%;box-shadow:0 0 0 2px rgba(0,0,0,.15) inset}

  /* Element colors */
  .el-fire{background:#ff8a73}
  .el-water{background:#6fc6ff}
  .el-air{background:#a2b1ff}
  .el-earth{background:#a8e7b2}
  .el-aether{background:#e7d1ff}

  /* Compact chips on very small screens */
  @media (max-width:420px){
    .chip{gap:.4rem; padding:.45rem .65rem}
    .chip b{display:none} /* keep labels minimal; icons + numbers hold space */
  }

  /* ------------------------------------------
     Wheel + labels + dots
     ------------------------------------------ */
  .astro-wheel{display:block;max-width:min(520px, 100%);margin-inline:auto}
  .astro-wheel svg{width:100%;height:auto;display:block}
  #astroWheel circle[stroke="#1b2231"]{stroke:#182235}
  #astroWheel circle[stroke-opacity]{stroke-opacity:.52}
  #signLabels text{
    fill:#b7c2de;font-weight:600;letter-spacing:.02em;
    paint-order:stroke;stroke:#0b0b0f;stroke-width:.9;
    user-select:none;
  }
  #houseLines{opacity:.9;stroke:#2a3242}

  /* planet dots with halo & hover scale */
  #planetDots .dot{
    transition:transform .12s ease, r .12s ease, filter .12s ease;
    filter:
      drop-shadow(0 0 .75px rgba(0,0,0,.7))
      drop-shadow(0 0 6px var(--astro-glow));
  }
  #planetDots .dot:hover{
    transform:scale(1.18);
    filter:
      drop-shadow(0 0 1px rgba(0,0,0,.75))
      drop-shadow(0 0 9px var(--astro-glow-2));
  }
  @media (prefers-reduced-motion: reduce){
    #planetDots .dot{transition:none}
  }

  /* ------------------------------------------
     Aspects legend + badges
     ------------------------------------------ */
  .astro-aspects .legend{
    display:flex;flex-wrap:wrap;gap:10px;margin:.55rem 0
  }
  .badge.asp{
    background:linear-gradient(180deg,rgba(255,255,255,.02),transparent);
    border:1px solid var(--astro-rim);
    border-radius:10px;
    padding:.25rem .55rem;
    white-space:nowrap;
    font-size:clamp(.8rem, 1.5vw, .9rem);
  }
  .asp.conj{border-color:#b9b9b9}
  .asp.sext{border-color:#7ccfff}
  .asp.sqr{border-color:#ff9a7b}
  .asp.tri{border-color:#8be39f}
  .asp.opp{border-color:#c69bff}

  /* ------------------------------------------
     Aspects table
     - supports two structures:
       (A) <table class="asp-table">…</table>  ← your current HTML
       (B) <div class="asp-table"><table>…</table></div>  (future-proof)
     ------------------------------------------ */
  .asp-table{
    display:block;
    max-width:100%;
    overflow:auto;
    border:1px solid var(--astro-rim);
    border-radius:12px;
    background:var(--astro-bg);
    box-shadow:0 10px 30px rgba(0,0,0,.22);
    -webkit-overflow-scrolling:touch;
  }
  /* If wrapper div used later */
  .asp-table table{width:100%;min-width:560px;border-collapse:separate;border-spacing:0}
  /* If table itself is the scroll container (current) */
  table.asp-table{min-width:560px;border-collapse:separate;border-spacing:0}

  .asp-table thead th{
    position:sticky;top:0;z-index:1;
    background:
      linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%),
      var(--astro-bg);
    color:var(--astro-muted);font-weight:700;text-align:left;
    padding:.58rem .68rem;border-bottom:1px solid var(--astro-rim);
    backdrop-filter:saturate(110%) blur(2px);
  }
  .asp-table tbody td{
    padding:.58rem .68rem;border-bottom:1px solid color-mix(in oklch,var(--astro-rim) 82%, transparent);
    font-size:clamp(.85rem, 1.5vw, .95rem);
  }
  .asp-table tbody tr:nth-child(odd){background:color-mix(in oklch, var(--astro-bg) 88%, transparent)}
  .asp-table tbody tr:hover{background:rgba(127,127,127,.07)}
  .asp-table tbody tr:last-child td{border-bottom:none}
  .asp-table td:nth-child(3){text-align:right;font-variant-numeric:tabular-nums}

  /* ------------------------------------------
     Caption / meta line under wheel
     ------------------------------------------ */
  .astro figcaption.meta{
    display:flex;flex-wrap:wrap;gap:.45rem;justify-content:center;
    margin-top:.45rem;color:var(--astro-muted);
    font-size:clamp(.82rem, 1.4vw, .9rem);
  }
  .astro figcaption .sep{opacity:.35}

  /* ------------------------------------------
     High-contrast / forced-colors / reduced data
     ------------------------------------------ */
  @media (prefers-contrast: more){
    #signLabels text{stroke-width:1.1}
    .chip{border-color:color-mix(in oklch,var(--astro-rim) 55%, white)}
    .asp-table{box-shadow:0 0 0 1px color-mix(in oklch,var(--astro-rim) 60%, white) inset}
  }
  @media (forced-colors: active){
    .chip, .asp-table, .badge.asp{border:1px solid CanvasText}
    #planetDots .dot{filter:none}
  }
  @media (prefers-reduced-data: reduce){
    #planetDots .dot{filter:none}
    .astro-wheel svg{image-rendering:pixelated}
  }

  /* ------------------------------------------
     Print cleanly
     ------------------------------------------ */
  @media print{
    .astro-head, .astro-chips button, .astro-aspects .legend{filter:grayscale(1)}
    .asp-table{box-shadow:none}
  }

  /* ------------------------------------------
     Small helpers
     ------------------------------------------ */
  .astro .meta{color:var(--astro-muted)}
  .astro .mono{font-variant-numeric:tabular-nums}
}