<!doctype html>
<html lang="en" dir="ltr" class="sof">
<head>
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <meta charset="utf-8" />
  <title>Remnant 13 Moons · Living Clock — Scroll of Fire</title>

  <!-- Viewport / color -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f">
  <meta name="color-scheme" content="dark" />
  <meta name="description" content="A Remnant-themed 13 Moon calendar — ancient wizard of YHWH aesthetics with day ring, week dots, year map, lunar simulation, numerology, optional Kin, share card, and .ics export." />

  <!-- Canonical + Social -->
  <link rel="canonical" href="https://ssnfts24.github.io/scroll-of-fire/moons.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Remnant 13 Moons · Living Clock — Scroll of Fire">
  <meta property="og:description" content="Which Moon am I in? Day ring, week dots, year map, DOOT handling, lunar sim, numerology, Kin, .ics export — Remnant / YHWH wizard theming.">
  <meta property="og:image" content="assets/share/moon-card.png">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA -->
  <link rel="manifest" href="assets/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="13 Moons">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Crimson+Pro:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Site + page CSS (your new skin) -->
  <link rel="stylesheet" href="assets/css/codex.css?v=2025-10-24">
  <link rel="stylesheet" href="assets/css/moons.css?v=2025-10-24">

  <!-- Small safety patch so text is never unreadable if CSS fails to load -->
  <style>
    .moonbar.contrast-light,.moonbar.contrast-light .tag,.moonbar.contrast-light button{color:#0b1220!important}
    .moonbar.contrast-light .mb-bg{stroke:#e1e8ff!important}
    .moonbar.contrast-light .mb-fg{filter:none!important}
    .lore-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:12px}
    @media (max-width:780px){.lore-grid{grid-template-columns:1fr}}
    .moon-media img{width:100%;height:auto;border-radius:12px;border:1px solid var(--line)}
    .prompts{padding-left:1.2rem}
    #noteText{width:100%;min-height:110px;border:1px solid var(--line);border-radius:10px;background:#0f1116;color:inherit;padding:.65rem}
  </style>

  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Remnant 13 Moons — Living Clock",
    "url":"https://ssnfts24.github.io/scroll-of-fire/moons.html",
    "applicationCategory":"Utility",
    "operatingSystem":"Any",
    "description":"Interactive 13-Moon calendar with Remnant / YHWH wizard theme: lunar phase simulation, numerology, Kin, and .ics export.",
    "creator":{"@type":"Person","name":"Aaron Paul Laird"}
  }
  </script>
</head>

<body class="stars remnant-yhwh">
  <!-- Hidden defs so JS can recolor gradients safely -->
  <svg width="0" height="0" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="mbGrad" x1="0" x2="1">
        <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
      </linearGradient>
      <linearGradient id="rg" x1="0" x2="1">
        <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- Living sky -->
  <canvas id="skyBg" width="1440" height="900" aria-hidden="true"></canvas>

  <!-- Compact Moon widget (always visible) -->
  <section class="wrap" aria-label="Remnant Moonbar">
    <div class="moonbar yhwh-on" data-size="compact" role="group" aria-label="Current Moon mini widget" style="display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;margin-bottom:10px;">
      <svg width="64" height="64" viewBox="0 0 64 64" aria-hidden="true">
        <circle cx="32" cy="32" r="26" class="mb-bg" stroke-width="6" fill="none"></circle>
        <circle cx="32" cy="32" r="26" class="mb-fg" id="moonArcMini" pathLength="163" stroke-width="6" stroke-linecap="round" fill="none" stroke-dasharray="0 163"></circle>
      </svg>
      <div class="moonbar-info">
        <div class="moonbar-line">
          <span class="tag yhwh" title="YHWH Seal">⟡ יהוה</span>
          <span id="mbName"><b>—</b></span>
          <span class="sep">·</span>
          <span id="mbEssence" class="meta">—</span>
        </div>
        <div class="moonbar-tags">
          <span class="tag"><span id="mbDay">—/28</span></span>
          <span class="tag">Year <span id="mbYear">—</span></span>
        </div>
      </div>
      <div class="moonbar-actions" style="display:flex;gap:8px">
        <button id="btnShareImage" class="moonbar-share" type="button" title="Make share card">Share</button>
        <label class="moonbar-tz" for="tzPick" title="Time Zone">TZ</label>
      </div>
    </div>
  </section>

  <main class="wrap" id="main" role="main">
    <header class="page-head fancy-head">
      <h1 class="title">🌗 Remnant 13 Moons — <em>Living Clock</em></h1>
      <p class="subtitle">An ancient-modern calendar in the cadence of 13×28. Phase-tinted, time-zone aware, and trimmed with the seal of <span lang="he" title="YHWH">יהוה</span>.</p>

      <nav class="crumbs" aria-label="Breadcrumb">
        <a class="lab-btn" href="index.html">← Back to Codex</a>
        <a class="lab-btn" href="theory.html">📘 Theory</a>
      </nav>

      <!-- Moon-first badge -->
      <section class="card shine" aria-label="Current Moon">
        <div class="moon-badge">
          <div class="ring" aria-label="Day in Moon">
            <svg viewBox="0 0 120 120" aria-hidden="true">
              <circle cx="60" cy="60" r="50" class="ring-bg"/>
              <circle cx="60" cy="60" r="50" class="ring-fg" id="moonArc" pathLength="316"/>
            </svg>
            <div class="label" aria-live="polite">
              <div class="big" id="dayInMoon">—</div>
              <div class="small">of 28</div>
            </div>
          </div>

          <span class="pill" id="moonChip">
            <span class="k" id="moonName">—</span>
            <span class="meta" id="moonEssence">—</span>
          </span>

          <span class="pill mono"><span id="yearSpan">—</span></span>
          <span class="pill" id="sourceChip" title="Source Seal">⟡ י־ה־ו־ה</span>
        </div>

        <div class="weekrow" aria-label="Week inside the 28-day moon">
          <span class="weeklabel">Week</span>
          <div class="week" id="weekDots" role="group" aria-label="Week dots (1–4 × 7)"></div>
        </div>

        <p class="meta" id="dootWarn" style="display:none;margin-top:8px">
          <b>Day Out of Time:</b> this day sits outside the 13×28 moons. Rest, reflect, reset.
        </p>
      </section>
    </header>

    <section class="grid" aria-label="Controls, Simulation, and Maps">
      <!-- Today + controls -->
      <article class="card col-8" aria-labelledby="today-head">
        <h2 id="today-head">Today</h2>
        <div class="lab-row" style="align-items:flex-end">
          <span class="pill"><b id="nowDate" aria-live="polite">—</b></span>
          <span class="pill mono" id="nowClock" aria-live="polite">—:—:—</span>
          <span class="pill" id="nowTZ">—</span>
          <span class="pill" id="moonLine">—</span>
        </div>
        <div class="lab-row" style="margin-top:8px">
          <label>Time Zone
            <select id="tzPick" class="lab-input" style="min-width:240px" aria-label="Time Zone"></select>
          </label>
          <label>Date
            <input type="date" id="datePick" class="lab-input" aria-label="Pick a date">
          </label>
          <label>Hour
            <input type="range" id="hourScrub" min="0" max="23" value="12" class="lab-input" style="width:160px" aria-label="Hour of day">
          </label>
          <button class="lab-btn" id="btnToday" type="button">Today</button>
          <button class="lab-btn" id="prevDay" type="button">← Prev</button>
          <button class="lab-btn" id="nextDay" type="button">Next →</button>
          <button class="lab-btn" id="shareLink" type="button">Copy Link</button>
          <label class="tag" style="margin-left:auto">Go to:
            <select id="jumpMoon" class="lab-input" style="min-width:140px;margin-left:6px" aria-label="Jump to Moon">
              <option value="">—</option>
              <option value="1">#1 Magnetic</option>
              <option value="2">#2 Lunar</option>
              <option value="3">#3 Electric</option>
              <option value="4">#4 Self-Existing</option>
              <option value="5">#5 Overtone</option>
              <option value="6">#6 Rhythmic</option>
              <option value="7">#7 Resonant</option>
              <option value="8">#8 Galactic</option>
              <option value="9">#9 Solar</option>
              <option value="10">#10 Planetary</option>
              <option value="11">#11 Spectral</option>
              <option value="12">#12 Crystal</option>
              <option value="13">#13 Cosmic</option>
            </select>
          </label>
        </div>
      </article>

      <!-- Lunar simulation & numerology -->
      <aside class="card col-4" aria-labelledby="lunar-head">
        <h2 id="lunar-head">Lunar Phase</h2>
        <div class="sim">
          <canvas id="simMoon" width="280" height="280" aria-label="Lunar phase"></canvas>
          <div>
            <p class="mono" id="phaseLine">—</p>
            <p class="meta" id="phaseMeta">—</p>
            <div class="divider" style="margin:8px 0" aria-hidden="true"></div>
            <h3 style="margin:.2rem 0">Numerology</h3>
            <p class="mono" id="numLine">—</p>
            <p class="meta" id="numMeta">—</p>
            <p class="meta" id="energyQuote" style="margin-top:6px">—</p>
          </div>
        </div>
      </aside>

      <!-- Year map -->
      <article class="card col-12" aria-labelledby="map-head">
        <h2 id="map-head">Year Map — Gregorian spans of the 13 Moons</h2>
        <p class="hint">New Year = July 26 · Day Out of Time = July 25 · Leap Day (Feb 29) is skipped in the 13×28 count.</p>
        <table class="year-map" id="yearMap">
          <thead>
            <tr><th>#</th><th>Moon Name</th><th>Essence</th><th>Start (TZ)</th><th>End (TZ)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="meta" id="nextMoonInfo" style="margin-top:6px">—</p>
      </article>

      <!-- Kin + ICS -->
      <article class="card col-12" aria-labelledby="kin-head">
        <h2 id="kin-head">Kin of Today (optional)</h2>
        <div class="kin">
          <div class="kin-row">
            <label class="tag"><input type="checkbox" id="kinOn" /><span style="margin-left:6px">Show Kin</span></label>
            <label class="tag">Epoch:
              <select id="kinEpoch" class="lab-input" style="margin-left:6px">
                <option value="1987-07-26">1987-07-26 (Dreamspell common)</option>
                <option value="1990-01-01">1990-01-01</option>
              </select>
            </label>
            <label class="tag"><input type="checkbox" id="kinSkipLeap" checked /><span style="margin-left:6px">Skip Leap Day</span></label>
            <label class="tag"><input type="checkbox" id="kinSkipDOOT" checked /><span style="margin-left:6px">Skip DOOT</span></label>
          </div>
          <div class="kin-row">
            <span class="tag" id="kinBadge">Kin —</span>
            <span class="meta" id="kinLine">—</span>
          </div>
          <small class="meta">Toggle options to match external calculators exactly.</small>
        </div>

        <div class="goldline" aria-hidden="true"></div>
        <h3 style="margin:.2rem 0">Export this 13-Moon Year</h3>
        <p class="meta">Download an <code>.ics</code> calendar with the 13 Moon spans for the selected time-zone/year.</p>
        <div class="lab-row">
          <a id="dlICS" class="dl" href="#" download="13-moon-year.ics" role="button">⬇️ Download .ics</a>
          <button class="lab-btn ghost" id="regenICS" type="button">Refresh</button>
        </div>
      </article>

      <!-- Practices -->
      <article class="card col-6" id="practiceCard" aria-labelledby="prac-head">
        <h2 id="prac-head">Practices & Prompts</h2>
        <ol id="practiceList" class="prompts"></ol>
        <label class="meta" for="noteText" style="display:block;margin-top:10px">Your note for this moon</label>
        <textarea id="noteText" placeholder="What are you tracking, learning, releasing?" aria-label="Note for this moon"></textarea>
        <div class="lab-row" style="margin-top:8px">
          <button class="lab-btn" id="btnSaveNote" type="button">Save note</button>
        </div>
      </article>

      <!-- Codex -->
      <section class="codex card shine" id="loreCodex" aria-label="Moon Codex">
        <aside class="codex-toc" aria-label="Codex contents">
          <h4>Codex</h4>
          <ol>
            <li><a href="#cx-intro">Introduction</a></li>
            <li><a href="#cx-practice">Practices</a></li>
            <li><a href="#cx-notes">Notes & Footnotes</a></li>
          </ol>
        </aside>

        <article class="codex-content">
          <h1 id="cx-intro">The Remnant Moon Codex</h1>
          <p class="lede dropcap">A living scroll of patterns, pulses, and presence—meant to be read like a sky.</p>

          <div class="callout info">
            <div class="head">Essence</div>
            <div class="body">Channel inspiration. Harmonize integrity. Perfect manifestation.</div>
          </div>

          <blockquote class="pull">“Number the days; crown the weeks; keep the remnant bright.”</blockquote>

          <figure>
            <img src="assets/media/codex-example.jpg" alt="Codex plate">
            <figcaption>Plate VII — Harmonics of the 13×28 count.</figcaption>
          </figure>

          <h2 id="cx-practice">Practice</h2>
          <p>Mark the day’s tone in your journal. Tap the <span class="kbd">T</span> key to step hours; <span class="kbd">↑/↓</span> to step days.</p>

          <h3 id="cx-notes">Notes & Footnotes</h3>
          <hr>
          <ol class="footnotes">
            <li id="fn1">On leap days and DOOT handling—see script options. <a href="#fnref1">↩</a></li>
          </ol>

          <!-- Example codex files -->
          <div class="codex-files" id="codexFiles">
            <div class="file" data-ext="PDF" role="button" tabindex="0">
              <div class="file-top">
                <div class="name">Codex · Resonant Harmonies</div>
                <span class="badge"><i class="dot" aria-hidden="true"></i> plate</span>
              </div>
              <div class="file-meta">
                <span class="pill">2.3 MB</span>
                <span class="pill">Updated this moon</span>
              </div>
            </div>

            <div class="file" data-ext="MD" role="button" tabindex="0">
              <div class="file-top">
                <div class="name">Codex · Praxis Notes</div>
                <span class="badge"><i class="dot"></i> notes</span>
              </div>
              <div class="file-meta">
                <span class="pill">12 min read</span>
                <span class="pill">v1.4</span>
              </div>
            </div>
          </div>
        </article>
      </section>
    </section>

    <footer class="footer">
      <div class="divider" aria-hidden="true"></div>
      <p class="meta">© <span id="yr">2025</span> Aaron Paul Laird — Scroll of Fire • BY-NC 4.0</p>
    </footer>
  </main>

  <noscript>
    <p class="meta" style="text-align:center">This page needs JavaScript to calculate moon/day, phase, and year map.</p>
  </noscript>

  <!-- Page JS (external; v3.9 fixes phase selector and drives accents) -->
  <script src="assets/js/moons.js?v=3.9" defer></script>

  <!-- Mini glue: keep moonbar mirrored, jump-to, share-card, notes, and Remnant veil -->
  <script>
  (function(){
    "use strict";

    // Cache pieces we mirror from the main badge
    const arcMain = document.getElementById("moonArc");
    const arcMini = document.getElementById("moonArcMini");
    const mbName  = document.getElementById("mbName");
    const mbDay   = document.getElementById("mbDay");
    const mbEss   = document.getElementById("mbEssence");
    const mbYear  = document.getElementById("mbYear");
    const noteBox = document.getElementById("noteText");
    const jumpSel = document.getElementById("jumpMoon");

    const moonChip   = document.getElementById("moonChip");
    const moonName   = document.getElementById("moonName");
    const moonEss    = document.getElementById("moonEssence");
    const dayInMoon  = document.getElementById("dayInMoon");
    const yearSpan   = document.getElementById("yearSpan");

    function syncMini(){
      if (mbName && moonName)  mbName.textContent = moonName.textContent || "—";
      if (mbEss  && moonEss)   mbEss.textContent  = moonEss.textContent  || "—";
      if (mbDay  && dayInMoon) mbDay.textContent  = (dayInMoon.textContent||"—") + "/28";
      if (mbYear && yearSpan)  mbYear.textContent = yearSpan.textContent || "—";

      const mainDash = arcMain?.getAttribute("stroke-dasharray");
      if (arcMini && mainDash) arcMini.setAttribute("stroke-dasharray", mainDash);

      // Load per-moon note
      const idx = moonChip?.getAttribute("data-idx");
      if (idx && noteBox){
        const saved = localStorage.getItem(`sof_moon_note_${idx}`) || "";
        if (noteBox.value !== saved) noteBox.value = saved;
      }
    }

    // Run once after moons.js paints, then observe changes
    setTimeout(syncMini, 60);
    const mo = new MutationObserver(syncMini);
    arcMain && mo.observe(arcMain, { attributes:true, attributeFilter:["stroke-dasharray"] });
    moonChip && mo.observe(moonChip, { childList:true, subtree:true, attributes:true });
    yearSpan && mo.observe(yearSpan, { childList:true, characterData:true, subtree:true });
    document.addEventListener("sof:accent-change", syncMini);

    // Jump-to-moon via hash (moons.js watches the hash)
    function jump(){ const v = jumpSel?.value; if (v){ location.hash = `#moon-${v}`; } }
    jumpSel?.addEventListener("change", jump, {passive:true});

    // Share image card (phase-tinted)
    function cssVar(name, fallback){ const s=getComputedStyle(document.documentElement).getPropertyValue(name).trim(); return s||fallback; }
    function dlBlob(name, blob){
      const a=document.createElement("a"); a.download=name; a.href=URL.createObjectURL(blob);
      document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 400);
    }
    async function makeShareCard(){
      const w=1080, h=1080, c=document.createElement("canvas"); c.width=w; c.height=h;
      const k=c.getContext("2d");
      const c1=cssVar("--moon-accent","#7af3ff"), c2=cssVar("--moon-accent-2","#f3c97a");

      // background
      const g=k.createLinearGradient(0,0,0,h); g.addColorStop(0,"#0a0e15"); g.addColorStop(1,"#06080d"); k.fillStyle=g; k.fillRect(0,0,w,h);
      const g2=k.createLinearGradient(0,0,w,0); g2.addColorStop(0,c1+"22"); g2.addColorStop(.5,c2+"18"); g2.addColorStop(1,c1+"22");
      k.fillStyle=g2; k.beginPath(); k.moveTo(0,240); for(let x=0;x<=w;x+=24){ k.lineTo(x,240+Math.sin(x*0.006)*20); } k.lineTo(w,0); k.lineTo(0,0); k.closePath(); k.fill();

      // title
      k.fillStyle="#e9eef6"; k.font="800 56px Inter, system-ui"; k.fillText("Remnant 13 Moons — Living Clock", 64, 112);

      // main chips
      const name=(moonName?.textContent||"—").trim();
      const essence=(moonEss?.textContent||"—").trim();
      const dayTxt=((dayInMoon?.textContent||"—").trim())+" / 28";
      const yearTxt=(yearSpan?.textContent||"—").trim();
      const sub=document.getElementById("phaseLine")?.textContent?.trim()||"";

      k.font="800 92px Inter, system-ui"; k.fillText(name, 64, 260);
      k.font="600 40px Inter, system-ui"; k.fillStyle="#c9d3e9"; k.fillText(essence, 64, 320);

      k.fillStyle="#0f1116"; k.strokeStyle="#2a3242"; k.lineWidth=2;
      function chip(x,y,txt){ const padX=18; k.font="800 38px Inter, system-ui";
        const mw=k.measureText(txt).width, cw=mw+padX*2, ch=56;
        k.beginPath(); k.roundRect(x,y,cw,ch,12); k.fill(); k.stroke();
        k.fillStyle="#e9eef6"; k.fillText(txt, x+padX, y+40); k.fillStyle="#0f1116"; return x+cw+10;
      }
      let cx=64; cx=chip(cx,370,dayTxt); cx=chip(cx,370,yearTxt); chip(cx,370, sub || "—");

      // footer
      k.font="600 32px Inter, system-ui"; k.fillStyle="#a8b1c9";
      k.fillText("scroll-of-fire · ssnfts24.github.io/scroll-of-fire", 64, h-64);

      const blob=await new Promise(res=>c.toBlob(res,"image/png",0.96)); if(blob) dlBlob(`13-moons-${name.replace(/\s+/g,"-").toLowerCase()}.png`, blob);
    }
    document.getElementById("btnShareImage")?.addEventListener("click", makeShareCard, {passive:true});

    // Save per-moon note
    document.getElementById("btnSaveNote")?.addEventListener("click", ()=>{
      const idx = moonChip?.getAttribute("data-idx"); if(!idx) return;
      localStorage.setItem(`sof_moon_note_${idx}`, noteBox?.value || "");
      const t=document.createElement("div"); t.className="toast"; t.textContent="Note saved";
      document.body.appendChild(t); requestAnimationFrame(()=>t.style.opacity=1);
      setTimeout(()=>{ t.style.opacity=0; setTimeout(()=>t.remove(),250); }, 1400);
    }, {passive:true});

    // A gentle “Remnant veil” that reacts when phase colors change
    function refreshVeil(){
      const c1=getComputedStyle(document.documentElement).getPropertyValue("--moon-accent").trim() || "#7af3ff";
      const c2=getComputedStyle(document.documentElement).getPropertyValue("--moon-accent-2").trim() || "#f3c97a";
      const veil=`conic-gradient(from 0deg at 50% 50%, ${c1}24, transparent, ${c2}20, transparent)`;
      document.documentElement.style.setProperty("--remnant-veil", veil);
    }
    document.addEventListener("sof:accent-change", refreshVeil);
    refreshVeil();
  })();
  </script>
</body>
</html>
