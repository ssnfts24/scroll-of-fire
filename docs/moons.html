<!doctype html>
<html lang="en" dir="ltr" class="sof">
<head>
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <meta charset="utf-8" />
  <title>13 Moons · Living Clock — Scroll of Fire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f">
  <meta name="color-scheme" content="dark" />
  <meta name="description" content="13-Moon Living Clock focused view: Which Moon am I in? Day ring + week dots, year map, Day Out of Time handling, lunar phase sim, numerology, Kin (optional), time-zone aware, shareable, .ics export." />

  <!-- Fonts + shared CSS -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Crimson+Pro:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Site + page CSS -->
  <link rel="stylesheet" href="assets/css/codex.css?v=2025-10-24">
  <link rel="stylesheet" href="assets/css/moons.css?v=2025-10-24">
</head>
<body class="stars">
  <!-- Hidden defs so JS can recolor both gradients safely -->
  <svg width="0" height="0" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="mbGrad" x1="0" x2="1">
        <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- Living sky -->
  <canvas id="skyBg" width="1440" height="900" aria-hidden="true"></canvas>

  <main class="wrap" id="main" role="main">
    <header class="page-head fancy-head">
      <h1 class="title">🌗 13 Moons — <em>Living Clock</em></h1>
      <p class="subtitle">Crystal-clear: Which Moon am I in? Day ring + week dots, year map, DOOT handling, lunar sim, numerology, optional Kin, .ics export.</p>

      <nav class="crumbs" aria-label="Breadcrumb">
        <a class="lab-btn" href="index.html">← Back to Codex</a>
        <a class="lab-btn" href="theory.html">📘 Theory</a>
      </nav>

      <!-- Moon-first badge -->
      <section class="card" aria-label="Current Moon">
        <div class="moon-badge">
          <div class="ring" aria-label="Day in Moon">
            <svg viewBox="0 0 120 120" aria-hidden="true">
              <defs>
                <!-- Ring gradient recolored by JS -->
                <linearGradient id="rg" x1="0" x2="1">
                  <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
                </linearGradient>
              </defs>
              <circle cx="60" cy="60" r="50" class="ring-bg"/>
              <circle cx="60" cy="60" r="50" class="ring-fg" id="moonArc" pathLength="316"/>
            </svg>
            <div class="label">
              <div class="big" id="dayInMoon">—</div>
              <div class="small">of 28</div>
            </div>
          </div>

          <span class="pill" id="moonChip">
            <span class="k" id="moonName">—</span>
            <span class="meta" id="moonEssence">—</span>
          </span>

          <span class="pill mono"><span id="yearSpan">—</span></span>
          <span class="pill" id="sourceChip" title="Source (YHWH)">⟡ י־ה־ו־ה</span>
        </div>

        <div class="weekrow" aria-label="Week inside the 28-day moon">
          <span class="weeklabel">Week</span>
          <div class="week" id="weekDots" role="group" aria-label="Week dots (1–4 × 7)"></div>
        </div>

        <p class="meta" id="dootWarn" style="display:none;margin-top:8px">
          <b>Day Out of Time:</b> this day sits outside the 13×28 moons. Rest, reflect, reset.
        </p>
      </section>
    </header>

    <section class="grid">
      <!-- Today + controls -->
      <article class="card col-8" aria-labelledby="today-head">
        <h2 id="today-head">Today</h2>
        <div class="lab-row" style="align-items:flex-end">
          <span class="pill"><b id="nowDate">—</b></span>
          <span class="pill mono" id="nowClock">—:—:—</span>
          <span class="pill" id="nowTZ">—</span>
          <span class="pill" id="moonLine">—</span>
        </div>
        <div class="lab-row" style="margin-top:8px">
          <label>Time Zone
            <select id="tzPick" class="lab-input" style="min-width:240px"></select>
          </label>
          <label>Date
            <input type="date" id="datePick" class="lab-input">
          </label>
          <label>Hour
            <input type="range" id="hourScrub" min="0" max="23" value="12" class="lab-input" style="width:160px">
          </label>
          <button class="lab-btn" id="btnToday" type="button">Today</button>
          <button class="lab-btn" id="prevDay" type="button">← Prev</button>
          <button class="lab-btn" id="nextDay" type="button">Next →</button>
          <button class="lab-btn" id="shareLink" type="button">Copy Link</button>
        </div>
      </article>

      <!-- Lunar simulation & numerology -->
      <aside class="card col-4">
        <h2>Lunar Phase</h2>
        <div class="sim">
          <canvas id="simMoon" width="280" height="280" aria-label="Lunar phase"></canvas>
          <div>
            <p class="mono" id="phaseLine">—</p>
            <p class="meta" id="phaseMeta">—</p>
            <div class="divider" style="margin:8px 0" aria-hidden="true"></div>
            <h3 style="margin:.2rem 0">Numerology</h3>
            <p class="mono" id="numLine">—</p>
            <p class="meta" id="numMeta">—</p>
            <p class="meta" id="energyQuote" style="margin-top:6px">—</p>
          </div>
        </div>
      </aside>

      <!-- Year map -->
      <article class="card col-12">
        <h2>Year Map — Gregorian spans of the 13 Moons</h2>
        <p class="hint">New Year = July 26 · Day Out of Time = July 25 · Leap Day (Feb 29) is skipped in the 13×28 count.</p>
        <table class="year-map" id="yearMap">
          <thead>
            <tr><th>#</th><th>Moon Name</th><th>Essence</th><th>Start (TZ)</th><th>End (TZ)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="meta" id="nextMoonInfo" style="margin-top:6px">—</p>
      </article>

      <!-- Kin + ICS -->
      <article class="card col-12" aria-labelledby="kin-head">
        <h2 id="kin-head">Kin of Today (optional)</h2>
        <div class="kin">
          <div class="kin-row">
            <label class="tag"><input type="checkbox" id="kinOn" /><span style="margin-left:6px">Show Kin</span></label>
            <label class="tag">Epoch:
              <select id="kinEpoch" class="lab-input" style="margin-left:6px">
                <option value="1987-07-26">1987-07-26 (Dreamspell common)</option>
                <option value="1990-01-01">1990-01-01</option>
              </select>
            </label>
            <label class="tag"><input type="checkbox" id="kinSkipLeap" checked /><span style="margin-left:6px">Skip Leap Day</span></label>
            <label class="tag"><input type="checkbox" id="kinSkipDOOT" checked /><span style="margin-left:6px">Skip DOOT</span></label>
          </div>
          <div class="kin-row">
            <span class="tag" id="kinBadge">Kin —</span>
            <span class="meta" id="kinLine">—</span>
          </div>
          <small class="meta">Toggle options to match external calculators exactly.</small>
        </div>

        <div class="goldline" aria-hidden="true"></div>
        <h3 style="margin:.2rem 0">Export this 13-Moon Year</h3>
        <p class="meta">Download an <code>.ics</code> calendar with the 13 Moon spans for the selected time-zone/year.</p>
        <div class="lab-row">
          <a id="dlICS" class="dl" href="#" download="13-moon-year.ics" role="button">⬇️ Download .ics</a>
          <button class="lab-btn ghost" id="regenICS" type="button">Refresh</button>
        </div>
      </article>
    </section>

    <footer class="footer">
      <div class="divider" aria-hidden="true"></div>
      <p class="meta">© <span id="yr">2025</span> Aaron Paul Laird — Scroll of Fire • BY-NC 4.0</p>
    </footer>
  </main>

  <noscript>
    <p class="meta" style="text-align:center">This page needs JavaScript to calculate moon/day, phase, and year map.</p>
  </noscript>

  <!-- Page JS (external; avoids inline truncation) -->
  <script src="assets/js/moons.js?v=2025-10-24" defer></script>
</body>
</html>
