<!doctype html>
<html lang="en" dir="ltr" class="sof" data-alive="lively">
<head>
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <meta charset="utf-8" />
  <title>Remnant 13 Moons ¬∑ Living Clock ‚Äî Scroll of Fire</title>

  <!-- Viewport / theme / color -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#05070d" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#f7fbff" media="(prefers-color-scheme: light)">
  <meta name="color-scheme" content="dark light" />
  <meta name="description" content="A Remnant-themed 13 Moon calendar ‚Äî Ancient Wizard of YHWH aesthetics with day ring, week dots, year map, lunar simulation, numerology, optional Kin, share card, and .ics export." />

  <!-- Canonical + Social -->
  <link rel="canonical" href="https://ssnfts24.github.io/scroll-of-fire/moons.html">
  <meta property="og:type" content="website">
  <meta property="og:title" content="Remnant 13 Moons ¬∑ Living Clock ‚Äî Scroll of Fire">
  <meta property="og:description" content="Which Moon am I in? Day ring, week dots, year map, DOOT handling, lunar sim, numerology, Kin, .ics export ‚Äî Remnant / YHWH wizard theming.">
  <meta property="og:image" content="assets/share/moon-card.png">
  <meta property="og:url" content="https://ssnfts24.github.io/scroll-of-fire/moons.html">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA -->
  <link rel="manifest" href="assets/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="13 Moons">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/icons/icon-512.png">
  <link rel="mask-icon" href="assets/icons/safari-pinned.svg" color="#0e131a">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Crimson+Pro:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Site + page CSS (v4.1) -->
  <link rel="stylesheet" href="assets/css/codex.css?v=2025-10-24">
  <link rel="stylesheet" href="assets/css/moons.css?v=2025-10-24">

  <!-- Critical safety patch so text stays readable if CSS fails / FB IAB white flash -->
  <style>
    html,body{background:#05070d!important;color:#eaf1ff}
    .moonbar.contrast-light,.moonbar.contrast-light .tag,.moonbar.contrast-light button{color:#0b1220!important}
    .moonbar.contrast-light .mb-bg{stroke:#e1e8ff!important}
    .moonbar.contrast-light .mb-fg{filter:none!important}
    .lore-grid{display:grid;grid-template-columns:1.2fr .8fr;gap:12px}
    @media (max-width:780px){.lore-grid{grid-template-columns:1fr}}
    .moon-media img{width:100%;height:auto;border-radius:12px;border:1px solid var(--line)}
    .prompts{padding-left:1.2rem}
    #noteText{width:100%;min-height:110px;border:1px solid var(--line);border-radius:10px;background:#0f1116;color:inherit;padding:.65rem}
    /* Remnant opener */
    .remnant-opener{position:relative;overflow:hidden}
    .op-grid{display:grid;grid-template-columns:auto 1fr auto;gap:12px;align-items:center}
    .op-sigil{width:64px;height:64px;filter:drop-shadow(0 0 8px color-mix(in srgb, var(--moon-accent) 30%, transparent))}
    .op-title{margin:0;font:800 20px/1.15 "Crimson Pro",serif;letter-spacing:.2px}
    .op-sub{margin:.25rem 0 0}
    .lab-btn.big{padding:.8rem 1.1rem;font-weight:900}
    .cta-link{text-decoration:none;color:inherit}
    @media (max-width:720px){.op-grid{grid-template-columns:auto 1fr;gap:10px}.op-right{grid-column:1/-1}}
  </style>

  <!-- FB in-app browser guard: add .is-fbapp to <html> -->
  <script>
    (function(){
      var ua=navigator.userAgent||"";
      if(/\bFBAN|FBAV|FB_IAB|FBAN\/Messenger\b/i.test(ua)){ document.documentElement.classList.add('is-fbapp'); }
    })();
  </script>

  <!-- Resource hints -->
  <link rel="prefetch" href="genesis-oracle.html" as="document">
  <link rel="preload" href="assets/js/moons.js?v=3.9" as="script" crossorigin>
  <script src="assets/js/astro-panel.js?v=2.1" defer></script>
  <!-- Structured data -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"WebApplication",
    "name":"Remnant 13 Moons ‚Äî Living Clock",
    "url":"https://ssnfts24.github.io/scroll-of-fire/moons.html",
    "applicationCategory":"Utility",
    "operatingSystem":"Any",
    "description":"Interactive 13-Moon calendar with Remnant / YHWH wizard theme: lunar phase simulation, numerology, Kin, and .ics export.",
    "creator":{"@type":"Person","name":"Aaron Paul Laird"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"BreadcrumbList",
    "itemListElement":[
      {"@type":"ListItem","position":1,"name":"Codex","item":"https://ssnfts24.github.io/scroll-of-fire/index.html"},
      {"@type":"ListItem","position":2,"name":"13 Moons","item":"https://ssnfts24.github.io/scroll-of-fire/moons.html"}
    ]
  }
  </script>
</head>

<body class="stars remnant-yhwh">
  <!-- Hidden defs so JS can recolor gradients safely -->
  <svg width="0" height="0" aria-hidden="true" focusable="false">
    <defs>
      <linearGradient id="mbGrad" x1="0" x2="1">
        <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
      </linearGradient>
      <linearGradient id="rg" x1="0" x2="1">
        <stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/>
      </linearGradient>
    </defs>
  </svg>

  <!-- Living sky -->
  <canvas id="skyBg" width="1440" height="900" aria-hidden="true"></canvas>

  <!-- Compact Moon widget (always visible) -->
  <section class="wrap" aria-label="Remnant Moonbar">
    <div class="moonbar yhwh-on" data-size="compact" role="group" aria-label="Current Moon mini widget" style="display:grid;grid-template-columns:auto 1fr auto;gap:10px;align-items:center;margin-bottom:10px;">
      <svg width="64" height="64" viewBox="0 0 64 64" aria-hidden="true">
        <circle cx="32" cy="32" r="26" class="mb-bg" stroke-width="6" fill="none"></circle>
        <circle cx="32" cy="32" r="26" class="mb-fg" id="moonArcMini" pathLength="163" stroke-width="6" stroke-linecap="round" fill="none" stroke-dasharray="0 163"></circle>
      </svg>
      <div class="moonbar-info">
        <div class="moonbar-line">
          <span class="tag yhwh" title="YHWH Seal">‚ü° <span lang="he">◊ô◊î◊ï◊î</span></span>
          <span id="mbName"><b>‚Äî</b></span>
          <span class="sep" aria-hidden="true">¬∑</span>
          <span id="mbEssence" class="meta">‚Äî</span>
        </div>
        <div class="moonbar-tags">
          <span class="tag"><span id="mbDay">‚Äî/28</span></span>
          <span class="tag">Year <span id="mbYear">‚Äî</span></span>
        </div>
      </div>
      <div class="moonbar-actions" style="display:flex;gap:8px">
        <button id="btnShareImage" class="moonbar-share" type="button" title="Make share card">Share</button>
        <label class="moonbar-tz" for="tzPick" title="Time Zone">TZ</label>
      </div>
    </div>
  </section>

  <!-- Remnant Opener ‚Äî The Seal of Becoming (Birth Reader portal) -->
  <section id="remnantOpener" class="wrap">
    <div class="remnant-opener card remnant-frame" aria-label="Open the Remnant Birth Seal" style="margin:10px 0">
      <div class="op-grid">
        <div class="op-left">
          <svg class="op-sigil" viewBox="0 0 64 64" aria-hidden="true">
            <defs>
              <linearGradient id="opGrad" x1="0" x2="1">
                <stop offset="0" stop-color="var(--moon-accent)"/>
                <stop offset="1" stop-color="var(--moon-accent-2)"/>
              </linearGradient>
            </defs>
            <circle cx="32" cy="32" r="26" fill="none" stroke="#1b2231" stroke-width="6"/>
            <circle cx="32" cy="32" r="26" fill="none" stroke="url(#opGrad)" stroke-linecap="round" stroke-width="6" stroke-dasharray="78 163"></circle>
            <text x="32" y="32" text-anchor="middle" dominant-baseline="central" font-family="Inter,system-ui" font-size="16" font-weight="900" fill="currentColor">‚ü°</text>
          </svg>
        </div>

        <div class="op-mid">
          <h3 class="op-title">The Seal of Becoming</h3>
          <p class="op-sub meta">
            Remnant Birth Seal ‚Äî reads your <b>Moon ‚Ä¢ Day ‚Ä¢ Week ‚Ä¢ Tone</b> and <b>Name code</b>, with Resonant sums and carrier skin.
          </p>
          <small class="meta">Uses your selected date &amp; timezone (or today) to prefill.</small>
        </div>

        <div class="op-right">
          <!-- Use <a> so long-press can ‚ÄúOpen in new tab‚Äù on mobile -->
          <a id="openSeal" class="lab-btn big cta-link" href="genesis-oracle.html" aria-describedby="opHelp">Open Birth Seal</a>
          <p id="opHelp" class="meta" style="margin:.35rem 0 0">Deep link carries date/time/tz ‚Üí <span class="mono">genesis-oracle.html</span></p>
        </div>
      </div>
    </div>
  </section>

  <main class="wrap" id="main" role="main">
    <header class="page-head fancy-head">
      <h1 class="title">üåó Remnant 13 Moons ‚Äî <em>Living Clock</em></h1>
      <p class="subtitle">
        An ancient-modern calendar in the cadence of 13√ó28. Phase-tinted, time-zone aware, and trimmed with the seal of
        <span lang="he" title="YHWH">◊ô◊î◊ï◊î</span>.
      </p>

      <nav class="crumbs" aria-label="Breadcrumb">
        <a class="lab-btn" href="index.html">‚Üê Back to Codex</a>
        <a class="lab-btn" href="theory.html">üìò Theory</a>
        <!-- Header CTA mirrors the opener button for quick access -->
        <a id="openSealHeader" class="lab-btn" href="genesis-oracle.html" title="Open the Remnant Birth Seal">‚ü° Birth Seal</a>
      </nav>

      <!-- Moon-first badge -->
      <section class="card shine" aria-label="Current Moon">
        <div class="moon-badge">
          <div class="ring" aria-label="Day in Moon">
            <svg viewBox="0 0 120 120" aria-hidden="true">
              <circle cx="60" cy="60" r="50" class="ring-bg"/>
              <circle cx="60" cy="60" r="50" class="ring-fg" id="moonArc" pathLength="316"/>
            </svg>
            <div class="label" aria-live="polite">
              <div class="big" id="dayInMoon">‚Äî</div>
              <div class="small">of 28</div>
            </div>
          </div>

          <span class="pill" id="moonChip">
            <span class="k" id="moonName">‚Äî</span>
            <span class="meta" id="moonEssence">‚Äî</span>
          </span>

          <span class="pill mono"><span id="yearSpan">‚Äî</span></span>
          <span class="pill" id="sourceChip" title="Source Seal">‚ü° ◊ô÷æ◊î÷æ◊ï÷æ◊î</span>
        </div>

        <div class="weekrow" aria-label="Week inside the 28-day moon">
          <span class="weeklabel">Week</span>
          <div class="week" id="weekDots" role="group" aria-label="Week dots (1‚Äì4 √ó 7)"></div>
        </div>

        <p class="meta" id="dootWarn" style="display:none;margin-top:8px">
          <b>Day Out of Time:</b> this day sits outside the 13√ó28 moons. Rest, reflect, reset.
        </p>
      </section>
    </header>

    <section class="grid" aria-label="Controls, Simulation, and Maps">
      <!-- Today + controls -->
      <article class="card col-8" aria-labelledby="today-head">
        <h2 id="today-head">Today</h2>
        <div class="lab-row" style="align-items:flex-end">
          <span class="pill"><b id="nowDate" aria-live="polite">‚Äî</b></span>
          <span class="pill mono" id="nowClock" aria-live="polite">‚Äî:‚Äî:‚Äî</span>
          <span class="pill" id="nowTZ">‚Äî</span>
          <span class="pill" id="moonLine">‚Äî</span>
        </div>
        <div class="lab-row" style="margin-top:8px">
          <label>Time Zone
            <select id="tzPick" class="lab-input" style="min-width:240px" aria-label="Time Zone"></select>
          </label>
          <label>Date
            <input type="date" id="datePick" class="lab-input" aria-label="Pick a date">
          </label>
          <label>Hour
            <input type="range" id="hourScrub" min="0" max="23" value="12" class="lab-input" style="width:160px" aria-label="Hour of day">
          </label>
          <button class="lab-btn" id="btnToday" type="button">Today</button>
          <button class="lab-btn" id="prevDay" type="button">‚Üê Prev</button>
          <button class="lab-btn" id="nextDay" type="button">Next ‚Üí</button>
          <button class="lab-btn" id="shareLink" type="button">Copy Link</button>
          <label class="tag" style="margin-left:auto">Go to:
            <select id="jumpMoon" class="lab-input" style="min-width:140px;margin-left:6px" aria-label="Jump to Moon">
              <option value="">‚Äî</option>
              <option value="1">#1 Magnetic</option>
              <option value="2">#2 Lunar</option>
              <option value="3">#3 Electric</option>
              <option value="4">#4 Self-Existing</option>
              <option value="5">#5 Overtone</option>
              <option value="6">#6 Rhythmic</option>
              <option value="7">#7 Resonant</option>
              <option value="8">#8 Galactic</option>
              <option value="9">#9 Solar</option>
              <option value="10">#10 Planetary</option>
              <option value="11">#11 Spectral</option>
              <option value="12">#12 Crystal</option>
              <option value="13">#13 Cosmic</option>
            </select>
          </label>
        </div>
      </article>

      <!-- Lunar simulation & numerology -->
      <aside class="card col-4" aria-labelledby="lunar-head">
        <h2 id="lunar-head">Lunar Phase</h2>
        <div class="sim">
          <canvas id="simMoon" width="280" height="280" aria-label="Lunar phase"></canvas>
          <div>
            <p class="mono" id="phaseLine">‚Äî</p>
            <p class="meta" id="phaseMeta">‚Äî</p>
            <div class="divider" style="margin:8px 0" aria-hidden="true"></div>
            <h3 style="margin:.2rem 0">Numerology</h3>
            <p class="mono" id="numLine">‚Äî</p>
            <p class="meta" id="numMeta">‚Äî</p>
            <p class="meta" id="energyQuote" style="margin-top:6px">‚Äî</p>
          </div>
        </div>
      </aside>

      <!-- Year map -->
      <article class="card col-12" aria-labelledby="map-head">
        <h2 id="map-head">Year Map ‚Äî Gregorian spans of the 13 Moons</h2>
        <p class="hint">New Year = July 26 ¬∑ Day Out of Time = July 25 ¬∑ Leap Day (Feb 29) is skipped in the 13√ó28 count.</p>
        <table class="year-map" id="yearMap">
          <thead>
            <tr><th>#</th><th>Moon Name</th><th>Essence</th><th>Start (TZ)</th><th>End (TZ)</th></tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="meta" id="nextMoonInfo" style="margin-top:6px">‚Äî</p>
      </article>

      <!-- Kin + ICS -->
      <article class="card col-12" aria-labelledby="kin-head">
        <h2 id="kin-head">Kin of Today (optional)</h2>
        <div class="kin">
          <div class="kin-row">
            <label class="tag"><input type="checkbox" id="kinOn" /><span style="margin-left:6px">Show Kin</span></label>
            <label class="tag">Epoch:
              <select id="kinEpoch" class="lab-input" style="margin-left:6px">
                <option value="1987-07-26">1987-07-26 (Dreamspell common)</option>
                <option value="1990-01-01">1990-01-01</option>
              </select>
            </label>
            <label class="tag"><input type="checkbox" id="kinSkipLeap" checked /><span style="margin-left:6px">Skip Leap Day</span></label>
            <label class="tag"><input type="checkbox" id="kinSkipDOOT" checked /><span style="margin-left:6px">Skip DOOT</span></label>
          </div>
          <div class="kin-row">
            <span class="tag" id="kinBadge">Kin ‚Äî</span>
            <span class="meta" id="kinLine">‚Äî</span>
          </div>
          <small class="meta">Toggle options to match external calculators exactly.</small>
        </div>

        <div class="goldline" aria-hidden="true"></div>
        <h3 style="margin:.2rem 0">Export this 13-Moon Year</h3>
        <p class="meta">Download an <code>.ics</code> calendar with the 13 Moon spans for the selected time-zone/year.</p>
        <div class="lab-row">
          <a id="dlICS" class="dl" href="#" download="13-moon-year.ics" role="button">‚¨áÔ∏è Download .ics</a>
          <button class="lab-btn ghost" id="regenICS" type="button">Refresh</button>
        </div>
      </article>

      <article class="card col-12 shine astro" aria-labelledby="astro-head">
  <header class="astro-head">
    <span class="seal" aria-hidden="true">‚ü° <span lang="he">◊ô◊î◊ï◊î</span></span>
    <h2 id="astro-head">Astrology Now</h2>
    <p class="meta">Current sky placements in a lightweight, Remnant panel. Your ephemeris code fills the chips, wheel, and aspects via the hooks below.</p>
  </header>

  <section class="astro-grid" aria-label="Current placements and wheel">
    <!-- Left: planet chips -->
    <div class="astro-chips" role="list">
      <button class="chip" role="listitem" data-planet="sun"    aria-live="polite"><i class="dot el-fire"></i><b>Sun</b>    <span class="mono pos"  data-pos="sun">‚Äî</span>    <span class="sign" data-sign="sun">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="moon"   aria-live="polite"><i class="dot el-water"></i><b>Moon</b>  <span class="mono pos"  data-pos="moon">‚Äî</span>   <span class="sign" data-sign="moon">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="mercury"><i class="dot el-air"></i><b>Mercury</b> <span class="mono pos" data-pos="mercury">‚Äî</span> <span class="sign" data-sign="mercury">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="venus"  ><i class="dot el-earth"></i><b>Venus</b>   <span class="mono pos" data-pos="venus">‚Äî</span>   <span class="sign" data-sign="venus">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="mars"   ><i class="dot el-fire"></i><b>Mars</b>     <span class="mono pos" data-pos="mars">‚Äî</span>    <span class="sign" data-sign="mars">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="jupiter"><i class="dot el-air"></i><b>Jupiter</b>  <span class="mono pos" data-pos="jupiter">‚Äî</span> <span class="sign" data-sign="jupiter">‚Äî</span></button>
      <button class="chip" role="listitem" data-planet="saturn" ><i class="dot el-earth"></i><b>Saturn</b>  <span class="mono pos" data-pos="saturn">‚Äî</span>  <span class="sign" data-sign="saturn">‚Äî</span></button>

      <details class="chip more">
        <summary><i class="dot el-aether"></i><b>Outer bodies</b></summary>
        <div class="more-grid">
          <div><b>Uranus</b>  <span class="mono pos" data-pos="uranus">‚Äî</span>  <span class="sign" data-sign="uranus">‚Äî</span></div>
          <div><b>Neptune</b> <span class="mono pos" data-pos="neptune">‚Äî</span> <span class="sign" data-sign="neptune">‚Äî</span></div>
          <div><b>Pluto</b>   <span class="mono pos" data-pos="pluto">‚Äî</span>   <span class="sign" data-sign="pluto">‚Äî</span></div>
          <div><b>Chiron</b>  <span class="mono pos" data-pos="chiron">‚Äî</span>  <span class="sign" data-sign="chiron">‚Äî</span></div>
          <div><b>Node ‚òä</b>  <span class="mono pos" data-pos="north_node">‚Äî</span> <span class="sign" data-sign="north_node">‚Äî</span></div>
        </div>
      </details>
    </div>

    <!-- Right: sacred wheel -->
    <figure class="astro-wheel">
      <svg id="astroWheel" viewBox="0 0 360 360" role="img" aria-label="Zodiac wheel">
        <defs>
          <linearGradient id="awGrad" x1="0" y1="0" x2="1" y2="1">
            <stop offset="0" stop-color="var(--moon-accent)"/><stop offset="1" stop-color="var(--moon-accent-2)"/>
          </linearGradient>
        </defs>
        <circle cx="180" cy="180" r="162" fill="none" stroke="#1b2231" stroke-width="2"/>
        <circle cx="180" cy="180" r="150" fill="none" stroke="url(#awGrad)" stroke-opacity=".45" stroke-width="2"/>
        <g id="houseLines" stroke="#2a3242" stroke-width=".8" opacity=".9"></g>
        <g id="signLabels" fill="#a7b1ca" font-family="Inter,system-ui" font-size="10" text-anchor="middle"></g>
        <g id="planetDots">
          <circle r="4.6" class="dot el-fire"   data-dot="sun"    cx="180" cy="30"/>
          <circle r="4.6" class="dot el-water"  data-dot="moon"   cx="180" cy="330"/>
          <circle r="4.6" class="dot el-air"    data-dot="mercury" cx="30"  cy="180"/>
          <circle r="4.6" class="dot el-earth"  data-dot="venus"   cx="330" cy="180"/>
          <circle r="4.6" class="dot el-fire"   data-dot="mars"    cx="60"  cy="60"/>
          <circle r="4.6" class="dot el-air"    data-dot="jupiter" cx="300" cy="300"/>
          <circle r="4.6" class="dot el-earth"  data-dot="saturn"  cx="60"  cy="300"/>
        </g>
      </svg>
      <figcaption class="meta">
        <span id="astroStamp">‚Äî</span><span class="sep">¬∑</span>
        <span id="astroTZ">‚Äî</span><span class="sep">¬∑</span>
        Source: <span id="astroSource">‚Äî</span>
      </figcaption>
    </figure>
  </section>

  <section class="astro-aspects" aria-labelledby="asp-head">
    <h3 id="asp-head">Aspects</h3>
    <div class="legend">
      <span class="badge asp conj">‚òå Conjunction</span>
      <span class="badge asp sext">‚ú∂ Sextile</span>
      <span class="badge asp sqr">‚ñ° Square</span>
      <span class="badge asp tri">‚ñ≥ Trine</span>
      <span class="badge asp opp">‚òç Opposition</span>
    </div>
    <table class="asp-table">
      <thead><tr><th>Pair</th><th>Aspect</th><th>Orb</th></tr></thead>
      <tbody id="aspBody"></tbody>
    </table>
  </section>
</article>

      <!-- Practices -->
      <article class="card col-6" id="practiceCard" aria-labelledby="prac-head">
        <h2 id="prac-head">Practices & Prompts</h2>
        <ol id="practiceList" class="prompts"></ol>
        <label class="meta" for="noteText" style="display:block;margin-top:10px">Your note for this moon</label>
        <textarea id="noteText" placeholder="What are you tracking, learning, releasing?" aria-label="Note for this moon"></textarea>
        <div class="lab-row" style="margin-top:8px">
          <button class="lab-btn" id="btnSaveNote" type="button">Save note</button>
        </div>
      </article>

      <!-- Codex -->
      <section class="codex card shine" id="loreCodex" aria-label="Moon Codex">
        <aside class="codex-toc" aria-label="Codex contents">
          <h4>Codex</h4>
          <ol>
            <li><a href="#cx-intro">Introduction</a></li>
            <li><a href="#cx-practice">Practices</a></li>
            <li><a href="#cx-notes">Notes & Footnotes</a></li>
          </ol>
        </aside>

        <article class="codex-content">
          <h1 id="cx-intro">The Remnant Moon Codex</h1>
          <p class="lede dropcap">A living scroll of patterns, pulses, and presence ‚Äî meant to be read like a sky.</p>

          <div class="callout info">
            <div class="head">Essence</div>
            <div class="body">Channel inspiration. Harmonize integrity. Perfect manifestation.</div>
          </div>

          <blockquote class="pull">‚ÄúNumber the days; crown the weeks; keep the remnant bright.‚Äù</blockquote>

          <figure>
            <img src="assets/media/codex-example.jpg" alt="Codex plate showing harmonics of the 13√ó28 count">
            <figcaption>Plate VII ‚Äî Harmonics of the 13√ó28 count.</figcaption>
          </figure>

          <h2 id="cx-practice">Practice</h2>
          <p>Mark the day‚Äôs tone in your journal. Tap the <span class="kbd">T</span> key to step hours; <span class="kbd">‚Üë/‚Üì</span> to step days.</p>

          <h3 id="cx-notes">Notes & Footnotes</h3>
          <hr>
          <ol class="footnotes">
            <li id="fn1">On leap days and DOOT handling ‚Äî see script options. <a href="#fnref1">‚Ü©</a></li>
          </ol>

          <!-- Example codex files -->
          <div class="codex-files" id="codexFiles">
            <div class="file" data-ext="PDF" role="button" tabindex="0" aria-label="Open PDF: Codex ¬∑ Resonant Harmonies">
              <div class="file-top">
                <div class="name">Codex ¬∑ Resonant Harmonies</div>
                <span class="badge"><i class="dot" aria-hidden="true"></i> plate</span>
              </div>
              <div class="file-meta">
                <span class="pill">2.3 MB</span>
                <span class="pill">Updated this moon</span>
              </div>
            </div>

            <div class="file" data-ext="MD" role="button" tabindex="0" aria-label="Open notes: Codex ¬∑ Praxis Notes">
              <div class="file-top">
                <div class="name">Codex ¬∑ Praxis Notes</div>
                <span class="badge"><i class="dot" aria-hidden="true"></i> notes</span>
              </div>
              <div class="file-meta">
                <span class="pill">12 min read</span>
                <span class="pill">v1.4</span>
              </div>
            </div>
          </div>
        </article>
      </section>
    </section>

    <footer class="footer">
      <div class="divider" aria-hidden="true"></div>
      <p class="meta">¬© <span id="yr">2025</span> Aaron Paul Laird ‚Äî Scroll of Fire ‚Ä¢ BY-NC 4.0</p>
    </footer>
  </main>

  <noscript>
    <p class="meta" style="text-align:center">This page needs JavaScript to calculate moon/day, phase, and year map.</p>
  </noscript>

  <!-- Page JS (external; v3.9 fixes phase selector and drives accents) -->
  <script src="assets/js/moons.js?v=3.9" defer></script>

  <!-- Mini glue: sync moonbar + share-card + opener deep link + veil + shortcuts + FB IAB polish -->
  <script>
  (function(){
    "use strict";

    // --- cache elements
    const arcMain = document.getElementById("moonArc");
    const arcMini = document.getElementById("moonArcMini");
    const mbName  = document.getElementById("mbName");
    const mbDay   = document.getElementById("mbDay");
    const mbEss   = document.getElementById("mbEssence");
    const mbYear  = document.getElementById("mbYear");
    const noteBox = document.getElementById("noteText");
    const jumpSel = document.getElementById("jumpMoon");

    const moonChip   = document.getElementById("moonChip");
    const moonName   = document.getElementById("moonName");
    const moonEss    = document.getElementById("moonEssence");
    const dayInMoon  = document.getElementById("dayInMoon");
    const yearSpan   = document.getElementById("yearSpan");

    const tzPick = document.getElementById("tzPick");
    const datePick = document.getElementById("datePick");
    const hourScrub = document.getElementById("hourScrub");
    const openSeal = document.getElementById("openSeal");
    const openSealHeader = document.getElementById("openSealHeader");

    const prevBtn = document.getElementById("prevDay");
    const nextBtn = document.getElementById("nextDay");
    const todayBtn= document.getElementById("btnToday");

    // --- helpers
    const cssVar = (name, fb) => getComputedStyle(document.documentElement).getPropertyValue(name).trim() || fb;
    const dl = (name, blob)=>{
      const a=document.createElement("a"); a.download=name; a.href=URL.createObjectURL(blob);
      document.body.appendChild(a); a.click(); setTimeout(()=>{ URL.revokeObjectURL(a.href); a.remove(); }, 400);
    };

    // --- mirror main badge ‚Üí mini bar
    function syncMini(){
      if (mbName && moonName)  mbName.textContent = moonName.textContent || "‚Äî";
      if (mbEss  && moonEss)   mbEss.textContent  = moonEss.textContent  || "‚Äî";
      if (mbDay  && dayInMoon) mbDay.textContent  = (dayInMoon.textContent||"‚Äî") + "/28";
      if (mbYear && yearSpan)  mbYear.textContent = yearSpan.textContent || "‚Äî";

      const mainDash = arcMain?.getAttribute("stroke-dasharray");
      if (arcMini && mainDash) arcMini.setAttribute("stroke-dasharray", mainDash);

      // Load per-moon note
      const idx = moonChip?.getAttribute("data-idx");
      if (idx && noteBox){
        const saved = localStorage.getItem(`sof_moon_note_${idx}`) || "";
        if (noteBox.value !== saved) noteBox.value = saved;
      }
    }
    setTimeout(syncMini, 60);
    const mo = new MutationObserver(syncMini);
    arcMain && mo.observe(arcMain, { attributes:true, attributeFilter:["stroke-dasharray"] });
    moonChip && mo.observe(moonChip, { childList:true, subtree:true, attributes:true });
    yearSpan && mo.observe(yearSpan, { childList:true, characterData:true, subtree:true });
    document.addEventListener("sof:accent-change", syncMini);

    // --- jump to moon
    function jump(){ const v = jumpSel?.value; if (v){ location.hash = `#moon-${v}`; } }
    jumpSel?.addEventListener("change", jump, {passive:true});

    // --- share image card
    async function makeShareCard(){
      const w=1080, h=1080, c=document.createElement("canvas"); c.width=w; c.height=h;
      const k=c.getContext("2d");
      const c1=cssVar("--moon-accent","#7af3ff"), c2=cssVar("--moon-accent-2","#f3c97a");

      const g=k.createLinearGradient(0,0,0,h); g.addColorStop(0,"#0a0e15"); g.addColorStop(1,"#06080d"); k.fillStyle=g; k.fillRect(0,0,w,h);
      const g2=k.createLinearGradient(0,0,w,0); g2.addColorStop(0,c1+"22"); g2.addColorStop(.5,c2+"18"); g2.addColorStop(1,c1+"22");
      k.fillStyle=g2; k.beginPath(); k.moveTo(0,240); for(let x=0;x<=w;x+=24){ k.lineTo(x,240+Math.sin(x*0.006)*20); } k.lineTo(w,0); k.lineTo(0,0); k.closePath(); k.fill();

      k.fillStyle="#e9eef6"; k.font="800 56px Inter, system-ui"; k.fillText("Remnant 13 Moons ‚Äî Living Clock", 64, 112);

      const name=(moonName?.textContent||"‚Äî").trim();
      const essence=(moonEss?.textContent||"‚Äî").trim();
      const dayTxt=((dayInMoon?.textContent||"‚Äî").trim())+" / 28";
      const yearTxt=(yearSpan?.textContent||"‚Äî").trim();
      const sub=document.getElementById("phaseLine")?.textContent?.trim()||"";

      k.font="800 92px Inter, system-ui"; k.fillText(name, 64, 260);
      k.font="600 40px Inter, system-ui"; k.fillStyle="#c9d3e9"; k.fillText(essence, 64, 320);

      k.fillStyle="#0f1116"; k.strokeStyle="#2a3242"; k.lineWidth=2;
      function chip(x,y,txt){ const padX=18; k.font="800 38px Inter, system-ui";
        const mw=k.measureText(txt).width, cw=mw+padX*2, ch=56;
        k.beginPath(); k.roundRect(x,y,cw,ch,12); k.fill(); k.stroke();
        k.fillStyle="#e9eef6"; k.fillText(txt, x+padX, y+40); k.fillStyle="#0f1116"; return x+cw+10;
      }
      let cx=64; cx=chip(cx,370,dayTxt); cx=chip(cx,370,yearTxt); chip(cx,370, sub || "‚Äî");

      k.font="600 32px Inter, system-ui"; k.fillStyle="#a8b1c9";
      k.fillText("scroll-of-fire ¬∑ ssnfts24.github.io/scroll-of-fire", 64, h-64);

      const blob=await new Promise(res=>c.toBlob(res,"image/png",0.96)); if(blob) dl(`13-moons-${name.replace(/\s+/g,"-").toLowerCase()}.png`, blob);
    }
    document.getElementById("btnShareImage")?.addEventListener("click", makeShareCard, {passive:true});

    // --- save note
    document.getElementById("btnSaveNote")?.addEventListener("click", ()=>{
      const idx = moonChip?.getAttribute("data-idx"); if(!idx) return;
      localStorage.setItem(`sof_moon_note_${idx}`, noteBox?.value || "");
      const t=document.createElement("div"); t.className="toast"; t.textContent="Note saved";
      Object.assign(t.style,{position:"fixed",left:"50%",bottom:"24px",transform:"translateX(-50%)",background:"#0e131c",color:"#e6f9ff",padding:"8px 12px",border:"1px solid var(--line)",borderRadius:"10px",boxShadow:"0 10px 28px rgba(0,0,0,.35)",zIndex:"9999",opacity:"0",transition:"opacity .2s"});
      document.body.appendChild(t); requestAnimationFrame(()=>t.style.opacity=1);
      setTimeout(()=>{ t.style.opacity=0; setTimeout(()=>t.remove(),250); }, 1400);
    }, {passive:true});

    // --- Remnant veil reacts to phase accents
    function refreshVeil(){
      const c1=cssVar("--moon-accent","#7af3ff");
      const c2=cssVar("--moon-accent-2","#f3c97a");
      const veil=`conic-gradient(from 0deg at 50% 50%, ${c1}24, transparent, ${c2}20, transparent)`;
      document.documentElement.style.setProperty("--remnant-veil", veil);
    }
    document.addEventListener("sof:accent-change", refreshVeil);
    refreshVeil();

    // --- Build deep link for the Birth Seal opener (reads selected date/tz/hour)
    function buildSealLink(){
      const base = "genesis-oracle.html";
      const tz = (tzPick && tzPick.value) || Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC";
      const now = new Date();
      const dateStr = (datePick && datePick.value) || new Date(now.getTime()-now.getTimezoneOffset()*60000).toISOString().slice(0,10);
      const hour = (hourScrub && hourScrub.value) ? String(hourScrub.value) : String(now.getHours());
      const u = new URL(base, document.baseURI || location.href);
      u.searchParams.set("d", dateStr);
      u.searchParams.set("tz", tz);
      u.searchParams.set("t", hour);
      const moonIdx = document.getElementById("moonChip")?.getAttribute("data-idx");
      if (moonIdx) u.hash = `moon-${moonIdx}`;
      return u.toString();
    }
    function applySealHref(a){ if (a) a.setAttribute("href", buildSealLink()); }
    ["change","input"].forEach(evt=>{
      tzPick?.addEventListener(evt, ()=>{ applySealHref(openSeal); applySealHref(openSealHeader); }, {passive:true});
      datePick?.addEventListener(evt, ()=>{ applySealHref(openSeal); applySealHref(openSealHeader); }, {passive:true});
      hourScrub?.addEventListener(evt, ()=>{ applySealHref(openSeal); applySealHref(openSealHeader); }, {passive:true});
    });
    applySealHref(openSeal); applySealHref(openSealHeader);

    // --- Keyboard shortcuts (non-invasive; clicks existing buttons)
    document.addEventListener("keydown", (e)=>{
      if (e.target && /input|select|textarea/i.test(e.target.tagName)) return;
      if (e.key === "ArrowRight" || e.key === "PageDown"){ nextBtn?.click(); e.preventDefault(); }
      if (e.key === "ArrowLeft"  || e.key === "PageUp"){   prevBtn?.click(); e.preventDefault(); }
      if (e.key === "ArrowUp"){   let v=+hourScrub.value||0; hourScrub.value=Math.min(23,v+1); hourScrub.dispatchEvent(new Event("input")); e.preventDefault(); }
      if (e.key === "ArrowDown"){ let v=+hourScrub.value||0; hourScrub.value=Math.max(0,v-1);  hourScrub.dispatchEvent(new Event("input")); e.preventDefault(); }
      if (e.key.toLowerCase() === "t"){ todayBtn?.click(); e.preventDefault(); }
      if (e.key.toLowerCase() === "s"){ document.getElementById("btnShareImage")?.click(); e.preventDefault(); }
    });

    // --- Cosmetic: set current year in footer
    const yEl=document.getElementById("yr"); if(yEl){ yEl.textContent = String(new Date().getFullYear()); }

    // --- Optional: register a tiny service worker if your manifest expects it
    if ("serviceWorker" in navigator){
      try { navigator.serviceWorker.register("assets/sw.js").catch(()=>{}); } catch(_){}
    }
  })();
  </script>
</body>
</html>
