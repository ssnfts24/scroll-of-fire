<!doctype html>
<html lang="en" dir="ltr" class="sof carrier-432" data-carriers="432,528,369,144,963" data-alive="lively">
<head>
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <script>(()=>{const LIVE="ssnfts24.github.io";if(location.hostname!==LIVE){const b=document.querySelector("base");b&&b.remove();}})();</script>

  <!-- Flashless theme + FB in-app guard -->
  <script>(()=>{try{let t=localStorage.getItem('theme');if(!t){t=(matchMedia&&matchMedia('(prefers-color-scheme: light)').matches)?'light':'dark'}document.documentElement.setAttribute('data-theme',t)}catch{}})();</script>
  <script>(()=>{const ua=navigator.userAgent||'';if(/\bFBAN|FBAV|FB_IAB|FBAN\/Messenger\b/i.test(ua)){document.documentElement.classList.add('is-fbapp')}})();</script>

  <meta charset="utf-8" />
  <title>Remnant 13 Moons â€” Living Clock Â· Scroll of Fire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover, interactive-widget=resizes-content" />
  <meta name="color-scheme" content="dark light" />
  <meta name="theme-color" content="#05070d" media="(prefers-color-scheme: dark)">
  <meta name="theme-color" content="#f7fbff" media="(prefers-color-scheme: light)">
  <meta name="description" content="Remnant 13-Moon Living Clock â€” TZ-true 13Ã—28 mapping with week dots, year map, optional Kin, zodiac fallback, lunar sim, and .ics export." />
  <meta name="format-detection" content="telephone=no">
  <link rel="canonical" href="https://ssnfts24.github.io/scroll-of-fire/moons.html">

  <!-- OG / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Remnant 13 Moons â€” Living Clock">
  <meta property="og:description" content="Day ring â€¢ Week dots â€¢ Year map â€¢ Lunar sim â€¢ Kin â€¢ .ics â€” YHWH seal.">
  <meta property="og:image" content="assets/share/moon-card.png">
  <meta property="og:url" content="https://ssnfts24.github.io/scroll-of-fire/moons.html">
  <meta name="twitter:card" content="summary_large_image">

  <!-- PWA -->
  <link rel="manifest" href="assets/manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="13 Moons">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="assets/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="assets/icons/icon-512.png">
  <link rel="mask-icon" href="assets/icons/safari-pinned.svg" color="#0e131a">

  <!-- Cascade layers -->
  <style>@layer tokens, base, components, astrology, utilities, remnant, legacy;</style>

  <!-- CSS (mobile-first pack) -->
  <link rel="stylesheet" href="assets/css/fonts.css?v=2025-11-02n">
  <link rel="stylesheet" href="assets/css/tokens.css?v=2025-11-02n">
  <link rel="stylesheet" href="assets/css/core.css?v=2025-11-02n">
  <link rel="stylesheet" href="assets/css/astrology.css?v=2025-11-02n">
  <link rel="stylesheet" href="assets/css/moons.css?v=2025-11-02n">
  <link rel="stylesheet" href="assets/css/bridge.css?v=2025-11-02n">

  <!-- Minimal critical helpers to ensure single-column on small screens even if CSS fails to load -->
  <style>
    :root{ --safe-top: env(safe-area-inset-top,0px) }
    .top-safe{ height: calc(var(--safe-top) + 8px) }
    .grid{ display:grid; grid-template-columns:1fr; gap:12px }
    .wrap{ padding-inline: clamp(12px,5vw,20px) }
    .card{ border:1px solid #2a2a33; border-radius:14px; background:#0e0e12; padding:12px }
    .row-2{ display:grid; grid-template-columns:1fr; gap:12px }
    @media (min-width:900px){ .row-2{ grid-template-columns:1fr 1fr } }
    .legend{ display:flex; flex-wrap:wrap; gap:8px }
    .year-map{ width:100%; border-collapse:separate; border-spacing:0 }
    .year-map thead th{ position:sticky; top:0; background:#0e0e12 }
    .weekrow{ display:flex; align-items:center; gap:.6rem; white-space:nowrap; overflow:auto; -webkit-overflow-scrolling:touch }
    /* Focus ring fallback if tokens fail */
    :focus-visible{ outline:2px solid #7af3ff; outline-offset:2px }
  </style>

  <!-- Preloads -->
  <link rel="preload" href="assets/js/moons.js?v=4.3" as="script" crossorigin>
  <link rel="prefetch" href="genesis-oracle.html" as="document">
</head>

<body class="stars remnant-yhwh">
  <div class="top-safe" aria-hidden="true"></div>

  <!-- Ambient sky (behind everything) -->
  <canvas id="skyBg" width="1440" height="900" aria-hidden="true" style="position:fixed;inset:0;width:100vw;height:100vh;z-index:0;pointer-events:none"></canvas>

  <main class="wrap" id="main" role="main" style="position:relative;z-index:1">
    <header class="page-head fancy-head">
      <h1 class="title">ğŸŒ— Remnant 13 Moons <span class="soft">â€” Living Clock</span></h1>
      <p class="subtitle">13Ã—28 cadence Â· TZ-true Â· sealed <span lang="he" title="YHWH">×™×”×•×”</span>.</p>
      <nav class="crumbs" aria-label="Breadcrumb">
        <a class="lab-btn" href="index.html">â† Codex</a>
        <a class="lab-btn" href="theory.html">ğŸ“˜ Theory</a>
        <a id="openSealHeader" class="lab-btn" href="genesis-oracle.html" title="Open the Remnant Birth Seal">âŸ¡ Birth Seal</a>
      </nav>

      <!-- Moon ring badge -->
      <section class="card ringcard" aria-label="Current Moon">
        <div class="moon-badge">
          <div class="ring" aria-label="Day in Moon">
            <svg viewBox="0 0 120 120" role="img" aria-label="Progress ring for day within 28-day moon">
              <circle cx="60" cy="60" r="50" class="ring-bg"/>
              <circle cx="60" cy="60" r="50" class="ring-fg" id="moonArc" pathLength="316"/>
            </svg>
            <div class="label" aria-live="polite"><div class="big" id="dayInMoon">â€”</div><div class="small">/28</div></div>
          </div>
          <span class="pill" id="moonChip"><span class="k" id="moonName">â€”</span><span class="meta" id="moonEssence">â€”</span></span>
          <span class="pill mono"><span id="yearSpan">â€”</span></span>
        </div>

        <div class="weekrow" role="group" aria-label="Week inside the 28-day moon">
          <span class="weeklabel">Week</span>
          <div class="week" id="weekDots" role="list"></div>
        </div>

        <p class="meta" id="dootWarn" hidden><b>Day Out of Time:</b> outside the 13Ã—28 moons.</p>
      </section>
    </header>

    <!-- Dual calendars (stack on mobile) -->
    <section class="grid" aria-label="Remnant vs Gregorian">
      <article class="card">
        <header class="panel__head">
          <h3 class="panel__title" id="remHdr">Remnant Month</h3>
          <div class="panel__meta" id="remMeta">13 Ã— 28 fixed</div>
        </header>
        <section id="remCal" class="calendar" aria-label="Remnant Month (live)"></section>
      </article>

      <article class="card">
        <header class="panel__head">
          <h3 class="panel__title" id="gregHdr">Gregorian Month</h3>
          <div class="panel__meta" id="gregMeta">Variable weeks</div>
        </header>
        <section id="gregCal" class="gregorian" aria-label="Gregorian Month (live)"></section>
        <footer id="calLegend" class="legend" aria-label="Legend">
          <span class="key"><i class="k-dot k-evt1" aria-hidden="true"></i> Event</span>
          <span class="key"><i class="k-dot k-evt2" aria-hidden="true"></i> Ceremony</span>
          <span class="key"><i class="k-dot k-doot" aria-hidden="true"></i> DOOT</span>
          <span class="key"><i class="k-dot k-leap" aria-hidden="true"></i> Leap Day</span>
          <span class="key"><i class="k-dot k-today" aria-hidden="true"></i> Today</span>
        </footer>
      </article>
    </section>

    <!-- Seal opener -->
    <section class="wrap-pad card remnant-frame" id="remnantOpener" aria-label="Open the Remnant Birth Seal">
      <div class="op-grid">
        <div class="op-left" aria-hidden="true">
          <svg class="op-sigil" viewBox="0 0 64 64">
            <defs><linearGradient id="opGrad" x1="0" x2="1"><stop offset="0" stop-color="var(--moon-accent)"/><stop offset="1" stop-color="var(--moon-accent-2)"/></linearGradient></defs>
            <circle cx="32" cy="32" r="26" fill="none" stroke="#1b2231" stroke-width="6"/>
            <circle cx="32" cy="32" r="26" fill="none" stroke="url(#opGrad)" stroke-linecap="round" stroke-width="6" stroke-dasharray="78 163"></circle>
            <text x="32" y="32" text-anchor="middle" dominant-baseline="central" font-family="Inter,system-ui" font-size="16" font-weight="900" fill="currentColor">âŸ¡</text>
          </svg>
        </div>
        <div class="op-mid">
          <h3 class="op-title">The Seal of Becoming</h3>
          <p class="op-sub meta">Prefills your <b>Moon Â· Day Â· Week Â· Tone</b> using date/time/tz.</p>
        </div>
        <div class="op-right">
          <a id="openSeal" class="lab-btn big cta-link" href="genesis-oracle.html">Open Birth Seal</a>
        </div>
      </div>
    </section>

    <!-- Today + controls + Lunar/Numerology -->
    <section class="grid" aria-label="Controls and Simulation">
      <article class="card">
        <h2 id="today-head">Today</h2>
        <div class="chiprow" role="status" aria-live="polite">
          <span class="pill"><b id="nowDate">â€”</b></span>
          <span class="pill mono" id="nowClock" role="timer">â€”:â€”:â€”</span>
          <span class="pill" id="nowTZ">â€”</span>
          <span class="pill" id="moonLine">â€”</span>
        </div>

        <div class="formrow">
          <label>Time Zone
            <select id="tzPick" class="lab-input" aria-label="Time Zone"></select>
          </label>
          <label>Date
            <input type="date" id="datePick" class="lab-input" aria-label="Pick a date" inputmode="numeric" pattern="\d{4}-\d{2}-\d{2}">
          </label>
          <label>Hour
            <input type="range" id="hourScrub" min="0" max="23" value="12" class="lab-input" aria-label="Hour of day">
          </label>
        </div>

        <div class="btnrow">
          <button class="lab-btn" id="btnToday" type="button">Today</button>
          <button class="lab-btn" id="prevDay" type="button">â† Prev</button>
          <button class="lab-btn" id="nextDay" type="button">Next â†’</button>
          <button class="lab-btn ghost" id="shareLink" type="button">Copy Link</button>
          <label class="tag" style="margin-left:auto">Go to:
            <select id="jumpMoon" class="lab-input" aria-label="Jump to Moon">
              <option value="">â€”</option>
              <option value="1">#1 Magnetic</option><option value="2">#2 Lunar</option><option value="3">#3 Electric</option>
              <option value="4">#4 Self-Existing</option><option value="5">#5 Overtone</option><option value="6">#6 Rhythmic</option>
              <option value="7">#7 Resonant</option><option value="8">#8 Galactic</option><option value="9">#9 Solar</option>
              <option value="10">#10 Planetary</option><option value="11">#11 Spectral</option><option value="12">#12 Crystal</option>
              <option value="13">#13 Cosmic</option>
            </select>
          </label>
        </div>
        <p class="hint keys">Keys: <span class="kbd">â†‘/â†“</span> day â€¢ <span class="kbd">â†/â†’</span> hour â€¢ <span class="kbd">T</span> today</p>
      </article>

      <aside class="card" aria-labelledby="lunar-head">
        <h2 id="lunar-head">Lunar Phase</h2>
        <div class="sim">
          <canvas id="simMoon" width="280" height="280" aria-label="Lunar phase"></canvas>
          <div>
            <p class="mono" id="phaseLine">â€”</p>
            <p class="meta" id="phaseMeta">â€”</p>
            <div class="divider" aria-hidden="true"></div>

            <!-- Numerology (auto-hidden if empty) -->
            <section id="numerologyBox" aria-live="polite">
              <h3 class="tight">Numerology</h3>
              <p class="mono" id="numLine">â€”</p>
              <p class="meta" id="numMeta">â€”</p>
              <p class="meta" id="energyQuote" style="margin-top:6px">â€”</p>
            </section>
          </div>
        </div>
      </aside>
    </section>

    <!-- Year map -->
    <article class="card" aria-labelledby="map-head">
      <h2 id="map-head">Year Map â€” Gregorian spans of the 13 Moons</h2>
      <p class="hint">New Year = July 26 Â· Day Out of Time = July 25 Â· Leap Day (Feb 29) is skipped in the 13Ã—28 count.</p>
      <div class="scroller" role="region" aria-label="13 Moons Year Map">
        <table class="year-map" id="yearMap">
          <thead><tr><th scope="col">#</th><th scope="col">Moon Name</th><th scope="col">Essence</th><th scope="col">Start (TZ)</th><th scope="col">End (TZ)</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
      <p class="meta" id="nextMoonInfo">â€”</p>
    </article>

    <!-- Kin + ICS -->
    <article class="card" aria-labelledby="kin-head">
      <h2 id="kin-head">Kin of Today (optional)</h2>
      <div class="kin">
        <div class="kin-row" role="group" aria-label="Kin Options">
          <label class="tag"><input type="checkbox" id="kinOn" /><span>Show Kin</span></label>
          <label class="tag">Epoch:
            <select id="kinEpoch" class="lab-input">
              <option value="1987-07-26">1987-07-26 (Dreamspell common)</option>
              <option value="1990-01-01">1990-01-01</option>
            </select>
          </label>
          <label class="tag"><input type="checkbox" id="kinSkipLeap" checked /><span>Skip Leap Day</span></label>
          <label class="tag"><input type="checkbox" id="kinSkipDOOT" checked /><span>Skip DOOT</span></label>
        </div>
        <div class="kin-row">
          <span class="tag" id="kinBadge" aria-live="polite">Kin â€”</span>
          <span class="meta" id="kinLine" aria-live="polite">â€”</span>
        </div>
        <small class="meta">Toggle options to match external calculators exactly.</small>
      </div>

      <div class="goldline" aria-hidden="true"></div>
      <h3 class="tight">Export this 13-Moon Year</h3>
      <p class="meta">Download an <code>.ics</code> calendar with the 13 Moon spans for the selected time-zone/year.</p>
      <div class="btnrow">
        <a id="dlICS" class="dl" href="#" download="13-moon-year.ics" role="button">â¬‡ï¸ Download .ics</a>
        <button class="lab-btn ghost" id="regenICS" type="button">Refresh</button>
      </div>
    </article>

    <!-- Astrology -->
    <article class="card shine astro" aria-labelledby="astro-head">
      <header class="astro-head">
        <span class="seal" aria-hidden="true">âŸ¡ <span lang="he">×™×”×•×”</span></span>
        <h2 id="astro-head">Astrology Now</h2>
        <p class="meta">Filled by <code>window.__EPHEMERIS__</code> when available; otherwise shows a safe demo.</p>
      </header>

      <section class="astro-grid">
        <div class="astro-chips" id="planetChips" role="list">
          <button class="chip pl-sun" data-planet="sun" type="button"><i class="dot el-fire" aria-hidden="true"></i><b>Sun</b> <span class="mono pos" data-pos="sun">â€”</span> <span class="sign" data-sign="sun">â€”</span></button>
          <button class="chip pl-moon" data-planet="moon" type="button"><i class="dot el-water" aria-hidden="true"></i><b>Moon</b> <span class="mono pos" data-pos="moon">â€”</span> <span class="sign" data-sign="moon">â€”</span></button>
          <button class="chip pl-mercury" data-planet="mercury" type="button"><i class="dot el-air" aria-hidden="true"></i><b>Mercury</b> <span class="mono pos" data-pos="mercury">â€”</span> <span class="sign" data-sign="mercury">â€”</span></button>
          <button class="chip pl-venus" data-planet="venus" type="button"><i class="dot el-earth" aria-hidden="true"></i><b>Venus</b> <span class="mono pos" data-pos="venus">â€”</span> <span class="sign" data-sign="venus">â€”</span></button>
          <button class="chip pl-mars" data-planet="mars" type="button"><i class="dot el-fire" aria-hidden="true"></i><b>Mars</b> <span class="mono pos" data-pos="mars">â€”</span> <span class="sign" data-sign="mars">â€”</span></button>
          <button class="chip pl-jupiter" data-planet="jupiter" type="button"><i class="dot el-air" aria-hidden="true"></i><b>Jupiter</b> <span class="mono pos" data-pos="jupiter">â€”</span> <span class="sign" data-sign="jupiter">â€”</span></button>
          <button class="chip pl-saturn" data-planet="saturn" type="button"><i class="dot el-earth" aria-hidden="true"></i><b>Saturn</b> <span class="mono pos" data-pos="saturn">â€”</span> <span class="sign" data-sign="saturn">â€”</span></button>
          <details class="chip more">
            <summary><i class="dot el-aether" aria-hidden="true"></i><b>Outer bodies</b></summary>
            <div class="more-grid" role="list">
              <div role="listitem"><b>Uranus</b>  <span class="mono pos" data-pos="uranus">â€”</span>  <span class="sign" data-sign="uranus">â€”</span></div>
              <div role="listitem"><b>Neptune</b> <span class="mono pos" data-pos="neptune">â€”</span> <span class="sign" data-sign="neptune">â€”</span></div>
              <div role="listitem"><b>Pluto</b>   <span class="mono pos" data-pos="pluto">â€”</span>   <span class="sign" data-sign="pluto">â€”</span></div>
              <div role="listitem"><b>Chiron</b>  <span class="mono pos" data-pos="chiron">â€”</span>  <span class="sign" data-sign="chiron">â€”</span></div>
              <div role="listitem"><b>Node â˜Š</b>  <span class="mono pos" data-pos="north_node">â€”</span> <span class="sign" data-sign="north_node">â€”</span></div>
            </div>
          </details>
        </div>

        <figure class="astro-wheel">
          <svg id="astroWheel" viewBox="0 0 360 360" role="img" aria-label="Zodiac wheel">
            <defs><linearGradient id="awGrad" x1="0" y="0" x2="1" y2="1"><stop offset="0" stop-color="var(--moon-accent)"/><stop offset="1" stop-color="var(--moon-accent-2)"/></linearGradient></defs>
            <circle cx="180" cy="180" r="162" fill="none" stroke="#1b2231" stroke-width="2"/>
            <circle cx="180" cy="180" r="150" fill="none" stroke="url(#awGrad)" stroke-opacity=".45" stroke-width="2"/>
            <g id="houseLines" stroke="#2a3242" stroke-width=".8" opacity=".9"></g>
            <g id="signLabels" fill="#a7b1ca" font-family="Inter,system-ui" font-size="10" text-anchor="middle"></g>
            <g id="planetDots" aria-hidden="true">
              <circle r="4.6" class="dot el-fire"   data-dot="sun"    cx="180" cy="30"/>
              <circle r="4.6" class="dot el-water"  data-dot="moon"   cx="180" cy="330"/>
              <circle r="4.6" class="dot el-air"    data-dot="mercury" cx="30"  cy="180"/>
              <circle r="4.6" class="dot el-earth"  data-dot="venus"   cx="330" cy="180"/>
              <circle r="4.6" class="dot el-fire"   data-dot="mars"    cx="60"  cy="60"/>
              <circle r="4.6" class="dot el-air"    data-dot="jupiter" cx="300" cy="300"/>
              <circle r="4.6" class="dot el-earth"  data-dot="saturn"  cx="60"  cy="300"/>
            </g>
          </svg>
          <figcaption class="meta"><span id="astroStamp">â€”</span><span class="sep">Â·</span><span id="astroTZ">â€”</span><span class="sep">Â·</span>Source: <span id="astroSource">â€”</span></figcaption>
        </figure>
      </section>

      <section class="astro-aspects">
        <h3 class="tight">Aspects</h3>
        <div class="legend" role="list">
          <span role="listitem" class="badge asp conj">â˜Œ Conj</span>
          <span role="listitem" class="badge asp sext">âœ¶ Sext</span>
          <span role="listitem" class="badge asp sqr">â–¡ Sq</span>
          <span role="listitem" class="badge asp tri">â–³ Tri</span>
          <span role="listitem" class="badge asp opp">â˜ Opp</span>
        </div>
        <div class="scroller" role="region" aria-label="Aspect Table">
          <table class="asp-table">
            <thead><tr><th scope="col">Pair</th><th scope="col">Aspect</th><th scope="col">Orb</th></tr></thead>
            <tbody id="aspBody"></tbody>
          </table>
        </div>
      </section>
    </article>

    <!-- Practice + Codex -->
    <section class="row-2" id="practiceCodexRow" aria-label="Practice & Codex">
      <article class="card" id="practiceCard">
        <h2 id="prac-head">Practices & Prompts</h2>
        <ol id="practiceList" class="prompts" role="list"></ol>
        <label class="meta" for="noteText" style="display:block;margin-top:10px">Your note for this moon</label>
        <textarea id="noteText" placeholder="What are you tracking, learning, releasing?" aria-label="Note for this moon"></textarea>
        <div class="btnrow"><button class="lab-btn" id="btnSaveNote" type="button">Save note</button></div>
      </article>

      <section class="codex card shine" id="loreCodex" aria-label="Moon Codex">
        <aside class="codex-toc" aria-label="Codex contents">
          <h4>Codex</h4>
          <ol>
            <li><a href="#cx-intro">Introduction</a></li>
            <li><a href="#cx-practice">Practices</a></li>
            <li><a href="#cx-notes">Notes & Footnotes</a></li>
          </ol>
        </aside>

        <article class="codex-content">
          <h1 id="cx-intro">The Remnant Moon Codex</h1>
          <p class="lede dropcap">A living scroll of patterns, pulses, and presence â€” meant to be read like a sky.</p>

          <div class="callout info"><div class="head">Essence</div><div class="body">Channel inspiration. Harmonize integrity. Perfect manifestation.</div></div>

          <blockquote class="pull">â€œNumber the days; crown the weeks; keep the remnant bright.â€</blockquote>

          <figure>
            <img src="assets/media/codex-example.jpg" alt="Codex plate showing harmonics of the 13Ã—28 count" loading="lazy" decoding="async" fetchpriority="low">
            <figcaption>Plate VII â€” Harmonics of the 13Ã—28 count.</figcaption>
          </figure>

          <h2 id="cx-practice">Practice</h2>
          <p>Mark the dayâ€™s tone in your journal. Tap <span class="kbd">T</span> for â€œtodayâ€; use <span class="kbd">â†‘/â†“</span> to step days.</p>

          <h3 id="cx-notes">Notes & Footnotes</h3>
          <hr>
          <ol class="footnotes">
            <li id="fn1">On leap days and DOOT handling â€” see script options. <a href="#fnref1">â†©</a></li>
          </ol>
        </article>
      </section>
    </section>
  </main>

  <footer class="footer">
    <div class="divider" aria-hidden="true"></div>
    <p class="meta">Â© <span id="yr">2025</span> Aaron Paul Laird â€” Scroll of Fire â€¢ BY-NC 4.0</p>
  </footer>

  <noscript><p class="meta" style="text-align:center">This page needs JavaScript to calculate moon/day, phase, and year map.</p></noscript>

  <!-- TZ helper -->
  <script>
  window.MoonTZ=(function(){"use strict";const KEY="sof_moons_tz";
    function setTZ(z){try{new Intl.DateTimeFormat("en-US",{timeZone:z}).format(new Date());localStorage.setItem(KEY,z);}catch{}}
    function getTZ(){return localStorage.getItem(KEY)||(new URLSearchParams(location.search).get("tz"))||(Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC");}
    function wallParts(d,tz){try{const p=new Intl.DateTimeFormat("en-CA",{timeZone:tz,hour12:false,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).formatToParts(d).reduce((m,x)=>(m[x.type]=x.value,m),{});return new Date(Date.UTC(+p.year,+p.month-1,+p.day,+p.hour,+p.minute,+p.second));}catch{return new Date(d);}}
    function nowWall(){return wallParts(new Date(),getTZ());}
    function isoDateWall(d){const w=wallParts(d||new Date(),getTZ());const y=w.getUTCFullYear(),m=String(w.getUTCMonth()+1).padStart(2,"0"),da=String(w.getUTCDate()).padStart(2,"0");return`${y}-${m}-${da}`;}
    (function seed(){const z=new URLSearchParams(location.search).get("tz");if(z) setTZ(z);})();
    return {getTZ,setTZ,wallParts,nowWall,isoDateWall};
  })();
  </script>

  <!-- Main logic (unchanged IDs) -->
  <script src="assets/js/accents.js?v=1.1" defer></script>
  <script src="assets/js/moons.js?v=4.3" defer></script>

  <!-- Mobile helpers: hide numerology if it didn't render; keep starfield; fallback ephemeris -->
  <script>
  (function(){
    "use strict";
    const $=(s,r=document)=>r.querySelector(s);
    // Hide numerology block if values never populate after a short delay
    addEventListener("load",()=>{ setTimeout(()=>{ const box=$("#numerologyBox"); if(!box) return; const line=$("#numLine"); if(!line||!line.textContent||line.textContent.trim()==="â€”"){ box.hidden=true; } },800); });

    // Keep footer year fresh
    const yEl=document.getElementById("yr"); if(yEl) yEl.textContent=String(new Date().getFullYear());

    // Soft starfield (respects reduced motion)
    (function sky(){
      const c=$("#skyBg"); if(!c) return;
      const ctx=c.getContext("2d",{alpha:true});
      function size(){ c.width=innerWidth; c.height=innerHeight; }
      size();
      let stars=Array.from({length:110},()=>({x:Math.random()*c.width,y:Math.random()*c.height,z:0.3+Math.random()*0.7,s:0.6+Math.random()*1.4}));
      const reduce = matchMedia("(prefers-reduced-motion: reduce)").matches;
      function frame(){
        ctx.clearRect(0,0,c.width,c.height);
        for(const st of stars){
          const a=0.25+0.65*Math.abs(Math.sin((performance.now()/1000)*st.z*0.8+st.x));
          ctx.fillStyle=`rgba(122,243,255,${a*0.35})`;
          ctx.beginPath(); ctx.arc(st.x,st.y,st.s,0,Math.PI*2); ctx.fill();
        }
        if(!reduce) requestAnimationFrame(frame);
      }
      frame();
      addEventListener("resize",()=>{size(); stars=stars.map(s=>({x:Math.random()*c.width,y:Math.random()*c.height,z:s.z,s:s.s}))});
    })();

    // Ephemeris demo if none provided (keeps UI alive)
    (function bootAstro(){
      if (window.__EPHEMERIS__ && window.__EPHEMERIS__.longitudes) return;
      const deg=d=>((d%360)+360)%360;
      const now=new Date(), start=new Date(Date.UTC(now.getUTCFullYear(),0,1));
      const day=(now-start)/86400000;
      window.__EPHEMERIS__={
        source:"Demo (approx.)",
        tz: Intl.DateTimeFormat().resolvedOptions().timeZone || "UTC",
        wall: now,
        longitudes:{
          sun:deg((day*0.9856)+280), moon:deg((day*13.176)+210),
          mercury:deg((day*0.9856)+300), venus:deg((day*0.9856)-30),
          mars:deg((day*0.524)+120), jupiter:deg((day*0.083)+240),
          saturn:deg((day*0.033)+60), uranus:deg((day*0.011)+300),
          neptune:deg((day*0.006)+330), pluto:deg((day*0.004)+270),
          chiron:deg((day*0.08)+15), north_node:deg(180-day*0.052)
        }
      };
    })();

    // Date input safety: if unsupported, hide it (your JS should still handle TZ & hour)
    (function dateSupport(){
      const el = document.getElementById('datePick');
      if(!el) return;
      const test=document.createElement('input');test.setAttribute('type','date');
      if(test.type!=='date'){ el.type='text'; el.placeholder='YYYY-MM-DD'; el.setAttribute('inputmode','numeric'); }
    })();
  })();
  </script>
</body>
</html>
