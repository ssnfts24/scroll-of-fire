<!doctype html>
<html lang="en" dir="ltr" class="sof">
<head>
  <!-- Resolve relative URLs from project root on GitHub Pages -->
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <script>
    // In GitHub repo preview (github.com), remove <base> so relative paths still work.
    if (location.hostname === "github.com") { const b=document.querySelector("base"); if(b) b.remove(); }
  </script>

  <meta charset="utf-8" />
  <title>Scroll of Fire — Manifest (Teaching Lab • Practice Studio)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f">
  <meta name="color-scheme" content="dark">
  <meta name="robots" content="index,follow,max-snippet:-1,max-image-preview:large,max-video-preview:-1">
  <meta name="description" content="Manifest — the hands-on practice studio: intention line, voice-carrier tuning, observer loop, coherence (Ξ), focus/breath, and a private witness ledger — grounded in the Codex.">
  <link rel="canonical" href="https://ssnfts24.github.io/scroll-of-fire/teach.html" />

  <!-- Social cards -->
  <meta property="og:title" content="Manifest — Practice & Tools · Scroll of Fire">
  <meta property="og:description" content="Practice coherent manifestation: tune your voice carrier, run the observer loop, measure Ξ, and log your witness streak.">
  <meta property="og:url" content="https://ssnfts24.github.io/scroll-of-fire/teach.html">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/img/og-teach-lab.jpg">
  <meta property="og:image:alt" content="Golden HUD interface of the Manifest studio with ring timer and voice spectrum.">
  <meta name="twitter:card" content="summary_large_image">

  <!-- Icons -->
  <link rel="icon" href="assets/icons/favicon.ico">
  <link rel="icon" type="image/png" sizes="192x192" href="assets/icons/icon-192.png">
  <link rel="apple-touch-icon" href="assets/icons/apple-touch-icon.png">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=Crimson+Pro:wght@400;700;800&display=swap" rel="stylesheet">

  <!-- Core styles -->
  <link rel="preload" as="style" href="assets/css/codex.css?v=2025-10-20">
  <link rel="stylesheet" href="assets/css/codex.css?v=2025-10-20" media="print" onload="this.media='all'">
  <noscript><link rel="stylesheet" href="assets/css/codex.css?v=2025-10-20"></noscript>

  <!-- Manifest visual skin -->
  <link rel="stylesheet" href="assets/css/manifest-show.css?v=2025-10-20">

  <!-- Page-specific overrides -->
  <link rel="stylesheet" href="assets/css/teach.css?v=2025-10-20b">

  <!-- Minimal safety override: if JS fails, make cards visible -->
  <style>
    .no-js .card { opacity:.98 !important; transform:none !important; }
    .wrap{max-width:1180px;margin:0 auto;padding:20px 16px 80px}
    .title{
      font-family:"Crimson Pro",Georgia,serif;font-weight:800;text-align:center;
      font-size:clamp(28px,3.6vw,44px);margin:8px 0 4px;letter-spacing:.3px;
      background:linear-gradient(180deg,#fff 0%,#cfefff 60%,#a7f6ff 100%);
      -webkit-background-clip:text;background-clip:text;color:transparent;
      text-shadow:0 0 24px rgba(122,243,255,.12)
    }
    .subtitle{text-align:center;color:#b8b3a6;font-style:italic;margin:0 0 12px}
    .lab-sticky{position:sticky;top:0;z-index:10;background:linear-gradient(180deg,rgba(13,13,16,.96),rgba(13,13,16,.92));backdrop-filter:saturate(120%) blur(8px)}
    /* Canvas placeholders so users never see a blank area while JS boots */
    canvas[aria-label]{display:block;background:
      radial-gradient(120px 60px at 50% 50%, #0f131c, transparent 60%),
      repeating-linear-gradient(0deg,#0d1118 0 2px, #0e121a 2px 4px);
      border:1px solid #293042;border-radius:12px}
  </style>

  <!-- MathJax (lazy) -->
  <script>
    (function(){
      function loadMJ(){
        if (window.MathJax) return;
        window.MathJax = {
          tex:{ inlineMath:[['\\(','\\)']], displayMath:[['$$','$$']] },
          svg:{ fontCache:'global', linebreaks:{ automatic:true, width:'container' } },
          startup:{ typeset:false }
        };
        const s=document.createElement('script');
        s.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js";
        s.defer=true;
        s.onload=()=>MathJax.typeset && MathJax.typeset();
        document.head.appendChild(s);
      }
      if ('IntersectionObserver' in window){
        const io=new IntersectionObserver(es=>{
          if (es.some(e=>e.isIntersecting)){ io.disconnect(); loadMJ(); }
        },{rootMargin:'800px 0px'});
        io.observe(document.documentElement);
      } else { loadMJ(); }
    })();
  </script>
</head>

<body class="no-js">
  <a class="sr-only" href="#main">Skip to main content</a>
  <noscript><p style="padding:8px;margin:0;background:#111;color:#ffd;">JavaScript is disabled — interactive tools (ring timer, voice gate, ledger) require JS.</p></noscript>

  <main id="main" class="wrap lab-wrap" data-app="manifest-studio">
    <header class="page-head fancy-head" role="banner">
      <span class="lab-strap" aria-label="Section">Practice Suite</span>
      <h1 class="title">✨ Manifest — <em>Live the Codex</em></h1>
      <p class="subtitle">
        A guided path to <em>coherent manifestation</em>:
        craft a clean intention (𝓘), align a voice carrier Π<sub>ν</sub>,
        run the observer loop (𝓘 → 𝓛 → 𝓒 → 𝓢), measure coherence (Ξ),
        then witness and log your streak.
      </p>

      <!-- Top nav -->
      <section class="lab-top card lab-card lab-sticky" style="margin-top:10px" aria-label="Navigation">
        <div class="pill-tabs" role="tablist" aria-label="Manifest tabs">
          <button class="pill active" data-tab="observer"  role="tab" aria-selected="true"  aria-controls="tab-observer">Observer</button>
          <button class="pill"        data-tab="voice"     role="tab" aria-selected="false" aria-controls="tab-voice">Voice Gate</button>
          <button class="pill"        data-tab="phrase"    role="tab" aria-selected="false" aria-controls="tab-phrase">Phrase Tuner</button>
          <button class="pill"        data-tab="coherence" role="tab" aria-selected="false" aria-controls="tab-coherence">Coherence Desk</button>
          <button class="pill"        data-tab="visuals"   role="tab" aria-selected="false" aria-controls="tab-visuals">Visual Focus</button>
          <button class="pill"        data-tab="breath"    role="tab" aria-selected="false" aria-controls="tab-breath">Breath/Biofield</button>
          <button class="pill"        data-tab="ledger"    role="tab" aria-selected="false" aria-controls="tab-ledger">Witness Ledger</button>
          <span class="flex" aria-hidden="true"></span>
          <label class="coach-toggle" for="coach">
            <input id="coach" type="checkbox" aria-pressed="false"> Coach Mode
          </label>
        </div>

        <p class="hint" id="hotkeys">
          Shortcuts: <kbd>1</kbd>–<kbd>7</kbd> tabs • <kbd>?</kbd> help • <kbd>S</kbd> ring • <kbd>G</kbd> Voice Gate • <kbd>L</kbd> Ledger • <kbd>Ctrl</kbd>/<kbd>⌘</kbd>+<kbd>K</kbd> Phrase box
        </p>
        <p id="lab-status" class="meta" role="status" aria-live="polite">Ready.</p>

        <nav class="crumbs" aria-label="Breadcrumb">
          <a href="index.html" class="cta">← Back to Codex</a>
          <a href="theory.html" class="cta">Open Theory</a>
        </nav>
      </section>

      <!-- QuickStart -->
      <section class="grid" aria-label="Quick start" style="margin-top:10px">
        <article class="card col-4 lab-card" id="qs-1">
          <h3>Step 1 — Intention Line (𝓘)</h3>
          <p>One sentence; verbs of clarity; nouns of truth. Avoid negations and hedging.</p>
          <label class="sr-only" for="qsIntention">Your intention</label>
          <input id="qsIntention" class="lab-input" placeholder="I choose calm power and precise timing." autocomplete="off" />
          <p class="key-hint">Press <kbd>Ctrl</kbd>/<kbd>⌘</kbd> + <kbd>Enter</kbd> to send to the Phrase Tuner.</p>
        </article>

        <article class="card col-4 lab-card" id="qs-2">
          <h3>Step 2 — Choose Carrier Π<sub>ν</sub></h3>
          <p>Hum or tap a preset:</p>
          <div class="lab-row" role="group" aria-label="Carrier presets">
            <button class="lab-btn" data-carrier="432">432 Hz</button>
            <button class="lab-btn" data-carrier="528">528 Hz</button>
            <button class="lab-btn" data-carrier="369">369 Hz</button>
          </div>
          <label class="sr-only" for="qsCarrier">Custom carrier frequency</label>
          <input id="qsCarrier" class="lab-input" placeholder="Carrier (Hz)" inputmode="numeric" pattern="[0-9]*" />
          <p class="key-hint">Open mic analyzer with <kbd>G</kbd> (Voice Gate).</p>
        </article>

        <article class="card col-4 lab-card" id="qs-3">
          <h3>Step 3 — Run the Loop</h3>
          <p>2–3 rounds, steady. Seal with gratitude; then log the witness.</p>
          <div class="lab-row">
            <button class="lab-btn primary" data-nav="observer" aria-controls="tab-observer">Open Observer</button>
            <button class="lab-btn ghost" data-nav="ledger" aria-controls="tab-ledger">Open Ledger</button>
          </div>
          <p class="key-hint">Start/Stop ring with <kbd>S</kbd>. Tabs: <kbd>1</kbd>–<kbd>7</kbd>.</p>
        </article>
      </section>
    </header>

    <!-- ===================== PRACTICE SUITE ===================== -->

    <!-- OBSERVER -->
    <section id="tab-observer" class="tab active" role="tabpanel" aria-labelledby="tabbtn-observer">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>⏱️ 4-Beat Observer Loop — 𝓘 → 𝓛 → 𝓒 → 𝓢</h2>

          <ol class="list" aria-describedby="obsHelp obsKeys">
            <li><b>𝓘 Intend:</b> speak your line once on the chosen carrier Π<sub>ν</sub>.</li>
            <li><b>𝓛 Look:</b> choose one undeniable detail in view.</li>
            <li><b>𝓒 Coalesce:</b> release jaw/shoulders; longer exhale.</li>
            <li><b>𝓢 Seal:</b> whisper “thank you,” allow the scene to settle.</li>
          </ol>

          <div class="ring-timer" id="ring" aria-label="Observer timer">
            <svg viewBox="0 0 120 120" class="ring" role="img" aria-label="Observer loop ring">
              <defs><linearGradient id="ringGrad" x1="0" x2="1"><stop offset="0" stop-color="#7af3ff"/><stop offset="1" stop-color="#f3c97a"/></linearGradient></defs>
              <circle cx="60" cy="60" r="54" class="ring-bg"/>
              <circle cx="60" cy="60" r="54" class="ring-fg" id="ringFg" pathLength="100"/>
              <text x="60" y="52" class="ring-phase" text-anchor="middle" id="ringPhase">Ready</text>
              <text x="60" y="72" class="ring-count" text-anchor="middle" id="ringCount">—</text>
            </svg>

            <div class="ring-controls">
              <fieldset class="lab-row" aria-label="Presets">
                <legend class="sr-only">Loop presets</legend>
                <button class="lab-btn" data-preset="8-3"  aria-controls="phaseSec rounds">8s × 3</button>
                <button class="lab-btn" data-preset="12-3" aria-controls="phaseSec rounds">12s × 3</button>
                <button class="lab-btn" data-preset="20-2" aria-controls="phaseSec rounds">20s × 2</button>
              </fieldset>

              <label for="phaseSec">Seconds/phase
                <input id="phaseSec" type="number" min="3" max="120" value="12" inputmode="numeric" aria-describedby="obsHelp">
              </label>

              <label for="rounds">Rounds
                <input id="rounds" type="number" min="1" max="20" value="3" inputmode="numeric">
              </label>

              <label for="pace">Breath pacing
                <select id="pace">
                  <option value="box">Box 4-4-4-4</option>
                  <option value="4-7-8">4-7-8</option>
                  <option value="free" selected>Free</option>
                </select>
              </label>

              <button id="startTimer" class="lab-btn" data-hotkey="S" aria-describedby="obsKeys">Start</button>
              <button id="stopTimer" class="lab-btn ghost">Stop</button>
            </div>

            <p id="obsHelp" class="hint coach" data-coach="Breathe in on 𝓘, see on 𝓛, soften on 𝓒, whisper thanks on 𝓢.">Coach: map breath to operators.</p>
            <p id="obsKeys" class="meta">Hotkey: press <kbd>S</kbd> to start/stop.</p>
          </div>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Manifestation Run (simple)</h3>
          <ol class="list compact">
            <li>Pick a carrier Π<sub>ν</sub> in Voice Gate (or tap a preset).</li>
            <li>Speak 𝓘 once, then run 2–3 rounds of the loop.</li>
            <li>Notice one change; log a witness.</li>
          </ol>

          <div class="badges" aria-label="Streak badges">
            <span id="badge7" class="badge unlit"  title="7-Day Seed">🌱 ×7</span>
            <span id="badge33" class="badge unlit" title="33-Day Orbit">🛰️ ×33</span>
            <span id="badge144" class="badge unlit" title="144 Closure">🜚 ×144</span>
          </div>
          <p class="meta">Badges light as your daily streak grows.</p>
        </aside>
      </article>
    </section>

    <!-- VOICE GATE -->
    <section id="tab-voice" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>🎙️ Voice Gate — Find Your Carrier Π<sub>ν</sub></h2>
          <ol class="list">
            <li><b>Enable Mic</b> and hum one steady note (~3–5s) at low volume.</li>
            <li>Hold steady until <b>Stability</b> ≥ 60% and <b>Noise</b> is low.</li>
            <li><b>Set as carrier</b> and craft your line to that tone.</li>
          </ol>

          <div class="audio-pane" aria-label="Audio lab">
            <div class="audio-controls">
              <button id="micStart" class="lab-btn">Enable Mic</button>
              <button id="micStop"  class="lab-btn ghost">Stop</button>
              <span class="audio-hint" id="nearKey" role="status" aria-live="polite">—</span>
            </div>
            <canvas id="wave" width="800" height="140" aria-label="Waveform preview"></canvas>
            <canvas id="fft"  width="800" height="140" aria-label="Frequency spectrum"></canvas>
            <div class="lab-row" aria-live="polite">
              <span id="stability" class="meta">Stability: —</span>
              <span id="noiseWarn" class="meta">Noise: —</span>
              <button id="useCarrier" class="lab-btn" disabled>Set as carrier</button>
            </div>
          </div>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Carrier Presets</h3>
          <div class="lab-row" role="group" aria-label="Carrier presets">
            <button class="lab-btn" data-carrier="432">432 Hz — Ground</button>
            <button class="lab-btn" data-carrier="528">528 Hz — Repair</button>
            <button class="lab-btn" data-carrier="369">369 Hz — Lock-in</button>
          </div>

          <h3 style="margin-top:12px">Today’s Intention</h3>
          <label for="carrierOut">Carrier (Hz)
            <input id="carrierOut" class="lab-input" readonly placeholder="—">
          </label>
          <label for="intentionFromVoice">Intention (𝓘)
            <input id="intentionFromVoice" class="lab-input" placeholder="One clean line using this carrier…">
          </label>
          <button id="sendToLedger" class="lab-btn">Send to Ledger</button>
          <p class="meta">Edit the entry in the Witness Ledger before saving.</p>
        </aside>
      </article>
    </section>

    <!-- PHRASE TUNER -->
    <section id="tab-phrase" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>🔡 Phrase Tuner Pro — Weight the Meaning (Eq.16)</h2>
          <textarea id="phraseIn" rows="3" placeholder="Type a sentence you plan to speak…"></textarea>
          <div class="chip-lane" id="chipLane" aria-label="Token weights"></div>
          <div class="phrase-actions">
            <button id="btnTuned" class="lab-btn">Tune & Highlight</button>
            <button id="btnClearPhrase" class="lab-btn ghost">Clear</button>
            <output id="semScore" class="meta">Semantic weight: —</output>
          </div>
          <div class="phrase-out">
            <p><b>Negations:</b> <span id="negCount">0</span></p>
            <p><b>Suggestion:</b> <span id="phraseOut">—</span></p>
          </div>
          <div class="eq lab-eq"><div class="scroll">
            $$ \nabla_{\text{sem}} \mathrm{Phrase} = \sum_k w_k \,\nabla_{\text{sem}} \mathrm{Token}_k \qquad (\sum w_k=1) $$
          </div></div>
          <p class="hint coach" data-coach="Drag chips to raise emphasis. Prefer strong verbs & solid nouns; drop filler and hedging.">Coach: fewer negations → cleaner gradient.</p>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Micro-Templates</h3>
          <details open><summary>Care & clarity</summary><p>I will speak simply and listen fully.</p></details>
          <details><summary>Leadership</summary><p>We deliver one useful thing today, together.</p></details>
          <details><summary>Healing</summary><p>May light reveal, and love restore.</p></details>
        </aside>
      </article>
    </section>

    <!-- COHERENCE DESK -->
    <section id="tab-coherence" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>📈 Coherence Desk — Ξ & Half-Life</h2>
          <div class="desk-grid">
            <div class="desk-card" aria-label="Ξ calculator">
              <label for="hDotI">⟨H·I⟩ (0–1)
                <input type="number" step="0.01" min="0" max="1" id="hDotI" value="0.62">
              </label>
              <label for="mVar">Var[𝓜] (0–2)
                <input type="number" step="0.01" min="0" max="2" id="mVar" value="0.30">
              </label>
              <button id="btnXi" class="lab-btn">Compute Ξ</button>
              <output id="outXi" class="big" aria-live="polite">Ξ = —</output>
              <canvas id="xiSpark" width="320" height="60" aria-label="Ξ history sparkline"></canvas>
            </div>
            <div class="desk-card" aria-label="Half-life calculator">
              <label for="tauDays">τ (days)
                <input type="number" id="tauDays" min="1" max="120" value="10">
              </label>
              <button id="btnHalfLife" class="lab-btn">Compute λ / t½</button>
              <output id="outHalfLife" class="big" aria-live="polite">λ = —, t½ = —</output>
              <p class="meta">Longer τ → slower decay → skills stick.</p>
            </div>
          </div>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Stop Rule (Eq.9)</h3>
          <p>If Truth/Distortion worsens, <b>abort</b>. Realign (breath/phrase), then resume.</p>
          <label class="coach-toggle small"><input id="autoLogXi" type="checkbox" checked> Auto-log Ξ to ledger</label>
        </aside>
      </article>
    </section>

    <!-- VISUAL FOCUS -->
    <section id="tab-visuals" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>👁️ Visual Focus — Single-Point & Expansion</h2>
          <p>Train attention to hold, then expand — mirroring 𝓛 (Look) and 𝓒 (Coalesce).</p>
          <canvas id="focusDot" width="600" height="280" aria-label="Focus trainer canvas"></canvas>
          <div class="lab-row">
            <label for="vfHold">Hold (s)
              <input id="vfHold" type="number" value="10" min="5" max="60">
            </label>
            <label for="vfExpand">Expand (s)
              <input id="vfExpand" type="number" value="6" min="3" max="30">
            </label>
            <button id="vfStart" class="lab-btn">Start Focus Cycle</button>
          </div>
          <p class="meta">Dot phase = single-point; ring phase = peripheral expansion. Sync with breath.</p>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Use in the Run</h3>
          <ol class="list compact">
            <li>Before Observer: 1 cycle to stabilize 𝓛.</li>
            <li>After: 1 expansion to soften 𝓒 and ease 𝓢.</li>
          </ol>
        </aside>
      </article>
    </section>

    <!-- BREATH/BIOFIELD -->
    <section id="tab-breath" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-7 lab-card">
          <h2>🌬️ Breath / Biofield — Rhythms & HR proxy</h2>
          <p>Choose a cadence; the ring guides inhale/hold/exhale/hold.</p>

          <div class="ring-timer" id="breathRing" aria-label="Breath pacing ring">
            <svg viewBox="0 0 120 120" class="ring" role="img" aria-label="Breath ring">
              <circle cx="60" cy="60" r="54" class="ring-bg"/>
              <circle cx="60" cy="60" r="54" class="ring-fg" id="breathFg" pathLength="100"/>
              <text x="60" y="52" class="ring-phase" text-anchor="middle" id="breathPhase">Ready</text>
              <text x="60" y="72" class="ring-count" text-anchor="middle" id="breathCount">—</text>
            </svg>

            <div class="ring-controls">
              <label for="breathPattern">Pattern
                <select id="breathPattern">
                  <option value="4-4-4-4">Box 4-4-4-4</option>
                  <option value="4-7-8">4-7-8</option>
                  <option value="5-5-5-5">5-5-5-5</option>
                </select>
              </label>
              <button id="breathStart" class="lab-btn">Start</button>
              <button id="breathStop" class="lab-btn ghost">Stop</button>
            </div>
          </div>
        </div>

        <aside class="card col-5 lab-card">
          <h3>Physiology note</h3>
          <p>Slow nasal inhales and longer, silent exhales tend to balance autonomic rhythms — often felt as “biofield smoothing.”</p>
        </aside>
      </article>
    </section>

    <!-- LEDGER -->
    <section id="tab-ledger" class="tab" role="tabpanel">
      <article class="grid">
        <div class="card col-12 lab-card">
          <h2>📒 Witness Ledger <small class="lab-muted">(private on this device)</small></h2>
          <div class="ledger-top" aria-label="New entry">
            <input id="entryIntention" placeholder="Intention (𝓘): one clean line…" autocomplete="off">
            <input id="entryCarrier" placeholder="Carrier (432/528/369)" inputmode="numeric" pattern="[0-9]*">
            <select id="entryQuality" aria-label="Ξ quality"><option value="">Ξ quality…</option><option>Low</option><option>Medium</option><option>High</option></select>
            <input id="entryTags" placeholder="Tags (comma separated)" autocomplete="off">
          </div>
          <textarea id="entryWitness" rows="3" placeholder="Witness notes (what changed, what lingered)…"></textarea>

          <div class="ledger-actions">
            <button id="btnAddEntry" class="lab-btn">Add</button>
            <span aria-live="polite" class="meta">🗓️ Streak: <b id="streakDays">0</b> days</span>
            <button id="btnExport" class="lab-btn">Export .json</button>
            <input type="file" id="fileImport" accept="application/json" hidden>
            <button id="btnImport" class="lab-btn ghost">Import .json</button>
            <input id="ledgerFilter" placeholder="Filter by tag or text…" autocomplete="off">
          </div>

          <div id="ledgerEmpty" class="lab-muted" role="note" style="display:none; margin:8px 0 6px;">
            No entries yet. Run the Observer once, then write a 1–2 sentence witness.
          </div>

          <div class="table-wrap" role="region" aria-label="Practice ledger">
            <table id="ledgerTable">
              <colgroup>
                <col style="width:16ch"><col><col style="width:10ch"><col style="width:8ch"><col style="width:18ch"><col><col style="width:4ch">
              </colgroup>
              <thead><tr><th>Date</th><th>Intention</th><th>Carrier</th><th>Ξ</th><th>Tags</th><th>Witness</th><th></th></tr></thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="badges" style="margin-top:10px" aria-label="Streak badges">
            <span id="badge7b"   class="badge unlit"  title="7-Day Seed">🌱 ×7</span>
            <span id="badge33b"  class="badge unlit" title="33-Day Orbit">🛰️ ×33</span>
            <span id="badge144b" class="badge unlit" title="144 Closure">🜚 ×144</span>
          </div>
        </div>
      </article>
    </section>

    <!-- ETHICS/FAQ/GLOSSARY (unchanged content from your draft) -->
    <section class="grid" aria-label="Learning & Support">
      <article class="card col-7 lab-card" id="ethics">
        <h2>🧭 Ethics & Stop Rule</h2>
        <p>Coherence includes care. If the Truth/Distortion ratio trends worse, <b>stop</b> (Eq. 9), re-center, and resume later.</p>
      </article>
      <article class="card col-5 lab-card" id="faq">
        <h2>❓ FAQ</h2>
        <details open><summary>Why the carrier Π<sub>ν</sub>?</summary><p>A steady tone reduces internal noise and stabilizes breath. That keeps your semantic weights (Eq.16) intact as you act.</p></details>
      </article>
    </section>

    <footer class="footer">
      <div class="divider" aria-hidden="true"></div>
      <p>“Practice is the mathematics of compassion.”</p>
      <p>© <span id="yr">2025</span> Aaron Paul Laird — Scroll of Fire • BY-NC 4.0</p>
    </footer>
  </main>

  <!-- ======== Fallback Mini-Engine: prevents BLANK canvases & adds basic audio ======== -->
  <script>
    (function(){
      "use strict";
      document.body.classList.remove('no-js');
      const $  = (s, r=document) => r.querySelector(s);
      const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
      const on = (t,e,f,o) => t && t.addEventListener && t.addEventListener(e,f,o);
      const raf = (fn) => (window.requestAnimationFrame||setTimeout)(fn,16);
      const prefersReduced = matchMedia("(prefers-reduced-motion: reduce)").matches;

      // Tabs (works without external JS)
      const tabs = $$(".pill");
      const sections = $$(".tab");
      function switchTo(id){
        sections.forEach(s=>s.classList.toggle("active", s.id === "tab-"+id));
        tabs.forEach(b=>{
          const onTab = b.dataset.tab === id;
          b.classList.toggle("active", onTab);
          b.setAttribute("aria-selected", onTab?"true":"false");
        });
      }
      tabs.forEach(b=> on(b,"click",()=>switchTo(b.dataset.tab)));
      on(document,"keydown",(e)=>{
        if(e.target.tagName==="INPUT"||e.target.tagName==="TEXTAREA") return;
        const k=e.key;
        const map={1:"observer",2:"voice",3:"phrase",4:"coherence",5:"visuals",6:"breath",7:"ledger"};
        if(map[k]){ e.preventDefault(); switchTo(map[k]); }
      });

      // Year
      const y=$("#yr"); if (y) y.textContent = new Date().getFullYear();

      // --------- RING TIMER (observer) — draw even without teach.js ---------
      const ringFg = $("#ringFg"), ringPhase=$("#ringPhase"), ringCount=$("#ringCount");
      let ringTimer=null, ringRunning=false;
      function runRing(phaseSec=+($("#phaseSec")?.value||12), rounds=+( $("#rounds")?.value||3 )){
        if (!ringFg) return;
        const phases=["𝓘","𝓛","𝓒","𝓢"];
        const totalSteps=rounds*phases.length;
        let step=0, t0=performance.now();
        ringRunning=true; ringPhase.textContent="Ready"; ringCount.textContent="—";

        const beep = () => { try{
          const AC = window.AudioContext||window.webkitAudioContext; const ac=new AC();
          const o=ac.createOscillator(), g=ac.createGain(); o.type="sine"; o.frequency.value=660;
          g.gain.value=0.0008; o.connect(g).connect(ac.destination); o.start(); g.gain.exponentialRampToValueAtTime(0.00001, ac.currentTime+0.12); o.stop(ac.currentTime+0.13);
        }catch(_){} };

        function tick(now){
          if(!ringRunning) return;
          const elapsed=(now-t0)/1000;
          const phaseIdx = Math.floor(elapsed/phaseSec) % phases.length;
          const round = Math.floor((elapsed/(phaseSec*4)))+1;
          if (round>rounds){ ringRunning=false; ringPhase.textContent="Done"; ringFg.style.strokeDashoffset="0"; return; }
          ringPhase.textContent = phases[phaseIdx];
          ringCount.textContent = `Round ${round}/${rounds}`;
          const p = (elapsed % phaseSec)/phaseSec;
          const dash = 100 - ( (phaseIdx/4 + p/4) * 100 );
          ringFg.style.strokeDasharray="100 100";
          ringFg.style.strokeDashoffset = String(dash);
          const wholeStep = Math.floor(elapsed/phaseSec);
          if (wholeStep !== step){ step=wholeStep; beep(); }
          raf(tick);
        }
        t0=performance.now(); raf(tick);
      }
      on($("#startTimer"),"click",()=>{ if(!ringRunning) runRing(); });
      on($("#stopTimer"),"click",()=>{ ringRunning=false; });

      // --------- BREATH RING (simple) ---------
      const breathFg=$("#breathFg"), breathPhase=$("#breathPhase"), breathCount=$("#breathCount");
      let breathRun=false;
      function startBreath(){
        if(!breathFg) return;
        breathRun=true; let cycles=0; const pattern=($("#breathPattern")?.value||"4-4-4-4").split("-").map(n=>+n||4);
        const phases=["In","Hold","Out","Hold"];
        const total=pattern.reduce((a,b)=>a+b,0);
        let t0=performance.now();
        function tick(now){
          if(!breathRun) return;
          const t=((now-t0)/1000)%total;
          let acc=0, idx=0;
          for(let i=0;i<4;i++){ acc+=pattern[i]; if(t<acc){ idx=i; break; } }
          const prev=acc-pattern[idx]; const p=(t-prev)/pattern[idx];
          breathPhase.textContent=phases[idx]; breathCount.textContent=`Cycle ${cycles+1}`;
          breathFg.style.strokeDasharray="100 100";
          breathFg.style.strokeDashoffset=String(100-( ( (prev + p*pattern[idx]) / total ) * 100 ));
          if(t<0.05){ cycles++; }
          raf(tick);
        }
        raf(tick);
      }
      on($("#breathStart"),"click", startBreath);
      on($("#breathStop"),"click", ()=>{breathRun=false;});

      // --------- VISUAL FOCUS (never blank) ---------
      const focusCanvas=$("#focusDot");
      if (focusCanvas){
        const ctx=focusCanvas.getContext("2d");
        function drawDot(r){
          const {width:w,height:h}=focusCanvas;
          ctx.clearRect(0,0,w,h);
          // radial vignette
          const g=ctx.createRadialGradient(w/2,h/2,Math.min(w,h)*0.1, w/2,h/2, Math.max(w,h)*0.6);
          g.addColorStop(0,"#0b1018"); g.addColorStop(1,"#0a0e15");
          ctx.fillStyle=g; ctx.fillRect(0,0,w,h);
          // center dot
          ctx.beginPath(); ctx.arc(w/2,h/2,r,0,Math.PI*2);
          ctx.fillStyle="#a7f6ff"; ctx.shadowColor="#7af3ff"; ctx.shadowBlur=18; ctx.fill(); ctx.shadowBlur=0;
          // soft ring
          ctx.beginPath(); ctx.arc(w/2,h/2,r*2.2,0,Math.PI*2);
          ctx.strokeStyle="#f3c97a88"; ctx.lineWidth=2; ctx.stroke();
        }
        drawDot(6);
        on($("#vfStart"),"click", ()=>{
          const hold=+($("#vfHold")?.value||10), expand=+($("#vfExpand")?.value||6);
          let t0=performance.now(); const base=6, max=60;
          function anim(now){
            const t=(now-t0)/1000;
            if (t<hold){ const r = base + (Math.sin(t*2*Math.PI/hold)*0.5+0.5)*2; drawDot(r); }
            else if (t<hold+expand){ const p=(t-hold)/expand; drawDot(base + p*(max-base)); }
            else { drawDot(base); return; }
            raf(anim);
          }
          raf(anim);
        });
      }

      // --------- AUDIO: carrier tone + simple mic analyzer (no blank) ---------
      let ac=null, osc=null, gain=null, analyser=null, micSrc=null, micStream=null;
      const wave=$("#wave"), fft=$("#fft");
      function ensureAC(){ try{ ac = ac || new (window.AudioContext||window.webkitAudioContext)(); }catch(_){} return ac; }

      function startCarrier(freq){
        if(!ensureAC()) return;
        stopCarrier();
        osc=ac.createOscillator(); osc.type="sine"; osc.frequency.value=freq;
        gain=ac.createGain(); gain.gain.value=0.0008; // very soft
        osc.connect(gain).connect(ac.destination); osc.start();
        $("#carrierOut") && ($("#carrierOut").value=String(freq));
      }
      function stopCarrier(){ try{ osc && osc.stop(); }catch(_){} osc=null; gain=null; }

      $$(".lab-btn[data-carrier]").forEach(b=> on(b,"click",()=>{
        const f=+b.dataset.carrier; startCarrier(f);
      }));
      on($("#qsCarrier"),"change",(e)=>{ const v=+e.target.value||0; if(v>0) startCarrier(v); });

      async function micOn(){
        if(!ensureAC()) return;
        micStream = await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:false, noiseSuppression:false}, video:false});
        micSrc = ac.createMediaStreamSource(micStream);
        analyser = ac.createAnalyser(); analyser.fftSize=2048; analyser.smoothingTimeConstant=0.85;
        micSrc.connect(analyser);
        drawAudio();
      }
      function micOff(){ try{ micStream?.getTracks()?.forEach(t=>t.stop()); }catch(_){} micStream=null; micSrc=null; analyser=null; }
      on($("#micStart"),"click",()=>micOn());
      on($("#micStop"),"click",()=>micOff());

      function drawAudio(){
        if(!analyser) return;
        const wctx=wave?.getContext("2d"), fctx=fft?.getContext("2d");
        const w=wave.width,h=wave.height, wf=new Uint8Array(analyser.fftSize);
        const ff=new Uint8Array(analyser.frequencyBinCount);
        function loop(){
          if(!analyser) return;
          analyser.getByteTimeDomainData(wf);
          analyser.getByteFrequencyData(ff);
          if(wctx){
            wctx.clearRect(0,0,w,h);
            wctx.fillStyle="#0b1016"; wctx.fillRect(0,0,w,h);
            wctx.beginPath(); wctx.moveTo(0,h/2);
            for(let x=0;x<w;x++){
              const i = Math.floor(x / w * wf.length);
              const v = (wf[i]-128)/128;
              const y = h/2 + v*h*0.4;
              wctx.lineTo(x,y);
            }
            wctx.strokeStyle="#7af3ff"; wctx.lineWidth=2; wctx.stroke();
          }
          if(fctx){
            const W=fft.width,H=fft.height; fctx.clearRect(0,0,W,H);
            for(let i=0;i<ff.length;i++){
              const v=ff[i]/255; const x=i/ff.length*W; const y=H*(1-v);
              fctx.fillStyle = v>.8?"#f3c97a": v>.5?"#a7f6ff":"#6aa0ff33";
              fctx.fillRect(x, y, W/ff.length, H-y);
            }
          }
          raf(loop);
        }
        raf(loop);
      }

      // Use as carrier when mic is steady enough (very rough heuristic)
      on($("#useCarrier"), "click", ()=>{
        const guess = $("#nearKey")?.textContent?.match(/~(\d+)\s*Hz/);
        const f = guess? +guess[1] : 432;
        startCarrier(f);
        switchTo("observer");
      });

      // Basic “near key” detector (peaks)
      (function nearKeyLoop(){
        if(!analyser) return setTimeout(nearKeyLoop, 500);
        const ff=new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(ff);
        let maxi=0, maxv=0;
        for(let i=4;i<ff.length;i++){ if(ff[i]>maxv){ maxv=ff[i]; maxi=i; } }
        const freq = maxi * ac.sampleRate / analyser.fftSize;
        if (!isFinite(freq)) return setTimeout(nearKeyLoop, 500);
        const note = Math.round(12*Math.log2(freq/440))+69; // MIDI
        const stable = Math.min(100, Math.max(0, (maxv/255)*100));
        $("#nearKey").textContent = `~${Math.round(freq)} Hz • Stability ${Math.round(stable)}%`;
        $("#useCarrier").disabled = stable < 40;
        setTimeout(nearKeyLoop, 250);
      })();

      // Reveal-in view
      if ('IntersectionObserver' in window && !prefersReduced){
        const io = new IntersectionObserver(es=> es.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add("visible"); io.unobserve(e.target); }}), {threshold:.08});
        $$(".card").forEach(c=>io.observe(c));
      } else { $$(".card").forEach(c=>c.classList.add("visible")); }
    })();
  </script>

  <!-- Page engine (enhanced features). Safe to remove; fallback above keeps visuals working. -->
  <script defer src="assets/js/teach.js?v=2025-10-20b"></script>
</body>
</html>
