<!doctype html>
<html lang="en" dir="ltr">
<head>
  <!-- Resolve all relative URLs from the project root on GitHub Pages -->
  <base href="https://ssnfts24.github.io/scroll-of-fire/">
  <script>
    // In GitHub repo preview (github.com), remove <base> so relative paths still work.
    if (location.hostname === "github.com") {
      const b = document.querySelector("base"); if (b) b.remove();
    }
  </script>

  <meta charset="utf-8" />
  <title>A/B Carrier Protocol — Scroll of Fire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b0b0f"><meta name="color-scheme" content="dark">
  <meta name="description" content="Blind A/B carrier test: 432/528/369 randomized, measure Ξ, apply the stop rule, and log to your Witness Ledger.">
  <link rel="canonical" href="https://ssnfts24.github.io/scroll-of-fire/ab.html" />

  <!-- Social -->
  <meta property="og:site_name" content="Scroll of Fire">
  <meta property="og:title" content="A/B Carrier Protocol — Scroll of Fire">
  <meta property="og:description" content="Blind test 432 / 528 / 369. Randomize, run, measure Ξ, apply the stop rule, then reveal and log.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://ssnfts24.github.io/scroll-of-fire/ab.html">
  <meta property="og:image" content="https://ssnfts24.github.io/scroll-of-fire/assets/file_0000000052e861f98b087ad0b80cbefc%20(1).png">

  <!-- CSS -->
  <link rel="preload" as="style" href="assets/css/codex.css?v=ab1">
  <link rel="stylesheet" href="assets/css/codex.css?v=ab1">
  <noscript><link rel="stylesheet" href="assets/css/codex.css?v=ab1"></noscript>

  <!-- Optional banner preload -->
  <link rel="preload" as="image"
        href="assets/file_0000000052e861f98b087ad0b80cbefc%20(1).png"
        imagesizes="100vw" fetchpriority="low">

  <!-- Lazy MathJax (triggers when .eq enters viewport) -->
  <script>
  (function(){
    function loadMJ(){
      if (window.MathJax) return;
      window.MathJax = {
        tex:{inlineMath:[['\\(','\\)']],displayMath:[['$$','$$']]},
        svg:{fontCache:'global',linebreaks:{automatic:true,width:'container'}},
        startup:{typeset:false}
      };
      const s=document.createElement('script');
      s.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js";
      s.defer = true;
      s.onload = () => window.MathJax.typeset && window.MathJax.typeset();
      document.head.appendChild(s);
    }
    addEventListener('DOMContentLoaded', ()=>{
      const tgt = document.querySelector('.eq') || document.body;
      if ('IntersectionObserver' in window){
        const io = new IntersectionObserver((e)=>{
          if (e.some(x=>x.isIntersecting)){ io.disconnect(); loadMJ(); }
        }, {rootMargin:'800px 0px'});
        io.observe(tgt);
      } else loadMJ();
    });
  })();
  </script>

  <style>
    :root{ --maxw:1180px }
    .wrap{max-width:var(--maxw);margin:0 auto;padding:20px 16px 80px}
    .title{
      font-family:"Crimson Pro",serif;font-weight:800;text-align:center;
      font-size:clamp(28px,3.6vw,44px);margin:8px 0 4px;
      background:linear-gradient(180deg,#fff,#cfefff 60%,#a7f6ff);
      -webkit-background-clip:text;background-clip:text;color:transparent
    }
    /* Lab UI */
    .lab-card .big{font-size:20px}
    .lab-row{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0}
    .lab-btn{
      appearance:none;border:1px solid var(--line);background:transparent;color:var(--ink);
      padding:.55rem .8rem;border-radius:10px;font:600 14px/1 Inter;cursor:pointer
    }
    .lab-btn:hover{border-color:#3a3a44}
    .lab-btn.ghost{opacity:.85}
    .desk-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:780px){.desk-grid{grid-template-columns:1fr}}
    .desk-card{border:1px solid var(--line);border-radius:12px;padding:10px;background:rgba(255,255,255,.02)}
    .desk-card label{display:block;margin:6px 0}
    .desk-card input{width:100%;padding:.5rem;border-radius:8px;border:1px solid var(--line);background:#0f0f14;color:var(--ink)}
    .crumbs .cta{margin-inline:0}
    .subtitle{text-align:center;color:var(--muted);margin:0 0 10px}
  </style>
</head>
<body>
<main class="wrap">

  <!-- Banner (kept slim; can remove if not needed) -->
  <figure class="hero hero--contain" aria-label="Scroll of Fire banner" style="margin-bottom:10px">
    <img src="assets/file_0000000052e861f98b087ad0b80cbefc%20(1).png"
         data-src-raw="https://raw.githubusercontent.com/ssnfts24/scroll-of-fire/main/docs/assets/file_0000000052e861f98b087ad0b80cbefc%20(1).png"
         onerror="if(this.dataset.srcRaw&&!this._tried){this._tried=1;this.src=this.dataset.srcRaw;}"
         alt="Scroll of Fire — gilded sigil banner" width="1600" height="900" loading="lazy" decoding="async">
  </figure>

  <!-- Nav -->
  <nav class="tabs" aria-label="Primary navigation">
    <a class="tab" href="index.html">⌂ Home</a>
    <a class="tab" href="theory.html">📘 Theory</a>
    <a class="tab" href="teach.html">🎓 Teach</a>
    <a class="tab tab--primary" aria-current="page" href="ab.html">🔁 A/B Carriers</a>
    <a class="tab" href="ledger.html">🧾 Ledger</a>
  </nav>

  <header class="page-head fancy-head">
    <h1 class="title">🧪 A/B Carrier Protocol</h1>
    <p class="subtitle">Blind test 432 / 528 / 369. Randomize, run the loop, compute Ξ (Eq.13), apply the stop rule (Eq.9), then reveal and log.</p>
    <nav class="crumbs" style="display:flex;gap:8px;justify-content:center">
      <a class="cta" href="start.html">← Start Here</a>
      <a class="cta" href="teach.html#ab">Teaching Lab</a>
    </nav>
  </header>

  <section class="grid">
    <article class="card col-7 lab-card">
      <h2>Step 1 — Blind Randomize</h2>
      <p>Click <b>Randomize</b>. You’ll get “Sample A” and “Sample B” (two different carriers). Don’t peek until after both runs.</p>
      <div class="lab-row">
        <button id="btnRand" class="lab-btn">Randomize A/B</button>
        <button id="btnReveal" class="lab-btn ghost" disabled>Reveal</button>
      </div>
      <div class="desk-grid" style="margin-top:8px">
        <div class="desk-card"><b>Sample A</b><div id="labA" class="meta">—</div></div>
        <div class="desk-card"><b>Sample B</b><div id="labB" class="meta">—</div></div>
      </div>

      <h2 style="margin-top:12px">Step 2 — Two Short Runs</h2>
      <ol class="list">
        <li>Open <a href="teach.html#tab-observer" target="_blank" rel="noopener">Observer</a> in a new tab.</li>
        <li>Use the hidden carrier value shown below (A or B). Run <b>12s × 2</b> rounds.</li>
        <li>Come back and enter your quick Ξ estimate and one-line witness.</li>
      </ol>

      <div class="desk-grid">
        <div class="desk-card">
          <h3>A — quick rating</h3>
          <label>Ξ (0–1)<input id="xiA" type="number" step="0.01" min="0" max="1" value="0.60"></label>
          <label>Witness<input id="witA" placeholder="One detail after A…"></label>
        </div>
        <div class="desk-card">
          <h3>B — quick rating</h3>
          <label>Ξ (0–1)<input id="xiB" type="number" step="0.01" min="0" max="1" value="0.60"></label>
          <label>Witness<input id="witB" placeholder="One detail after B…"></label>
        </div>
      </div>

      <h2 style="margin-top:12px">Step 3 — Decide & Log</h2>
      <p>Pick the better sample (<b>higher Ξ</b> or clearer witness). If Ξ fell or you felt foggy, apply the <b>Stop Rule</b> and re-center before any further testing.</p>
      <div class="lab-row">
        <button id="btnChooseA" class="lab-btn">Choose A</button>
        <button id="btnChooseB" class="lab-btn">Choose B</button>
        <button id="btnToLedger" class="lab-btn ghost" disabled>Send best → Ledger</button>
      </div>

      <details class="note" style="margin-top:10px">
        <summary><b>Math anchors</b></summary>
        <div class="eq"><div class="eq-scroll">
          $$ \mathcal{H}(\nu)=\alpha(\Phi,137,144,432,528,369)\cdot\langle\mathcal{C}\rangle \tag{Eq.3} $$
          $$ \Xi \approx \frac{\langle H\cdot I\rangle}{1 + \mathrm{Var}[\mathcal{M}]} \tag{Eq.13} $$
          $$ \text{If}\ \frac{\mathrm{Truth}}{\mathrm{Distortion}}\downarrow \Rightarrow \text{Abort, Re-align, Resume} \tag{Eq.9} $$
        </div></div>
      </details>
    </article>

    <aside class="card col-5 lab-card">
      <h3>Blind Tag (for your Observer tab)</h3>
      <p>Use this frequency without revealing its label:</p>
      <output id="blindNow" class="big">—</output>
      <p class="meta">Click “Randomize” to populate this field.</p>

      <h3 style="margin-top:12px">Notes</h3>
      <ul class="list compact">
        <li>Keep runs short. Fatigue raises Var[𝓜] → Ξ falls.</li>
        <li>Use the same intention line for A and B (Eq.16 controlled).</li>
      </ul>
    </aside>
  </section>

  <footer class="footer">
    <div class="divider" aria-hidden="true"></div>
    <p>© <span id="yr">2025</span> Aaron Paul Laird — Scroll of Fire • BY-NC 4.0</p>
  </footer>
</main>

<script>
/* Year + external hardening */
(function(){
  const y=document.getElementById('yr'); if(y) y.textContent=String(new Date().getFullYear());
  document.querySelectorAll('a[target="_blank"]').forEach(a=>{
    const rel = new Set((a.getAttribute("rel")||"").toLowerCase().split(/\s+/).filter(Boolean));
    rel.add("noopener"); rel.add("noreferrer"); a.setAttribute("rel", Array.from(rel).join(" "));
  });
})();
</script>

<script>
/* Lab logic */
(function(){
  const $ = (s,r=document)=>r.querySelector(s);
  const pick = (a)=>a[Math.floor(Math.random()*a.length)];
  const pool = [432,528,369];
  let A=null,B=null,best=null;

  const labA=$("#labA"), labB=$("#labB"), blind=$("#blindNow");
  const btnRand=$("#btnRand"), btnReveal=$("#btnReveal"), btnToLedger=$("#btnToLedger");
  const xiA=$("#xiA"), xiB=$("#xiB"), witA=$("#witA"), witB=$("#witB");
  const chooseA=$("#btnChooseA"), chooseB=$("#btnChooseB");

  btnRand.addEventListener('click', ()=>{
    const first=pick(pool), second=pick(pool.filter(x=>x!==first));
    A=first; B=second;
    blind.textContent="Use “Sample A” first: "+A+" Hz";
    labA.textContent="Hidden"; labB.textContent="Hidden";
    btnReveal.disabled=false; btnToLedger.disabled=true; best=null;
  });

  btnReveal.addEventListener('click', ()=>{
    if(A==null||B==null) return;
    labA.textContent=A+" Hz"; labB.textContent=B+" Hz"; blind.textContent="—";
  });

  chooseA.addEventListener('click', ()=>{ best='A'; btnToLedger.disabled=false; });
  chooseB.addEventListener('click', ()=>{ best='B'; btnToLedger.disabled=false; });

  btnToLedger.addEventListener('click', ()=>{
    if(!best) return;
    const freq = best==='A'?A:B;
    const xi = parseFloat((best==='A'?xiA.value:xiB.value)||"");
    const wit = (best==='A'?witA.value:witB.value)||"";
    try{
      const payload = {
        intent:"A/B selection",
        carrier:String(freq),
        quality: isFinite(xi)?(xi>=0.7?"High":xi>=0.5?"Medium":"Low"):"",
        tags:"#ab,#carrier",
        witness:`${best} (${freq} Hz): ${wit}`,
        xi: isFinite(xi)?xi:null,
        t: Date.now()
      };
      localStorage.setItem("codex_ledger_inbox", JSON.stringify(payload));
      alert("Sent to Ledger. Open the Witness Ledger tab to add.");
    }catch(_){ alert("Save failed — copy your note: "+wit); }
  });
})();
</script>

<script>
/* Card reveal + tilt (keeps animations consistent across pages) */
(function(){
  "use strict";
  const $$ = (s, r=document) => Array.from(r.querySelectorAll(s));
  const raf = (fn) => (window.requestAnimationFrame||setTimeout)(fn,16);
  const prefersReduced = matchMedia("(prefers-reduced-motion: reduce)").matches;
  const hasIO = "IntersectionObserver" in window;

  function revealOnScroll(){
    const cards = $$(".card"); if (!cards.length) return;
    if (!prefersReduced && hasIO){
      const io = new IntersectionObserver((entries)=>{
        for (const e of entries){
          if (e.isIntersecting){ e.target.classList.add("visible"); io.unobserve(e.target); }
        }
      }, {root:null, rootMargin:"0px 0px -12%", threshold:0.08});
      cards.forEach(el=>io.observe(el)); return;
    }
    const tick=()=>cards.forEach(el=>{
      const r=el.getBoundingClientRect(); const vh=innerHeight||document.documentElement.clientHeight;
      if (r.top < vh*0.92 && r.bottom > 0) el.classList.add("visible");
    });
    addEventListener("scroll",()=>raf(tick),{passive:true}); addEventListener("load",tick); tick();
  }

  function tiltCards(){
    if (prefersReduced) return;
    $$(".card").forEach(card=>{
      const reset=()=>{ card.style.transform=""; };
      card.addEventListener("mousemove",(e)=>{
        const r=card.getBoundingClientRect();
        const x=(e.clientX-r.left)/r.width, y=(e.clientY-r.top)/r.height;
        raf(()=>{ card.style.transform=`perspective(900px) rotateX(${(0.5-y)*4}deg) rotateY(${(x-0.5)*6}deg)`; });
      });
      ["mouseleave","blur","touchstart"].forEach(ev=>card.addEventListener(ev, reset, {passive:true}));
    });
  }

  // Warm-up for low-power / save-data
  document.body.classList.add('performance-warming');
  const lowCore = (navigator.hardwareConcurrency||4) <= 4;
  const saveData = navigator.connection && navigator.connection.saveData;
  if (lowCore || saveData) document.body.classList.add('perf-fast');
  setTimeout(()=>document.body.classList.remove('performance-warming'), 900);

  document.addEventListener("DOMContentLoaded", ()=>{
    revealOnScroll();
    tiltCards();
  });
})();
</script>
</body>
</html>
